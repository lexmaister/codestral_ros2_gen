2025-03-30 11:51:32,113 - root - INFO - ==================================================
2025-03-30 11:51:32,113 - root - INFO - Logging session started
2025-03-30 11:51:32,113 - root - INFO - Project root: /home/aleev/codestral_gen/codestral_ros2_gen
2025-03-30 11:51:32,114 - root - INFO - Log file: /home/aleev/codestral_gen/codestral_ros2_gen/generation.log
2025-03-30 11:51:32,114 - root - INFO - Logger level: INFO
2025-03-30 11:51:32,114 - root - INFO - ==================================================
2025-03-30 11:51:32,116 - root.base_generator - INFO - Phase: INITIALIZATION -> Loading configuration.
2025-03-30 11:51:32,119 - root.metrics_handler - INFO - Metrics file: /home/aleev/codestral_gen/test_ws/network_scanner_metrics.jsonl
2025-03-30 11:51:32,120 - root.mistral_client - INFO - Create Mistral client with provided API key from the environment variable
2025-03-30 11:51:32,280 - root.base_generator - INFO - Phase: INITIALIZATION -> Environment OK, model and metrics handler initialized. Moving to GENERATION phase.
2025-03-30 11:51:32,280 - root.base_generator - INFO - Phase: GENERATION -> Starting generation process.
2025-03-30 11:51:32,280 - root.base_generator - INFO - Max attempts: 500
2025-03-30 11:51:32,280 - root.base_generator - INFO - Evaluation iterations: 30
2025-03-30 11:51:32,280 - root - INFO - The prompt has been prepared successfully:

                Your task is to generate a ROS2 node 'network_scanner_node.py' for network scanning that:
                  - Contains a NetworkScannerNode class which acts as a publisher.
                  - Accepts two runtime parameters:
                      - network (string): The target network to scan. This value is required and must not be empty.
                      - scan_period (int): The number of seconds between each repeated scan execution.
                      This value is required and must be greater than 0.
                  - Node must validate the input parameters and exit with error code 1 when provided invalid parameters.
                  - Executes the compiled nscan binary (subprocess.Popen(['nscan', network]) to perform network scanning.
                  - The node should call the binary as a subprocess, pass the network target as an argument,
                  capture its JSON output from '/tmp/nscan_results.json', and parse it to obtain the scan results.
                JSON example:
                {
                '8.8.8.8': {
                    'state': 'UP',
                    'response_time_ms': 1,
                    'error': null
                   },
                }
                  - If the JSON is not valid, node must log the error and exit with error code 2 without publishing any messages.
                  - Implements a loop that invokes the nscan binary every scan_period seconds. If a scan takes longer than scan_period,
                    the node should wait for the current scan to finish before starting a new one to avoid overlapping scans.
                  - Sends the parsed scan results as a ROS2 message on the 'network_status' topic.
                  - The message should be of type NetworkStatus, which is defined in the provided message files.
                  - It also must check for time JSON was last modified and if it is older than 3*scan_period
                it must send an empty addresses list using the NetworkStatus message until the JSON is updated.
                  - Node should log each its step (start, sending scan results, etc.) and any errors using the ros2 logger.
                  - Uses the ROS2 clock to set the timestamp in the message and adheres to ROS2 best practices.


--- Message File 1 ---
File: src/network_scanner/msg/IPStatus.msg
string ip_address
string status


--- Message File 2 ---
File: src/network_scanner/msg/NetworkStatus.msg
builtin_interfaces/Time stamp
IPStatus[] addresses


--- Test File ---
File: src/network_scanner/test/test_scanner_node.py
import rclpy
import time
import pytest
import os
import psutil
import subprocess
import json
import codestral_ros2_gen.utils.ros2_runner as ros2_runner
from network_scanner.msg import NetworkStatus


@pytest.fixture(scope="function")
def network_scanner_node(request, tmp_path, monkeypatch):
    """Fixture that sets up a network scanner node with the provided parameters."""
    if not rclpy.ok():
        rclpy.init()

    # Default parameters
    network = "4.2.2.2"
    scan_period = 3
    mock_nscan = False
    mock_nscan_text = """#!/bin/bash
    echo "NSCAN"
    """
    if hasattr(request, "param"):
        params = request.param
        network = params.get("network", network)
        scan_period = params.get("scan_period", scan_period)
        mock_nscan = params.get("mock_nscan", mock_nscan)
        mock_nscan_text = params.get("mock_nscan_text", mock_nscan_text)

    if mock_nscan:
        print("Using mock nscan binary")
        nscan_path = os.path.join(tmp_path, "nscan")
        with open(nscan_path, "w") as f:
            f.write(mock_nscan_text)
        os.chmod(nscan_path, 0o755)

        monkeypatch.setenv("PATH", f"{tmp_path}:{os.environ.get('PATH')}")
        print(f"nscan path: {nscan_path}")

    runner = ros2_runner.ROS2Runner(
        node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={network!r} -p scan_period:={scan_period}",
        test_command="",
    )
    runner.start_node()

    shell_process = psutil.Process(runner.node_process.pid)
    child_process = shell_process.children(recursive=False)[0]
    print(f"Child process PID: {child_process.pid}, command: {child_process.cmdline()}")

    yield child_process

    if runner.node_process:
        runner.kill_node()
        time.sleep(2)  # Allow time to shutdown


@pytest.fixture(scope="function")
def network_status_client():
    # Initialize RCL if needed
    if not rclpy.ok():
        rclpy.init()

    # Create a fresh client node for each test
    client_node = rclpy.create_node("network_status_client")
    received_msgs = []

    def callback(msg):
        received_msgs.append(msg)

    # Create subscription
    subscription = client_node.create_subscription(
        NetworkStatus, "/network_status", callback, 10
    )

    # Give some time for subscription to be established
    time.sleep(0.5)

    # Yield both the node and message buffer to the test
    yield client_node, received_msgs

    # Cleanup
    client_node.destroy_subscription(subscription)
    client_node.destroy_node()


def wait_for_messages(node, messages, count=2, timeout=30):
    """Helper function to wait for messages"""
    start_time = time.time()
    while time.time() - start_time < timeout and len(messages) < count:
        rclpy.spin_once(node, timeout_sec=0.1)

    # Print received messages for debugging
    print(f"Received {len(messages)} messages:")
    for i, msg in enumerate(messages):
        print(f"Message {i}:")
        for addr in msg.addresses:
            print(f"  IP: {addr.ip_address}, Status: {addr.status}")

    return len(messages) >= count


def validate_message(msg, expected_ips):
    """Helper function to validate message content"""
    found_ips = [addr.ip_address for addr in msg.addresses]
    for expected_ip in expected_ips:
        assert (
            expected_ip in found_ips
        ), f"Expected IP '{expected_ip}' not found. Found: {found_ips}"

    for addr in msg.addresses:
        assert addr.status == "UP", f"IP '{addr.ip_address}' is not UP: {addr.status}"


# ======= Tests =======


class TestBasic:
    """Test only the basic functionality of the network scanner node."""

    @pytest.mark.order(1)
    def test_nscan_app_start(self, tmpdir):
        # Start the network scanner app
        process = subprocess.Popen(
            ["nscan", "1.2.3.4", "-t", "1", "-o", tmpdir],
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
        )
        process.wait()
        assert process.returncode == 0

    @pytest.mark.order(2)
    def test_node_running(self, network_scanner_node):
        # Verify the node process is running.
        assert network_scanner_node.is_running()

    @pytest.mark.order(3)
    @pytest.mark.parametrize(
        "network_scanner_node,expected",
        [
            (
                {"network": "8.8.8.8", "scan_period": 3},
                {"expected_ip": ["8.8.8.8"], "expected_interval": 3},
            ),
            (
                {"network": "1.1.1.1, 8.8.4.4", "scan_period": 6},
                {"expected_ip": ["1.1.1.1", "8.8.4.4"], "expected_interval": 6},
            ),
        ],
        indirect=["network_scanner_node"],
    )
    def test_network_scanner_parameters(
        self, network_scanner_node, network_status_client, expected
    ):
        # Verify the node process is running
        assert network_scanner_node.is_running(), "Network scanner node is not running"

        client_node, received_msgs = network_status_client

        # Wait for at least 2 messages
        assert wait_for_messages(
            client_node, received_msgs, count=2, timeout=20
        ), f"Timeout waiting for messages. Received: {len(received_msgs)}"

        # Validate the content of the first two messages
        for msg in received_msgs[:2]:
            validate_message(msg, expected["expected_ip"])

        # Calculate the interval using ROS timestamps
        first_msg = received_msgs[0]
        second_msg = received_msgs[1]

        interval = (second_msg.stamp.sec - first_msg.stamp.sec) + (
            (second_msg.stamp.nanosec - first_msg.stamp.nanosec) * 1e-9
        )

        # Allow 1 second of tolerance for the interval check
        assert (
            abs(interval - expected["expected_interval"]) < 1
        ), f"Interval {interval:.2f} sec, expected ~{expected['expected_interval']} sec"

    @pytest.mark.order(4)
    def test_invalid_parameters(self):
        """
        Test that the network scanner node handles invalid parameters.
        When an empty network string or a non-positive scan_period is provided,
        the node should log an error and exit.
        """
        # Provide invalid parameters: empty network string and non-positive scan_period.
        invalid_network = "1.2.3.4.5"
        invalid_scan_period = 0
        runner = ros2_runner.ROS2Runner(
            node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={invalid_network!r} -p scan_period:={invalid_scan_period}",
            test_command="",
        )
        try:
            with pytest.raises(
                RuntimeError, match="Node process terminated immediately"
            ):
                runner.start_node()

        finally:
            runner.kill_node()

    @pytest.mark.order(5)
    def test_no_messages_without_publisher(self, network_status_client):
        """
        Test that no messages are received when there is no publisher on the network status topic.
        """
        client_node, received_msgs = network_status_client
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=5
        ), "Expected no messages, but received one."

    @pytest.mark.order(6)
    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.0.0.1",
                "scan_period": 1,
                "mock_nscan": True,
                "mock_nscan_text": f"""#!/usr/bin/env python3
import time
with open("/tmp/nscan_invocations.log", "a") as f:
    f.write(str(time.time()) + "\\n")
time.sleep(3)
exit(0)
""",
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_no_overlapping_scans(self, network_scanner_node):
        """
        Test that scans do not overlap when each scan takes longer than the scan_period.
        Uses a stub nscan binary that sleeps for 3 seconds, while scan_period is set to 1 second.
        """

        # Create a temporary file to record nscan invocations
        log_file = "/tmp/nscan_invocations.log"
        with open(log_file, "w") as f:
            f.write("")

        time.sleep(10)  # Wait to allow multiple scans to complete

        # Read the log file and verify that each invocation happened at least 3 seconds apart
        with open(log_file, "r") as log:
            # Read the times from the log file
            lines = log.readlines()
            if lines:
                times = [float(line.strip()) for line in lines]
                assert len(times) > 1, "Only one scan invocation recorded."
                times = sorted(times)
                # Check that each scan started at least 3 seconds after the previous one
                for t1, t2 in zip(times, times[1:]):
                    assert (
                        t2 - t1
                    ) >= 3, f"Overlap detected: Scan started after {t2-t1:.2f} sec, expected at least 3 sec between scans."

            else:
                pytest.fail("No scan invocations recorded.")


class TestAdditional:
    """
    Additional tests for the network scanner node - react on specific situations.
    """

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
        with pytest.raises(psutil.NoSuchProcess):
            print("Node process status:", ros_node.status())

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_outdated_json_results(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON result file is older than 20 seconds,
        the scanner node publishes a message with an empty addresses list.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        # Create outdated JSON file - will check from the first scan
        data = {"7.7.7.7": {"state": "UP", "response_time_ms": 15, "error": None}}
        with open(json_file_path, "w") as f:
            json.dump(data, f)

        # Backdate the modification time by 20 seconds
        old_time = time.time() - 20
        os.utime(json_file_path, (old_time, old_time))

        client_node, received_msgs = network_status_client
        assert wait_for_messages(
            client_node, received_msgs, count=3, timeout=10
        ), "Did not receive at least 3 messages in time"

        assert all(msg.addresses == [] for msg in received_msgs)


class TestFull(TestBasic, TestAdditional):
    """
    Complete test suite that runs all tests for the network scanner node,
    including both basic functionality and additional edge cases.
    """

    pass

2025-03-30 11:51:32,280 - root.base_generator - INFO -  Iteration 1 started.
2025-03-30 11:51:32,280 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 1) ---
2025-03-30 11:51:32,281 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 11:51:32,281 - root.generation_attempt - INFO - Initializing...
2025-03-30 11:51:32,281 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 11:51:32,281 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 11:51:32,281 - root.generation_attempt - INFO - Generating code...
2025-03-30 11:51:32,281 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 11:51:39,733 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 11:51:39,736 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 11:51:39,736 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 11:51:39,736 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1185, total_tokens=4534
2025-03-30 11:51:39,737 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 11:51:39,737 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 11:51:39,737 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 11:51:39,800 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 11:51:39,800 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 11:51:39,800 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 11:51:39,801 - root.generation_attempt - INFO - Saving code...
2025-03-30 11:51:39,801 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 11:51:39,801 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 11:51:39,801 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 11:51:39,801 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 11:51:39,801 - root.generation_attempt - INFO - Running tests...
2025-03-30 11:51:39,801 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 11:51:39,801 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 11:51:39,801 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 11:51:39,801 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 11:51:39,801 - root.ros2_runner - INFO - Running tests...
2025-03-30 11:53:28,174 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.77s]
.Child process PID: 2491759, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2491822, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2491884, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-136/test_no_overlapping_scans_netw0/nscan
Child process PID: 2492083, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-136/test_invalid_json_format_netwo0/nscan
Child process PID: 2492247, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7d3e24942d10>
network_scanner_node = psutil.Process(pid=2492247, name='python3', status='sleeping', started='11:53:18')
network_status_client = (<rclpy.node.Node object at 0x7d3e231a5990>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743324800, nanosec=730211526), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7d3e231a5990>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743324800, nanosec=730211526), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.06s (0:01:21)

stderr:
Process 2491759 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2491822 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2491884 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2492040 no longer exists
Process 2492083 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2492247 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 11:53:28,174 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 11:53:28,176 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 11:53:28,176 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 11:53:28,176 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 11:53:28,203 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1185
total_tokens       4534
2025-03-30 11:53:28,203 - root.base_generator - INFO - Iteration 1: Attempt 1 failed.
2025-03-30 11:53:28,203 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 1) ---
2025-03-30 11:53:28,204 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 11:53:28,204 - root.generation_attempt - INFO - Initializing...
2025-03-30 11:53:28,204 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 11:53:28,204 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 11:53:28,204 - root.generation_attempt - INFO - Generating code...
2025-03-30 11:53:28,204 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 11:53:35,571 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 11:53:35,574 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 11:53:35,575 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 11:53:35,575 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1177, total_tokens=4526
2025-03-30 11:53:35,575 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 11:53:35,575 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 11:53:35,575 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 11:53:35,653 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 11:53:35,653 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 11:53:35,653 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 11:53:35,653 - root.generation_attempt - INFO - Saving code...
2025-03-30 11:53:35,653 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 11:53:35,653 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 11:53:35,654 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 11:53:35,654 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 11:53:35,654 - root.generation_attempt - INFO - Running tests...
2025-03-30 11:53:35,654 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 11:53:35,654 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 11:53:35,654 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 11:53:35,654 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 11:53:35,654 - root.ros2_runner - INFO - Running tests...
2025-03-30 11:55:07,088 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2492611, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2492651, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2492740, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-137/test_no_overlapping_scans_netw0/nscan
Child process PID: 2492989, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-137/test_invalid_json_format_netwo0/nscan
Child process PID: 2493160, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x78bf2a048580>
network_scanner_node = psutil.Process(pid=2493160, name='python3', status='sleeping', started='11:54:52')
network_status_client = (<rclpy.node.Node object at 0x78bf28976020>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.02s (0:01:25)

stderr:
Process 2492611 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2492651 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2492740 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2492946 no longer exists
Process 2492989 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2493160 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 11:55:07,089 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 11:55:07,090 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 11:55:07,090 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 11:55:07,090 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 11:55:07,100 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       98.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1177
total_tokens       4526
2025-03-30 11:55:07,100 - root.base_generator - INFO - Iteration 1: Attempt 2 failed.
2025-03-30 11:55:07,100 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 1) ---
2025-03-30 11:55:07,100 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 11:55:07,100 - root.generation_attempt - INFO - Initializing...
2025-03-30 11:55:07,100 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 11:55:07,101 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 11:55:07,101 - root.generation_attempt - INFO - Generating code...
2025-03-30 11:55:07,101 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 11:55:14,471 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 11:55:14,474 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 11:55:14,474 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 11:55:14,475 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1185, total_tokens=4534
2025-03-30 11:55:14,475 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 11:55:14,475 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 11:55:14,475 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 11:55:14,557 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 11:55:14,557 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 11:55:14,557 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 11:55:14,557 - root.generation_attempt - INFO - Saving code...
2025-03-30 11:55:14,558 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 11:55:14,558 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 11:55:14,558 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 11:55:14,558 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 11:55:14,558 - root.generation_attempt - INFO - Running tests...
2025-03-30 11:55:14,558 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 11:55:14,558 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 11:55:14,558 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 11:55:14,558 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 11:55:14,558 - root.ros2_runner - INFO - Running tests...
2025-03-30 11:57:06,926 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.77s]
.Child process PID: 2493614, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2493660, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2493727, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-138/test_no_overlapping_scans_netw0/nscan
Child process PID: 2493906, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-138/test_invalid_json_format_netwo0/nscan
Child process PID: 2494054, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7d75bb046d10>
network_scanner_node = psutil.Process(pid=2494054, name='python3', status='sleeping', started='11:56:52')
network_status_client = (<rclpy.node.Node object at 0x7d75bb0448b0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.07s (0:01:25)

stderr:
Process 2493614 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2493660 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2493727 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2493868 no longer exists
Process 2493906 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2494054 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 11:57:06,926 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 11:57:06,927 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 11:57:06,927 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 11:57:06,927 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 11:57:06,937 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1185
total_tokens       4534
2025-03-30 11:57:06,937 - root.base_generator - INFO - Iteration 1: Attempt 3 failed.
2025-03-30 11:57:06,938 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 1) ---
2025-03-30 11:57:06,938 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 11:57:06,938 - root.generation_attempt - INFO - Initializing...
2025-03-30 11:57:06,938 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 11:57:06,938 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 11:57:06,938 - root.generation_attempt - INFO - Generating code...
2025-03-30 11:57:06,938 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 11:57:13,730 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 11:57:13,733 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 11:57:13,734 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 11:57:13,734 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1137, total_tokens=4486
2025-03-30 11:57:13,734 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 11:57:13,734 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 11:57:13,734 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 11:57:13,816 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 11:57:13,816 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 11:57:13,816 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 11:57:13,816 - root.generation_attempt - INFO - Saving code...
2025-03-30 11:57:13,817 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 11:57:13,817 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 11:57:13,817 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 11:57:13,817 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 11:57:13,817 - root.generation_attempt - INFO - Running tests...
2025-03-30 11:57:13,817 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 11:57:13,817 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 11:57:13,817 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 11:57:13,817 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 11:57:13,817 - root.ros2_runner - INFO - Running tests...
2025-03-30 11:58:41,901 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.73s]
.Child process PID: 2494352, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2494393, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2494509, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-139/test_no_overlapping_scans_netw0/nscan
Child process PID: 2494674, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-139/test_invalid_json_format_netwo0/nscan
Child process PID: 2494790, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7528a03e4e80>
network_scanner_node = psutil.Process(pid=2494790, name='python3', status='sleeping', started='11:58:27')
network_status_client = (<rclpy.node.Node object at 0x75289f699a50>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2494352 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2494393 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2494509 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2494614 no longer exists
Process 2494674 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2494790 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 11:58:41,902 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 11:58:41,902 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 11:58:41,903 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 11:58:41,903 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 11:58:41,912 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1137
total_tokens       4486
2025-03-30 11:58:41,912 - root.base_generator - INFO - Iteration 1: Attempt 4 failed.
2025-03-30 11:58:41,913 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 1) ---
2025-03-30 11:58:41,913 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 11:58:41,913 - root.generation_attempt - INFO - Initializing...
2025-03-30 11:58:41,913 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 11:58:41,913 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 11:58:41,913 - root.generation_attempt - INFO - Generating code...
2025-03-30 11:58:41,913 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 11:58:50,261 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 11:58:50,265 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 11:58:50,265 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 11:58:50,265 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1150, total_tokens=4499
2025-03-30 11:58:50,265 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 11:58:50,265 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 11:58:50,266 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 11:58:50,345 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Saving code...
2025-03-30 11:58:50,346 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Running tests...
2025-03-30 11:58:50,346 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 11:58:50,347 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 11:58:50,347 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 11:58:50,347 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 11:58:50,347 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:00:42,933 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.73s]
.Child process PID: 2495239, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2495280, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2495396, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-140/test_no_overlapping_scans_netw0/nscan
Child process PID: 2495556, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-140/test_invalid_json_format_netwo0/nscan
Child process PID: 2495673, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e31e2a44670>
network_scanner_node = psutil.Process(pid=2495673, name='python3', status='sleeping', started='12:00:28')
network_status_client = (<rclpy.node.Node object at 0x7e31e1af9f30>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.38s (0:01:25)

stderr:
Process 2495239 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2495280 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2495396 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2495493 no longer exists
Process 2495556 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2495673 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:00:42,934 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:00:42,935 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:00:42,935 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:00:42,935 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:00:42,944 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       121.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1150
total_tokens       4499
2025-03-30 12:00:42,945 - root.base_generator - INFO - Iteration 1: Attempt 5 failed.
2025-03-30 12:00:42,945 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 1) ---
2025-03-30 12:00:42,945 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:00:42,945 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:00:42,945 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:00:42,945 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:00:42,945 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:00:42,946 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:00:51,638 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:00:51,642 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:00:51,642 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:00:51,642 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1135, total_tokens=4484
2025-03-30 12:00:51,642 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:00:51,642 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:00:51,643 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:00:51,724 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:00:51,724 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:00:51,724 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:00:51,725 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:00:51,725 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:00:51,725 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:00:51,725 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:00:51,725 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:00:51,725 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:00:51,725 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:00:51,725 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:00:51,725 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:00:51,726 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:00:51,726 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:02:39,978 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.71s]
.Child process PID: 2496123, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2496164, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2496282, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-141/test_no_overlapping_scans_netw0/nscan
Child process PID: 2496437, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-141/test_invalid_json_format_netwo0/nscan
Child process PID: 2496559, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x70f7bdf42d10>
network_scanner_node = psutil.Process(pid=2496559, name='python3', status='sleeping', started='12:02:29')
network_status_client = (<rclpy.node.Node object at 0x70f7bdf40850>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743325352, nanosec=554268476), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x70f7bdf40850>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743325352, nanosec=554268476), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.01s (0:01:21)

stderr:
Process 2496123 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2496164 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2496282 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2496378 no longer exists
Process 2496437 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2496559 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:02:39,979 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:02:39,980 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:02:39,980 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:02:39,980 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:02:39,990 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       117.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1135
total_tokens       4484
2025-03-30 12:02:39,990 - root.base_generator - INFO - Iteration 1: Attempt 6 failed.
2025-03-30 12:02:39,990 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 1) ---
2025-03-30 12:02:39,990 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:02:39,990 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:02:39,991 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:02:39,991 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:02:39,991 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:02:39,991 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:02:47,329 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:02:47,333 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:02:47,333 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:02:47,333 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1173, total_tokens=4522
2025-03-30 12:02:47,333 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:02:47,334 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:02:47,334 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:02:47,415 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:02:47,415 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:02:47,415 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:02:47,415 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:02:47,416 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:02:47,416 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:02:47,416 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:02:47,416 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:02:47,416 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:02:47,416 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:02:47,416 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:02:47,416 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:02:47,416 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:02:47,416 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:04:19,007 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.73s]
.Child process PID: 2496873, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2496907, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2497046, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-142/test_no_overlapping_scans_netw0/nscan
Child process PID: 2497209, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-142/test_invalid_json_format_netwo0/nscan
Child process PID: 2497302, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e9cb303b310>
network_scanner_node = psutil.Process(pid=2497302, name='python3', status='sleeping', started='12:04:04')
network_status_client = (<rclpy.node.Node object at 0x7e9cb1956050>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2496873 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2496907 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2497046 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2497117 no longer exists
Process 2497209 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2497302 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:04:19,007 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:04:19,008 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:04:19,008 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:04:19,008 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:04:19,020 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       99.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1173
total_tokens       4522
2025-03-30 12:04:19,020 - root.base_generator - INFO - Iteration 1: Attempt 7 failed.
2025-03-30 12:04:19,021 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 1) ---
2025-03-30 12:04:19,021 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:04:19,021 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:04:19,021 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:04:19,021 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:04:19,022 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:04:19,022 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:04:26,454 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:04:26,457 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:04:26,457 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:04:26,458 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1185, total_tokens=4534
2025-03-30 12:04:26,458 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:04:26,458 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:04:26,458 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:04:26,539 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:04:26,539 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:04:26,539 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:04:26,539 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:04:26,540 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:04:26,540 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:04:26,540 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:04:26,540 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:04:26,540 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:04:26,540 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:04:26,540 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:04:26,540 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:04:26,540 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:04:26,540 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:06:29,310 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.74s]
.Child process PID: 2497751, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2497790, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2497927, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-143/test_no_overlapping_scans_netw0/nscan
Child process PID: 2498095, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-143/test_invalid_json_format_netwo0/nscan
Child process PID: 2498183, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-143/test_outdated_json_results_net0/nscan
Child process PID: 2498252, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.51s (0:01:35)

stderr:
Process 2497751 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2497790 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2497927 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2498004 no longer exists
Process 2498095 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2498252 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:06:29,311 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:06:29,311 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 12:06:29,311 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 12:06:29,311 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 12:06:29,318 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.3
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1185
total_tokens       4534
2025-03-30 12:06:29,319 - root.base_generator - INFO - Iteration 1: Successful attempt achieved.
2025-03-30 12:06:29,319 - root.base_generator - INFO - Iteration 1 finished.
2025-03-30 12:06:29,319 - root.base_generator - INFO -  Iteration 2 started.
2025-03-30 12:06:29,319 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 2) ---
2025-03-30 12:06:29,319 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:06:29,319 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:06:29,319 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:06:29,319 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:06:29,319 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:06:29,319 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:06:36,010 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:06:36,014 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:06:36,014 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:06:36,014 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1080, total_tokens=4429
2025-03-30 12:06:36,014 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:06:36,014 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:06:36,014 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:06:36,135 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:06:36,135 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:06:36,135 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:06:36,135 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:06:36,135 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:06:36,136 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:06:36,136 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:06:36,136 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:06:36,136 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:06:36,136 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:06:36,136 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:06:36,136 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:06:36,136 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:06:36,136 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:07:06,827 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.E
==================================== ERRORS ====================================
_________________ ERROR at setup of TestFull.test_node_running _________________

request = <SubRequest 'network_scanner_node' for <Function test_node_running>>
tmp_path = PosixPath('/tmp/pytest-of-aleev/pytest-144/test_node_running0')
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x798b80146ef0>

    @pytest.fixture(scope="function")
    def network_scanner_node(request, tmp_path, monkeypatch):
        """Fixture that sets up a network scanner node with the provided parameters."""
        if not rclpy.ok():
            rclpy.init()

        # Default parameters
        network = "4.2.2.2"
        scan_period = 3
        mock_nscan = False
        mock_nscan_text = """#!/bin/bash
        echo "NSCAN"
        """
        if hasattr(request, "param"):
            params = request.param
            network = params.get("network", network)
            scan_period = params.get("scan_period", scan_period)
            mock_nscan = params.get("mock_nscan", mock_nscan)
            mock_nscan_text = params.get("mock_nscan_text", mock_nscan_text)

        if mock_nscan:
            print("Using mock nscan binary")
            nscan_path = os.path.join(tmp_path, "nscan")
            with open(nscan_path, "w") as f:
                f.write(mock_nscan_text)
            os.chmod(nscan_path, 0o755)

            monkeypatch.setenv("PATH", f"{tmp_path}:{os.environ.get('PATH')}")
            print(f"nscan path: {nscan_path}")

        runner = ros2_runner.ROS2Runner(
            node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={network!r} -p scan_period:={scan_period}",
            test_command="",
        )
>       runner.start_node()

src/network_scanner/test/test_scanner_node.py:46:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <codestral_ros2_gen.utils.ros2_runner.ROS2Runner object at 0x798b80146980>

    def start_node(self) -> None:
        """
        Start the ROS2 node and verify it launched successfully.

        If "skip / SKIP" is found in the node_command, the node is not started.

        Raises:
            RuntimeError: If the node fails to start or register with ROS2.
        """
        logger.info("Starting the ROS2 node...")
        if "skip" in self.node_command.lower():
            logger.info("Skipping node start as requested.")
            return
        else:
            self.node_process = subprocess.Popen(
                self.node_command,
                shell=True,
                executable="/bin/bash",
                stderr=subprocess.PIPE,
                stdout=subprocess.PIPE,
                text=True,
            )

            # Wait briefly for node to initialize
            time.sleep(2)

            # Check if process is still running
            if self.node_process.poll() is not None:
                # Process terminated - get error output
                stdout, stderr = self.node_process.communicate()
                error_msg = f"Node process terminated immediately.\nStdout: {stdout}\nStderr: {stderr}"
>               raise RuntimeError(error_msg)
E               RuntimeError: Node process terminated immediately.
E               Stdout: [ros2run]: Process exited with failure 1
E
E               Stderr: Traceback (most recent call last):
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 116, in <module>
E                   main()
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 109, in main
E                   node = NetworkScannerNode()
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 39, in __init__
E                   qos_profile = QoSProfile(
E                 File "/opt/ros/humble/local/lib/python3.10/dist-packages/rclpy/qos.py", line 82, in __init__
E                   raise InvalidQoSProfileException('History and/or depth settings are required.')
E               rclpy.qos.InvalidQoSProfileException: ('Invalid QoSProfile', 'History and/or depth settings are required.')

../codestral_ros2_gen/src/codestral_ros2_gen/utils/ros2_runner.py:79: RuntimeError
=========================== short test summary info ============================
ERROR src/network_scanner/test/test_scanner_node.py::TestFull::test_node_running
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 passed, 1 error in 3.59s

stderr:

2025-03-30 12:07:06,827 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:07:06,828 - root.ros2_runner - INFO - Tests failed: 0, passed: 1, skipped: 0
2025-03-30 12:07:06,829 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:07:06,829 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:07:06,838 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       37.5
success            False
final_state        TEST
tests_passed       1
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1080
total_tokens       4429
2025-03-30 12:07:06,838 - root.base_generator - INFO - Iteration 2: Attempt 1 failed.
2025-03-30 12:07:06,838 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 2) ---
2025-03-30 12:07:06,838 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:07:06,839 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:07:06,839 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:07:06,839 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:07:06,839 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:07:06,839 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:07:13,921 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:07:13,924 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:07:13,924 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:07:13,924 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1137, total_tokens=4486
2025-03-30 12:07:13,924 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:07:13,924 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:07:13,924 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:07:13,994 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:07:13,994 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:07:13,994 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:07:13,994 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:07:13,994 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:07:13,995 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:07:13,995 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:07:13,995 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:07:13,995 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:07:13,995 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:07:13,995 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:07:13,995 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:07:13,995 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:07:13,995 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:07:44,690 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.E
==================================== ERRORS ====================================
_________________ ERROR at setup of TestFull.test_node_running _________________

request = <SubRequest 'network_scanner_node' for <Function test_node_running>>
tmp_path = PosixPath('/tmp/pytest-of-aleev/pytest-145/test_node_running0')
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x72c8e1246ef0>

    @pytest.fixture(scope="function")
    def network_scanner_node(request, tmp_path, monkeypatch):
        """Fixture that sets up a network scanner node with the provided parameters."""
        if not rclpy.ok():
            rclpy.init()

        # Default parameters
        network = "4.2.2.2"
        scan_period = 3
        mock_nscan = False
        mock_nscan_text = """#!/bin/bash
        echo "NSCAN"
        """
        if hasattr(request, "param"):
            params = request.param
            network = params.get("network", network)
            scan_period = params.get("scan_period", scan_period)
            mock_nscan = params.get("mock_nscan", mock_nscan)
            mock_nscan_text = params.get("mock_nscan_text", mock_nscan_text)

        if mock_nscan:
            print("Using mock nscan binary")
            nscan_path = os.path.join(tmp_path, "nscan")
            with open(nscan_path, "w") as f:
                f.write(mock_nscan_text)
            os.chmod(nscan_path, 0o755)

            monkeypatch.setenv("PATH", f"{tmp_path}:{os.environ.get('PATH')}")
            print(f"nscan path: {nscan_path}")

        runner = ros2_runner.ROS2Runner(
            node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={network!r} -p scan_period:={scan_period}",
            test_command="",
        )
>       runner.start_node()

src/network_scanner/test/test_scanner_node.py:46:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <codestral_ros2_gen.utils.ros2_runner.ROS2Runner object at 0x72c8e1246980>

    def start_node(self) -> None:
        """
        Start the ROS2 node and verify it launched successfully.

        If "skip / SKIP" is found in the node_command, the node is not started.

        Raises:
            RuntimeError: If the node fails to start or register with ROS2.
        """
        logger.info("Starting the ROS2 node...")
        if "skip" in self.node_command.lower():
            logger.info("Skipping node start as requested.")
            return
        else:
            self.node_process = subprocess.Popen(
                self.node_command,
                shell=True,
                executable="/bin/bash",
                stderr=subprocess.PIPE,
                stdout=subprocess.PIPE,
                text=True,
            )

            # Wait briefly for node to initialize
            time.sleep(2)

            # Check if process is still running
            if self.node_process.poll() is not None:
                # Process terminated - get error output
                stdout, stderr = self.node_process.communicate()
                error_msg = f"Node process terminated immediately.\nStdout: {stdout}\nStderr: {stderr}"
>               raise RuntimeError(error_msg)
E               RuntimeError: Node process terminated immediately.
E               Stdout: [ros2run]: Process exited with failure 1
E
E               Stderr: Traceback (most recent call last):
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 7, in <module>
E                   from rclpy.exceptions import ParameterNotDeclaredException, ParameterValueException
E               ImportError: cannot import name 'ParameterValueException' from 'rclpy.exceptions' (/opt/ros/humble/local/lib/python3.10/dist-packages/rclpy/exceptions.py)

../codestral_ros2_gen/src/codestral_ros2_gen/utils/ros2_runner.py:79: RuntimeError
=========================== short test summary info ============================
ERROR src/network_scanner/test/test_scanner_node.py::TestFull::test_node_running
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 passed, 1 error in 3.59s

stderr:

2025-03-30 12:07:44,690 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:07:44,691 - root.ros2_runner - INFO - Tests failed: 0, passed: 1, skipped: 0
2025-03-30 12:07:44,691 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:07:44,692 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:07:44,701 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       37.9
success            False
final_state        TEST
tests_passed       1
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1137
total_tokens       4486
2025-03-30 12:07:44,701 - root.base_generator - INFO - Iteration 2: Attempt 2 failed.
2025-03-30 12:07:44,701 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 2) ---
2025-03-30 12:07:44,701 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:07:44,701 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:07:44,702 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:07:44,702 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:07:44,702 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:07:44,702 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:07:52,360 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:07:52,363 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:07:52,364 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:07:52,364 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1220, total_tokens=4569
2025-03-30 12:07:52,364 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:07:52,364 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:07:52,364 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:07:52,446 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:07:52,446 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:07:52,446 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:07:52,447 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:07:52,447 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:07:52,447 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:07:52,447 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:07:52,447 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:07:52,447 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:07:52,447 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:07:52,447 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:07:52,447 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:07:52,448 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:07:52,448 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:09:44,825 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2499421, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2499460, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2499524, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-146/test_no_overlapping_scans_netw0/nscan
Child process PID: 2499774, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-146/test_invalid_json_format_netwo0/nscan
Child process PID: 2499921, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b3bf32431f0>
network_scanner_node = psutil.Process(pid=2499921, name='python3', status='sleeping', started='12:09:30')
network_status_client = (<rclpy.node.Node object at 0x7b3bf22f5960>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.09s (0:01:25)

stderr:
Process 2499421 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2499460 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2499524 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2499735 no longer exists
Process 2499774 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2499921 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:09:44,826 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:09:44,826 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:09:44,827 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:09:44,827 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:09:44,836 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1220
total_tokens       4569
2025-03-30 12:09:44,837 - root.base_generator - INFO - Iteration 2: Attempt 3 failed.
2025-03-30 12:09:44,837 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 2) ---
2025-03-30 12:09:44,837 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:09:44,837 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:09:44,837 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:09:44,837 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:09:44,837 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:09:44,838 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:09:52,022 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:09:52,026 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:09:52,026 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:09:52,026 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1166, total_tokens=4515
2025-03-30 12:09:52,026 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:09:52,027 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:09:52,027 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:09:52,108 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:09:52,108 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:09:52,109 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:09:52,109 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:09:52,110 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:09:52,110 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:09:52,110 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:11:44,458 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.77s]
.Child process PID: 2500360, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2500411, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2500469, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-147/test_no_overlapping_scans_netw0/nscan
Child process PID: 2500656, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-147/test_invalid_json_format_netwo0/nscan
Child process PID: 2500804, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7bbaaaa3ee30>
network_scanner_node = psutil.Process(pid=2500804, name='python3', status='sleeping', started='12:11:30')
network_status_client = (<rclpy.node.Node object at 0x7bbaa9ab5d80>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2500360 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2500411 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2500469 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2500618 no longer exists
Process 2500656 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2500804 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:11:44,459 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:11:44,459 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:11:44,460 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:11:44,460 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:11:44,470 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1166
total_tokens       4515
2025-03-30 12:11:44,470 - root.base_generator - INFO - Iteration 2: Attempt 4 failed.
2025-03-30 12:11:44,471 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 2) ---
2025-03-30 12:11:44,471 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:11:44,471 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:11:44,471 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:11:44,471 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:11:44,471 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:11:44,471 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:11:51,475 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:11:51,479 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:11:51,479 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:11:51,479 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1129, total_tokens=4478
2025-03-30 12:11:51,479 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:11:51,479 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:11:51,480 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:11:51,561 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:11:51,561 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:11:51,562 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:11:51,562 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:11:51,562 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:11:51,562 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:11:51,562 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:11:51,562 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:11:51,562 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:11:51,562 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:11:51,563 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:11:51,563 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:11:51,563 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:11:51,563 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:13:19,462 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2501104, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2501145, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2501262, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-148/test_no_overlapping_scans_netw0/nscan
Child process PID: 2501420, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-148/test_invalid_json_format_netwo0/nscan
Child process PID: 2501542, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x70971be42d10>
network_scanner_node = psutil.Process(pid=2501542, name='python3', status='sleeping', started='12:13:05')
network_status_client = (<rclpy.node.Node object at 0x70971be40640>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2501104 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2501145 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2501262 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2501359 no longer exists
Process 2501420 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2501542 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:13:19,462 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:13:19,463 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:13:19,463 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:13:19,463 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:13:19,473 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1129
total_tokens       4478
2025-03-30 12:13:19,473 - root.base_generator - INFO - Iteration 2: Attempt 5 failed.
2025-03-30 12:13:19,473 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 2) ---
2025-03-30 12:13:19,474 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:13:19,474 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:13:19,474 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:13:19,474 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:13:19,474 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:13:19,474 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:13:26,697 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:13:26,701 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:13:26,701 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:13:26,701 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1178, total_tokens=4527
2025-03-30 12:13:26,701 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:13:26,701 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:13:26,702 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:13:26,785 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:13:26,786 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:13:26,786 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:13:26,787 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:13:26,787 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:13:26,787 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:15:19,110 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.71s]
.Child process PID: 2501991, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2502031, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2502116, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-149/test_no_overlapping_scans_netw0/nscan
Child process PID: 2502281, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-149/test_invalid_json_format_netwo0/nscan
Child process PID: 2502428, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x78ab74e40580>
network_scanner_node = psutil.Process(pid=2502428, name='python3', status='sleeping', started='12:15:04')
network_status_client = (<rclpy.node.Node object at 0x78ab74e40c70>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2501991 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2502031 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2502116 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2502241 no longer exists
Process 2502281 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2502428 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:15:19,111 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:15:19,111 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:15:19,111 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:15:19,112 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:15:19,119 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1178
total_tokens       4527
2025-03-30 12:15:19,119 - root.base_generator - INFO - Iteration 2: Attempt 6 failed.
2025-03-30 12:15:19,119 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 2) ---
2025-03-30 12:15:19,119 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:15:19,120 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:15:19,120 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:15:19,120 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:15:19,120 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:15:19,120 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:15:26,215 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:15:26,218 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:15:26,218 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:15:26,218 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1141, total_tokens=4490
2025-03-30 12:15:26,219 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:15:26,219 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:15:26,219 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:15:26,297 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:15:26,297 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:15:26,297 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:15:26,297 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:15:26,297 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:15:26,297 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:15:26,298 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:15:26,298 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:15:26,298 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:15:26,298 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:15:26,298 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:15:26,298 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:15:26,298 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:15:26,298 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:16:50,073 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2502729, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2502768, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2502886, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-150/test_no_overlapping_scans_netw0/nscan
Child process PID: 2503063, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-150/test_invalid_json_format_netwo0/nscan
Child process PID: 2503162, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e56feb3c580>
network_scanner_node = psutil.Process(pid=2503162, name='python3', status='sleeping', started='12:16:39')
network_status_client = (<rclpy.node.Node object at 0x7e56feb3e950>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743326202, nanosec=642243491), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7e56feb3e950>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743326202, nanosec=642243491), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.07s (0:01:21)

stderr:
Process 2502729 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2502768 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2502886 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2502978 no longer exists
Process 2503063 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2503162 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:16:50,073 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:16:50,074 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:16:50,074 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:16:50,074 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:16:50,085 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1141
total_tokens       4490
2025-03-30 12:16:50,085 - root.base_generator - INFO - Iteration 2: Attempt 7 failed.
2025-03-30 12:16:50,085 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 2) ---
2025-03-30 12:16:50,085 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:16:50,085 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:16:50,085 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:16:50,085 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:16:50,086 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:16:50,086 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:16:57,253 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:16:57,257 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:16:57,257 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:16:57,257 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1153, total_tokens=4502
2025-03-30 12:16:57,258 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:16:57,258 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:16:57,258 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:16:57,338 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:16:57,338 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:16:57,338 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:16:57,338 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:16:57,339 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:16:57,339 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:16:57,339 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:16:57,339 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:16:57,339 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:16:57,339 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:16:57,339 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:16:57,339 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:16:57,339 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:16:57,340 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:18:49,654 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2503598, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2503646, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2503708, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-151/test_no_overlapping_scans_netw0/nscan
Child process PID: 2503894, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-151/test_invalid_json_format_netwo0/nscan
Child process PID: 2504042, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7de1c563c580>
network_scanner_node = psutil.Process(pid=2504042, name='python3', status='sleeping', started='12:18:35')
network_status_client = (<rclpy.node.Node object at 0x7de1c563f0a0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2503598 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2503646 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2503708 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2503857 no longer exists
Process 2503894 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2504042 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:18:49,655 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:18:49,656 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:18:49,656 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:18:49,656 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:18:49,668 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1153
total_tokens       4502
2025-03-30 12:18:49,669 - root.base_generator - INFO - Iteration 2: Attempt 8 failed.
2025-03-30 12:18:49,669 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 2) ---
2025-03-30 12:18:49,669 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:18:49,669 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:18:49,669 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:18:49,669 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:18:49,670 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:18:49,670 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:18:52,983 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:18:52,986 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:18:52,987 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:18:52,987 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=497, total_tokens=3846
2025-03-30 12:18:52,987 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:18:52,987 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:18:52,987 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:18:52,987 - root.code_parser - WARNING - No valid '```python' code markers found in response
2025-03-30 12:18:52,988 - root.generation_attempt - ERROR - Exception on stage PARSE:

Parsing failed, no code returned.

2025-03-30 12:18:52,988 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: FAILURE
2025-03-30 12:18:52,997 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       3.3
success            False
final_state        PARSE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  497
total_tokens       3846
2025-03-30 12:18:52,998 - root.base_generator - INFO - Iteration 2: Attempt 9 failed.
2025-03-30 12:18:52,998 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 2) ---
2025-03-30 12:18:52,998 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:18:52,998 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:18:52,998 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:18:52,998 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:18:52,998 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:18:52,999 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:19:00,114 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:19:00,118 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:19:00,118 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:19:00,119 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1182, total_tokens=4531
2025-03-30 12:19:00,119 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:19:00,119 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:19:00,119 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:19:00,201 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:19:00,202 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:19:00,202 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:19:00,203 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:19:00,203 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:19:00,203 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:19:00,203 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:20:52,546 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2504496, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2504537, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2504621, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-152/test_no_overlapping_scans_netw0/nscan
Child process PID: 2504784, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-152/test_invalid_json_format_netwo0/nscan
Child process PID: 2504931, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7da634345030>
network_scanner_node = psutil.Process(pid=2504931, name='python3', status='sleeping', started='12:20:38')
network_status_client = (<rclpy.node.Node object at 0x7da634347400>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2504496 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2504537 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2504621 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2504746 no longer exists
Process 2504784 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2504931 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:20:52,546 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:20:52,547 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:20:52,547 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:20:52,548 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:20:52,558 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1182
total_tokens       4531
2025-03-30 12:20:52,558 - root.base_generator - INFO - Iteration 2: Attempt 10 failed.
2025-03-30 12:20:52,558 - root.base_generator - INFO - --- Starting Attempt 11 (Iteration 2) ---
2025-03-30 12:20:52,559 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:20:52,559 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:20:52,559 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:20:52,559 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:20:52,559 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:20:52,559 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:20:59,691 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:20:59,695 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:20:59,695 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:20:59,695 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1179, total_tokens=4528
2025-03-30 12:20:59,695 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:20:59,695 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:20:59,696 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:20:59,841 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:20:59,841 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:20:59,841 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:20:59,841 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:20:59,842 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:20:59,842 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:20:59,842 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:20:59,842 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:20:59,842 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:20:59,842 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:20:59,842 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:20:59,842 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:20:59,842 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:20:59,842 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:22:38,197 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.76s]
.Child process PID: 2505234, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2505271, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2505390, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-153/test_no_overlapping_scans_netw0/nscan
Child process PID: 2505569, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-153/test_invalid_json_format_netwo0/nscan
Child process PID: 2505666, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-153/test_outdated_json_results_net0/nscan
Child process PID: 2505718, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.79s (0:01:35)

stderr:
Process 2505234 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2505271 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2505390 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2505485 no longer exists
Process 2505569 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2505718 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:22:38,198 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:22:38,198 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 12:22:38,198 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 12:22:38,199 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 12:22:38,209 - root.base_generator - INFO - Attempt 11 finished with metrics:
metric             value
-----------------  -------
attempt_time       105.6
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1179
total_tokens       4528
2025-03-30 12:22:38,209 - root.base_generator - INFO - Iteration 2: Successful attempt achieved.
2025-03-30 12:22:38,209 - root.base_generator - INFO - Iteration 2 finished.
2025-03-30 12:22:38,210 - root.base_generator - INFO -  Iteration 3 started.
2025-03-30 12:22:38,210 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 3) ---
2025-03-30 12:22:38,210 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:22:38,210 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:22:38,210 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:22:38,210 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:22:38,210 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:22:38,211 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:22:45,460 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:22:45,463 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:22:45,463 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:22:45,464 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1199, total_tokens=4548
2025-03-30 12:22:45,464 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:22:45,464 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:22:45,464 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:22:45,548 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:22:45,548 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:22:45,548 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:22:45,548 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:22:45,548 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:22:45,548 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:22:45,548 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:22:45,548 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:22:45,549 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:22:45,549 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:22:45,549 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:22:45,549 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:22:45,549 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:22:45,549 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:24:48,584 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2506172, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2506232, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2506354, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-154/test_no_overlapping_scans_netw0/nscan
Child process PID: 2506541, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-154/test_invalid_json_format_netwo0/nscan
Child process PID: 2506630, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-154/test_outdated_json_results_net0/nscan
Child process PID: 2506721, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.81s (0:01:35)

stderr:
Process 2506172 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2506232 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2506354 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2506473 no longer exists
Process 2506541 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2506721 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:24:48,585 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:24:48,585 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 12:24:48,586 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 12:24:48,586 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 12:24:48,596 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1199
total_tokens       4548
2025-03-30 12:24:48,596 - root.base_generator - INFO - Iteration 3: Successful attempt achieved.
2025-03-30 12:24:48,596 - root.base_generator - INFO - Iteration 3 finished.
2025-03-30 12:24:48,596 - root.base_generator - INFO -  Iteration 4 started.
2025-03-30 12:24:48,597 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 4) ---
2025-03-30 12:24:48,597 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:24:48,597 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:24:48,597 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:24:48,597 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:24:48,597 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:24:48,597 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:24:55,760 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:24:55,763 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:24:55,763 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:24:55,764 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1186, total_tokens=4535
2025-03-30 12:24:55,764 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:24:55,764 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:24:55,764 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:24:55,842 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:24:55,842 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:24:55,842 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:24:55,842 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:24:55,843 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:24:55,843 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:24:55,843 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:24:55,843 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:24:55,843 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:24:55,843 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:24:55,843 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:24:55,843 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:24:55,843 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:24:55,843 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:26:48,161 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.78s]
.Child process PID: 2507130, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2507221, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2507286, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-155/test_no_overlapping_scans_netw0/nscan
Child process PID: 2507474, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-155/test_invalid_json_format_netwo0/nscan
Child process PID: 2507613, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x763a0e744640>
network_scanner_node = psutil.Process(pid=2507613, name='python3', status='sleeping', started='12:26:34')
network_status_client = (<rclpy.node.Node object at 0x763a0e745120>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.02s (0:01:25)

stderr:
Process 2507130 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2507221 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2507286 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2507434 no longer exists
Process 2507474 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2507613 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:26:48,161 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:26:48,162 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:26:48,162 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:26:48,162 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:26:48,173 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1186
total_tokens       4535
2025-03-30 12:26:48,173 - root.base_generator - INFO - Iteration 4: Attempt 1 failed.
2025-03-30 12:26:48,173 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 4) ---
2025-03-30 12:26:48,173 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:26:48,173 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:26:48,173 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:26:48,174 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:26:48,174 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:26:48,174 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:26:55,420 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:26:55,423 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:26:55,423 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:26:55,423 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1162, total_tokens=4511
2025-03-30 12:26:55,423 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:26:55,423 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:26:55,423 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:26:55,489 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:26:55,489 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:26:55,489 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:26:55,489 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:26:55,489 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:26:55,490 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:26:55,490 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:26:55,490 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:26:55,490 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:26:55,490 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:26:55,490 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:26:55,490 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:26:55,490 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:26:55,490 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:28:23,173 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2507895, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2507960, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2508018, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-156/test_no_overlapping_scans_netw0/nscan
Child process PID: 2508215, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-156/test_invalid_json_format_netwo0/nscan
Child process PID: 2508357, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7cd24b93b310>
network_scanner_node = psutil.Process(pid=2508357, name='python3', status='sleeping', started='12:28:09')
network_status_client = (<rclpy.node.Node object at 0x7cd24a1a1930>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.07s (0:01:25)

stderr:
Process 2507895 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2507960 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2508018 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2508173 no longer exists
Process 2508215 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2508357 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:28:23,174 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:28:23,175 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:28:23,175 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:28:23,175 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:28:23,186 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1162
total_tokens       4511
2025-03-30 12:28:23,186 - root.base_generator - INFO - Iteration 4: Attempt 2 failed.
2025-03-30 12:28:23,186 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 4) ---
2025-03-30 12:28:23,187 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:28:23,187 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:28:23,187 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:28:23,187 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:28:23,187 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:28:23,187 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:28:30,524 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:28:30,527 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:28:30,528 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:28:30,528 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1181, total_tokens=4530
2025-03-30 12:28:30,528 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:28:30,528 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:28:30,528 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:28:30,612 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:28:30,612 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:28:30,612 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:28:30,612 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:28:30,612 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:28:30,612 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:28:30,612 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:28:30,612 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:28:30,613 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:28:30,613 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:28:30,613 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:28:30,613 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:28:30,613 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:28:30,613 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:30:15,869 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.76s]
.Child process PID: 2508782, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2508847, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2508905, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-157/test_no_overlapping_scans_netw0/nscan
Child process PID: 2509095, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-157/test_invalid_json_format_netwo0/nscan
Child process PID: 2509260, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b24b9f4ad10>
network_scanner_node = psutil.Process(pid=2509260, name='python3', status='sleeping', started='12:30:08')
network_status_client = (<rclpy.node.Node object at 0x7b24b9f48dc0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743327011, nanosec=484523281), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7b24b9f48dc0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743327011, nanosec=484523281), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.98s (0:01:17)

stderr:
Process 2508782 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2508847 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2508905 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2509057 no longer exists
Process 2509095 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 12:30:15,870 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:30:15,871 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:30:15,871 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:30:15,871 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:30:15,881 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1181
total_tokens       4530
2025-03-30 12:30:15,882 - root.base_generator - INFO - Iteration 4: Attempt 3 failed.
2025-03-30 12:30:15,882 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 4) ---
2025-03-30 12:30:15,882 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:30:15,882 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:30:15,882 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:30:15,882 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:30:15,883 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:30:15,883 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:30:23,553 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:30:23,556 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:30:23,556 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:30:23,557 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1248, total_tokens=4597
2025-03-30 12:30:23,557 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:30:23,557 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:30:23,557 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:30:23,642 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:30:23,642 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:30:23,642 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:30:23,642 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:30:23,642 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:30:23,642 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:30:23,642 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:30:23,642 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:30:23,643 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:30:23,643 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:30:23,643 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:30:23,643 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:30:23,643 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:30:23,643 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:32:08,335 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.72s]
.Child process PID: 2509563, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2509615, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2509672, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-158/test_no_overlapping_scans_netw0/nscan
Child process PID: 2509861, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-158/test_invalid_json_format_netwo0/nscan
Child process PID: 2510010, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-158/test_outdated_json_results_net0/nscan
Child process PID: 2510049, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.48s (0:01:35)

stderr:
Process 2509563 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2509615 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2509672 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2509823 no longer exists
Process 2509861 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2510049 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:32:08,335 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:32:08,336 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 12:32:08,336 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 12:32:08,336 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 12:32:08,347 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.5
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1248
total_tokens       4597
2025-03-30 12:32:08,347 - root.base_generator - INFO - Iteration 4: Successful attempt achieved.
2025-03-30 12:32:08,347 - root.base_generator - INFO - Iteration 4 finished.
2025-03-30 12:32:08,348 - root.base_generator - INFO -  Iteration 5 started.
2025-03-30 12:32:08,348 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 5) ---
2025-03-30 12:32:08,348 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:32:08,348 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:32:08,348 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:32:08,348 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:32:08,349 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:32:08,349 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:32:16,444 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:32:16,448 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:32:16,448 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:32:16,448 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1150, total_tokens=4499
2025-03-30 12:32:16,449 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:32:16,449 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:32:16,449 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:32:16,529 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:32:16,529 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:32:16,529 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:32:16,529 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:32:16,530 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:32:16,530 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:32:16,530 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:32:16,530 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:32:16,530 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:32:16,530 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:32:16,530 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:32:16,530 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:32:16,530 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:32:16,530 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:34:08,825 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2510517, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2510551, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2510681, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-159/test_no_overlapping_scans_netw0/nscan
Child process PID: 2510851, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-159/test_invalid_json_format_netwo0/nscan
Child process PID: 2510945, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7f5b926e2d10>
network_scanner_node = psutil.Process(pid=2510945, name='python3', status='sleeping', started='12:33:54')
network_status_client = (<rclpy.node.Node object at 0x7f5b926e0a00>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2510517 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2510551 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2510681 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2510759 no longer exists
Process 2510851 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2510945 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:34:08,825 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:34:08,826 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:34:08,826 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:34:08,826 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:34:08,838 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1150
total_tokens       4499
2025-03-30 12:34:08,838 - root.base_generator - INFO - Iteration 5: Attempt 1 failed.
2025-03-30 12:34:08,838 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 5) ---
2025-03-30 12:34:08,838 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:34:08,838 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:34:08,838 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:34:08,839 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:34:08,839 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:34:08,839 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:34:15,927 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:34:15,931 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:34:15,931 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:34:15,931 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1166, total_tokens=4515
2025-03-30 12:34:15,931 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:34:15,931 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:34:15,931 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:34:16,007 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:34:16,007 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:34:16,007 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:34:16,007 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:34:16,008 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:34:16,008 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:34:16,008 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:34:16,008 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:34:16,008 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:34:16,008 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:34:16,008 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:34:16,008 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:34:16,008 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:34:16,008 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:35:52,583 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2511249, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2511284, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2511421, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-160/test_no_overlapping_scans_netw0/nscan
Child process PID: 2511616, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-160/test_invalid_json_format_netwo0/nscan
Child process PID: 2511680, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-160/test_outdated_json_results_net0/nscan
Child process PID: 2511786, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.83s (0:01:33)

stderr:
Process 2511249 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2511284 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2511421 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2511524 no longer exists
Process 2511616 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2511786 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:35:52,584 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:35:52,584 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 12:35:52,585 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 12:35:52,585 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 12:35:52,596 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       103.7
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1166
total_tokens       4515
2025-03-30 12:35:52,596 - root.base_generator - INFO - Iteration 5: Successful attempt achieved.
2025-03-30 12:35:52,596 - root.base_generator - INFO - Iteration 5 finished.
2025-03-30 12:35:52,596 - root.base_generator - INFO -  Iteration 6 started.
2025-03-30 12:35:52,596 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 6) ---
2025-03-30 12:35:52,597 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:35:52,597 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:35:52,597 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:35:52,597 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:35:52,597 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:35:52,597 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:35:59,772 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:35:59,775 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:35:59,776 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:35:59,776 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1185, total_tokens=4534
2025-03-30 12:35:59,776 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:35:59,776 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:35:59,776 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:35:59,858 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:35:59,858 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:35:59,858 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:35:59,858 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:35:59,859 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:35:59,859 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:35:59,859 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:35:59,859 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:35:59,859 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:35:59,859 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:35:59,859 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:35:59,859 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:35:59,859 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:35:59,859 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:37:52,194 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.77s]
.Child process PID: 2512177, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2512268, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2512354, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-161/test_no_overlapping_scans_netw0/nscan
Child process PID: 2512547, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-161/test_invalid_json_format_netwo0/nscan
Child process PID: 2512663, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7d6a64242d10>
network_scanner_node = psutil.Process(pid=2512663, name='python3', status='sleeping', started='12:37:38')
network_status_client = (<rclpy.node.Node object at 0x7d6a62b6d7b0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2512177 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2512268 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2512354 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2512501 no longer exists
Process 2512547 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2512663 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:37:52,195 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:37:52,195 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:37:52,196 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:37:52,196 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:37:52,207 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1185
total_tokens       4534
2025-03-30 12:37:52,207 - root.base_generator - INFO - Iteration 6: Attempt 1 failed.
2025-03-30 12:37:52,207 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 6) ---
2025-03-30 12:37:52,207 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:37:52,207 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:37:52,207 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:37:52,208 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:37:52,208 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:37:52,208 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:37:59,578 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:37:59,582 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:37:59,582 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:37:59,582 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1193, total_tokens=4542
2025-03-30 12:37:59,582 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:37:59,582 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:37:59,583 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:37:59,759 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:37:59,759 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:37:59,759 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:37:59,759 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:37:59,760 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:37:59,760 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:37:59,760 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:37:59,760 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:37:59,760 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:37:59,760 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:37:59,760 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:37:59,760 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:37:59,760 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:37:59,760 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:39:27,200 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2512918, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2513031, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2513097, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-162/test_no_overlapping_scans_netw0/nscan
Child process PID: 2513284, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-162/test_invalid_json_format_netwo0/nscan
Child process PID: 2513492, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7089f9b3c580>
network_scanner_node = psutil.Process(pid=2513492, name='python3', status='sleeping', started='12:39:13')
network_status_client = (<rclpy.node.Node object at 0x7089f839d840>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.06s (0:01:25)

stderr:
Process 2512918 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2513031 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2513097 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2513245 no longer exists
Process 2513284 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2513492 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:39:27,200 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:39:27,201 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:39:27,201 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:39:27,201 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:39:27,212 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1193
total_tokens       4542
2025-03-30 12:39:27,212 - root.base_generator - INFO - Iteration 6: Attempt 2 failed.
2025-03-30 12:39:27,212 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 6) ---
2025-03-30 12:39:27,213 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:39:27,213 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:39:27,213 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:39:27,213 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:39:27,213 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:39:27,213 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:39:34,322 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:39:34,325 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:39:34,326 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:39:34,326 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1129, total_tokens=4478
2025-03-30 12:39:34,326 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:39:34,326 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:39:34,326 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:39:34,418 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:39:34,418 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:39:34,418 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:39:34,418 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:39:34,419 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:39:34,419 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:39:34,419 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:39:34,419 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:39:34,419 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:39:34,419 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:39:34,419 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:39:34,419 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:39:34,419 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:39:34,419 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:41:26,646 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2513868, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2513976, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2514047, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-163/test_no_overlapping_scans_netw0/nscan
Child process PID: 2514232, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-163/test_invalid_json_format_netwo0/nscan
Child process PID: 2514368, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x719b7f346d10>
network_scanner_node = psutil.Process(pid=2514368, name='python3', status='sleeping', started='12:41:12')
network_status_client = (<rclpy.node.Node object at 0x719b7dba5ff0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.01s (0:01:25)

stderr:
Process 2513868 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2513976 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2514047 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2514192 no longer exists
Process 2514232 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2514368 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:41:26,647 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:41:26,647 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:41:26,648 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:41:26,648 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:41:26,658 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1129
total_tokens       4478
2025-03-30 12:41:26,658 - root.base_generator - INFO - Iteration 6: Attempt 3 failed.
2025-03-30 12:41:26,659 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 6) ---
2025-03-30 12:41:26,659 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:41:26,659 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:41:26,659 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:41:26,659 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:41:26,659 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:41:26,659 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:41:33,544 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:41:33,548 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:41:33,548 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:41:33,548 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1109, total_tokens=4458
2025-03-30 12:41:33,548 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:41:33,549 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:41:33,549 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:41:33,626 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:41:33,627 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:41:33,627 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:41:33,628 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:41:33,628 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:41:33,628 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:41:33,628 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:43:12,138 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.76s]
.Child process PID: 2514643, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2514718, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2514784, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-164/test_no_overlapping_scans_netw0/nscan
Child process PID: 2514971, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-164/test_invalid_json_format_netwo0/nscan
Child process PID: 2515115, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-164/test_outdated_json_results_net0/nscan
Child process PID: 2515161, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.47s (0:01:35)

stderr:
Process 2514643 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2514718 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2514784 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2514937 no longer exists
Process 2514971 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2515161 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:43:12,138 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:43:12,139 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 12:43:12,139 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 12:43:12,139 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 12:43:12,150 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       105.5
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1109
total_tokens       4458
2025-03-30 12:43:12,150 - root.base_generator - INFO - Iteration 6: Successful attempt achieved.
2025-03-30 12:43:12,150 - root.base_generator - INFO - Iteration 6 finished.
2025-03-30 12:43:12,150 - root.base_generator - INFO -  Iteration 7 started.
2025-03-30 12:43:12,150 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 7) ---
2025-03-30 12:43:12,150 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:43:12,151 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:43:12,151 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:43:12,151 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:43:12,151 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:43:12,151 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:43:19,189 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:43:19,192 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:43:19,193 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:43:19,193 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1125, total_tokens=4474
2025-03-30 12:43:19,193 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:43:19,193 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:43:19,193 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:43:19,270 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:43:19,270 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:43:19,270 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:43:19,270 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:43:19,270 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:43:19,271 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:43:19,271 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:43:19,271 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:43:19,271 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:43:19,271 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:43:19,271 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:43:19,271 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:43:19,271 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:43:19,271 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:45:07,885 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2515613, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2515656, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2515768, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-165/test_no_overlapping_scans_netw0/nscan
Child process PID: 2515930, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-165/test_invalid_json_format_netwo0/nscan
Child process PID: 2516048, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b7a853e8640>
network_scanner_node = psutil.Process(pid=2516048, name='python3', status='sleeping', started='12:44:57')
network_status_client = (<rclpy.node.Node object at 0x7b7a844b1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743327900, nanosec=118088249), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7b7a844b1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743327900, nanosec=118088249), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.36s (0:01:21)

stderr:
Process 2515613 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2515656 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2515768 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2515869 no longer exists
Process 2515930 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2516048 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:45:07,885 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:45:07,886 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:45:07,886 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:45:07,886 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:45:07,897 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1125
total_tokens       4474
2025-03-30 12:45:07,897 - root.base_generator - INFO - Iteration 7: Attempt 1 failed.
2025-03-30 12:45:07,897 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 7) ---
2025-03-30 12:45:07,897 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:45:07,897 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:45:07,897 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:45:07,898 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:45:07,898 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:45:07,898 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:45:11,212 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:45:11,215 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:45:11,215 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:45:11,215 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=500, total_tokens=3849
2025-03-30 12:45:11,215 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:45:11,216 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:45:11,216 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:45:11,216 - root.code_parser - WARNING - No valid '```python' code markers found in response
2025-03-30 12:45:11,216 - root.generation_attempt - ERROR - Exception on stage PARSE:

Parsing failed, no code returned.

2025-03-30 12:45:11,216 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: FAILURE
2025-03-30 12:45:11,226 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       3.3
success            False
final_state        PARSE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  500
total_tokens       3849
2025-03-30 12:45:11,227 - root.base_generator - INFO - Iteration 7: Attempt 2 failed.
2025-03-30 12:45:11,227 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 7) ---
2025-03-30 12:45:11,227 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:45:11,227 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:45:11,227 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:45:11,227 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:45:11,227 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:45:11,228 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:45:18,631 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:45:18,635 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:45:18,635 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:45:18,635 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1219, total_tokens=4568
2025-03-30 12:45:18,635 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:45:18,636 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:45:18,636 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:45:18,717 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:45:18,717 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:45:18,717 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:45:18,717 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:45:18,718 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:45:18,718 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:45:18,718 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:45:18,718 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:45:18,718 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:45:18,718 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:45:18,718 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:45:18,718 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:45:18,718 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:45:18,718 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:46:39,408 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.54s]

Summary: 1 package finished [0.72s]
.Child process PID: 2516361, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2516398, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2516532, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-166/test_no_overlapping_scans_netw0/nscan
Child process PID: 2516701, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-166/test_invalid_json_format_netwo0/nscan
Child process PID: 2516792, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x780f9c2e2d10>
network_scanner_node = psutil.Process(pid=2516792, name='python3', status='sleeping', started='12:46:32')
network_status_client = (<rclpy.node.Node object at 0x780f9aba1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743327995, nanosec=58963687), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x780f9aba1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743327995, nanosec=58963687), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.92s (0:01:17)

stderr:
Process 2516361 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2516398 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2516532 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2516604 no longer exists
Process 2516701 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 12:46:39,408 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:46:39,409 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:46:39,409 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:46:39,409 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:46:39,420 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       88.2
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1219
total_tokens       4568
2025-03-30 12:46:39,420 - root.base_generator - INFO - Iteration 7: Attempt 3 failed.
2025-03-30 12:46:39,420 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 7) ---
2025-03-30 12:46:39,420 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:46:39,420 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:46:39,420 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:46:39,420 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:46:39,421 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:46:39,421 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:46:46,657 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:46:46,661 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:46:46,661 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:46:46,661 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1166, total_tokens=4515
2025-03-30 12:46:46,661 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:46:46,661 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:46:46,662 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:46:46,743 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:46:46,743 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:46:46,744 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:46:46,744 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:46:46,745 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:46:46,745 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:46:46,745 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:48:39,439 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2517216, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2517264, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2517321, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-167/test_no_overlapping_scans_netw0/nscan
Child process PID: 2517514, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-167/test_invalid_json_format_netwo0/nscan
Child process PID: 2517662, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ba2a7342d10>
network_scanner_node = psutil.Process(pid=2517662, name='python3', status='sleeping', started='12:48:25')
network_status_client = (<rclpy.node.Node object at 0x7ba2a7340970>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.43s (0:01:25)

stderr:
Process 2517216 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2517264 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2517321 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2517476 no longer exists
Process 2517514 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2517662 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:48:39,439 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:48:39,440 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:48:39,440 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:48:39,441 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:48:39,452 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1166
total_tokens       4515
2025-03-30 12:48:39,452 - root.base_generator - INFO - Iteration 7: Attempt 4 failed.
2025-03-30 12:48:39,452 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 7) ---
2025-03-30 12:48:39,452 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:48:39,452 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:48:39,453 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:48:39,453 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:48:39,453 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:48:39,453 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:48:46,547 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:48:46,550 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:48:46,550 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:48:46,551 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1177, total_tokens=4526
2025-03-30 12:48:46,551 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:48:46,551 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:48:46,551 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:48:46,632 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:48:46,632 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:48:46,632 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:48:46,633 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:48:46,633 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:48:46,633 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:48:46,633 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:48:46,633 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:48:46,633 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:48:46,633 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:48:46,633 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:48:46,633 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:48:46,634 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:48:46,634 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:50:14,089 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.76s]
.Child process PID: 2517956, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2517999, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2518110, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-168/test_no_overlapping_scans_netw0/nscan
Child process PID: 2518274, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-168/test_invalid_json_format_netwo0/nscan
Child process PID: 2518392, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x711122fe4580>
network_scanner_node = psutil.Process(pid=2518392, name='python3', status='sleeping', started='12:49:59')
network_status_client = (<rclpy.node.Node object at 0x7111220b1840>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2517956 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2517999 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2518110 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2518212 no longer exists
Process 2518274 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2518392 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:50:14,089 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:50:14,090 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:50:14,090 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:50:14,091 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:50:14,101 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1177
total_tokens       4526
2025-03-30 12:50:14,101 - root.base_generator - INFO - Iteration 7: Attempt 5 failed.
2025-03-30 12:50:14,101 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 7) ---
2025-03-30 12:50:14,102 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:50:14,102 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:50:14,102 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:50:14,102 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:50:14,102 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:50:14,102 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:50:21,247 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:50:21,250 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:50:21,251 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:50:21,251 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1150, total_tokens=4499
2025-03-30 12:50:21,251 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:50:21,251 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:50:21,251 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:50:21,331 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:50:21,331 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:50:21,331 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:50:21,331 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:50:21,331 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:50:21,332 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:50:21,332 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:50:21,332 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:50:21,332 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:50:21,332 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:50:21,332 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:50:21,332 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:50:21,332 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:50:21,332 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:52:24,085 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.77s]
.Child process PID: 2518838, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2518881, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2518977, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-169/test_no_overlapping_scans_netw0/nscan
Child process PID: 2519130, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-169/test_invalid_json_format_netwo0/nscan
Child process PID: 2519277, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-169/test_outdated_json_results_net0/nscan
Child process PID: 2519318, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.46s (0:01:35)

stderr:
Process 2518838 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2518881 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2518977 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2519090 no longer exists
Process 2519130 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2519318 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:52:24,085 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:52:24,086 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 12:52:24,086 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 12:52:24,086 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 12:52:24,097 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.0
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1150
total_tokens       4499
2025-03-30 12:52:24,098 - root.base_generator - INFO - Iteration 7: Successful attempt achieved.
2025-03-30 12:52:24,098 - root.base_generator - INFO - Iteration 7 finished.
2025-03-30 12:52:24,098 - root.base_generator - INFO -  Iteration 8 started.
2025-03-30 12:52:24,098 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 8) ---
2025-03-30 12:52:24,098 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:52:24,098 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:52:24,098 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:52:24,099 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:52:24,099 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:52:24,099 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:52:31,328 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:52:31,331 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:52:31,332 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:52:31,332 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1146, total_tokens=4495
2025-03-30 12:52:31,332 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:52:31,332 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:52:31,332 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:52:31,410 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:52:31,411 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:52:31,411 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:52:31,412 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:52:31,412 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:52:31,412 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:54:23,772 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.74s]
.Child process PID: 2519783, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2519818, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2519952, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-170/test_no_overlapping_scans_netw0/nscan
Child process PID: 2520143, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-170/test_invalid_json_format_netwo0/nscan
Child process PID: 2520211, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x786ee6f46d10>
network_scanner_node = psutil.Process(pid=2520211, name='python3', status='sleeping', started='12:54:09')
network_status_client = (<rclpy.node.Node object at 0x786ee57a5ed0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.11s (0:01:25)

stderr:
Process 2519783 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2519818 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2519952 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2520055 no longer exists
Process 2520143 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2520211 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:54:23,772 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:54:23,773 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:54:23,773 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:54:23,773 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:54:23,785 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1146
total_tokens       4495
2025-03-30 12:54:23,785 - root.base_generator - INFO - Iteration 8: Attempt 1 failed.
2025-03-30 12:54:23,785 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 8) ---
2025-03-30 12:54:23,786 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:54:23,786 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:54:23,786 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:54:23,786 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:54:23,786 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:54:23,786 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:54:31,354 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:54:31,357 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:54:31,358 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:54:31,358 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1199, total_tokens=4548
2025-03-30 12:54:31,358 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:54:31,358 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:54:31,358 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:54:31,561 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:54:31,561 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:54:31,561 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:54:31,561 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:54:31,562 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:54:31,562 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:54:31,562 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:54:31,562 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:54:31,562 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:54:31,562 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:54:31,562 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:54:31,562 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:54:31,562 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:54:31,562 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:56:23,844 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.72s]
.Child process PID: 2520662, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2520705, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2520839, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-171/test_no_overlapping_scans_netw0/nscan
Child process PID: 2521027, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-171/test_invalid_json_format_netwo0/nscan
Child process PID: 2521097, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7fab9fbe4670>
network_scanner_node = psutil.Process(pid=2521097, name='python3', status='sleeping', started='12:56:09')
network_status_client = (<rclpy.node.Node object at 0x7fab9ecb19c0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.03s (0:01:25)

stderr:
Process 2520662 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2520705 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2520839 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2520924 no longer exists
Process 2521027 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2521097 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:56:23,844 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:56:23,845 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:56:23,845 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:56:23,845 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:56:23,856 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1199
total_tokens       4548
2025-03-30 12:56:23,857 - root.base_generator - INFO - Iteration 8: Attempt 2 failed.
2025-03-30 12:56:23,857 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 8) ---
2025-03-30 12:56:23,857 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:56:23,857 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:56:23,857 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:56:23,857 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:56:23,857 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:56:23,858 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:56:31,061 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:56:31,064 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:56:31,065 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:56:31,065 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1165, total_tokens=4514
2025-03-30 12:56:31,065 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:56:31,065 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:56:31,065 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:56:31,144 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:56:31,145 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:56:31,145 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:56:31,145 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:56:31,145 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:56:31,145 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:56:31,145 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:56:31,145 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:56:31,145 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:56:31,146 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:56:31,146 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:56:31,146 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:56:31,146 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:56:31,146 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:57:58,850 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.74s]
.Child process PID: 2521403, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2521467, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2521578, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-172/test_no_overlapping_scans_netw0/nscan
Child process PID: 2521767, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-172/test_invalid_json_format_netwo0/nscan
Child process PID: 2521864, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x78e07dc44f40>
network_scanner_node = psutil.Process(pid=2521864, name='python3', status='sleeping', started='12:57:44')
network_status_client = (<rclpy.node.Node object at 0x78e07cd0dba0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2521403 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2521467 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2521578 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2521703 no longer exists
Process 2521767 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2521864 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:57:58,850 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:57:58,852 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:57:58,852 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:57:58,852 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:57:58,865 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1165
total_tokens       4514
2025-03-30 12:57:58,865 - root.base_generator - INFO - Iteration 8: Attempt 3 failed.
2025-03-30 12:57:58,866 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 8) ---
2025-03-30 12:57:58,866 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:57:58,866 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:57:58,866 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:57:58,866 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:57:58,867 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:57:58,867 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 12:58:05,729 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 12:58:05,732 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 12:58:05,733 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 12:58:05,733 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1097, total_tokens=4446
2025-03-30 12:58:05,733 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 12:58:05,733 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 12:58:05,733 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 12:58:05,812 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 12:58:05,812 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 12:58:05,812 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 12:58:05,812 - root.generation_attempt - INFO - Saving code...
2025-03-30 12:58:05,812 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 12:58:05,813 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 12:58:05,813 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 12:58:05,813 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 12:58:05,813 - root.generation_attempt - INFO - Running tests...
2025-03-30 12:58:05,813 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 12:58:05,813 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 12:58:05,813 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 12:58:05,813 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 12:58:05,813 - root.ros2_runner - INFO - Running tests...
2025-03-30 12:59:58,145 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2522285, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2522322, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2522457, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-173/test_no_overlapping_scans_netw0/nscan
Child process PID: 2522645, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-173/test_invalid_json_format_netwo0/nscan
Child process PID: 2522715, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x792e8733f310>
network_scanner_node = psutil.Process(pid=2522715, name='python3', status='sleeping', started='12:59:44')
network_status_client = (<rclpy.node.Node object at 0x792e85ba99c0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2522285 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2522322 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2522457 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2522559 no longer exists
Process 2522645 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2522715 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 12:59:58,145 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 12:59:58,146 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 12:59:58,146 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 12:59:58,146 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 12:59:58,158 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.3
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1097
total_tokens       4446
2025-03-30 12:59:58,158 - root.base_generator - INFO - Iteration 8: Attempt 4 failed.
2025-03-30 12:59:58,158 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 8) ---
2025-03-30 12:59:58,158 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 12:59:58,159 - root.generation_attempt - INFO - Initializing...
2025-03-30 12:59:58,159 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 12:59:58,159 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 12:59:58,159 - root.generation_attempt - INFO - Generating code...
2025-03-30 12:59:58,159 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:00:05,754 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:00:05,757 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:00:05,758 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:00:05,758 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1205, total_tokens=4554
2025-03-30 13:00:05,758 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:00:05,758 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:00:05,758 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:00:05,839 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:00:05,839 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:00:05,839 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:00:05,839 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:00:05,839 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:00:05,839 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:00:05,839 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:00:05,840 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:00:05,840 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:00:05,840 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:00:05,840 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:00:05,840 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:00:05,840 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:00:05,840 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:01:33,075 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.55s]

Summary: 1 package finished [0.71s]
.Child process PID: 2523021, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2523060, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2523194, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-174/test_no_overlapping_scans_netw0/nscan
Child process PID: 2523378, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-174/test_invalid_json_format_netwo0/nscan
Child process PID: 2523448, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x73f705e4ad10>
network_scanner_node = psutil.Process(pid=2523448, name='python3', status='sleeping', started='13:01:18')
network_status_client = (<rclpy.node.Node object at 0x73f704ee5f30>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.06s (0:01:25)

stderr:
Process 2523021 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2523060 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2523194 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2523303 no longer exists
Process 2523378 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2523448 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:01:33,076 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:01:33,077 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:01:33,077 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:01:33,077 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:01:33,089 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1205
total_tokens       4554
2025-03-30 13:01:33,089 - root.base_generator - INFO - Iteration 8: Attempt 5 failed.
2025-03-30 13:01:33,089 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 8) ---
2025-03-30 13:01:33,089 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:01:33,089 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:01:33,090 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:01:33,090 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:01:33,090 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:01:33,090 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:01:40,498 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:01:40,502 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:01:40,502 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:01:40,503 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1225, total_tokens=4574
2025-03-30 13:01:40,503 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:01:40,503 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:01:40,503 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:01:40,585 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:01:40,585 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:01:40,585 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:01:40,585 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:01:40,586 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:01:40,586 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:01:40,586 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:01:40,586 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:01:40,586 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:01:40,586 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:01:40,586 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:01:40,586 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:01:40,586 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:01:40,586 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:03:32,846 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.73s]
.Child process PID: 2523898, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2523937, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2524071, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-175/test_no_overlapping_scans_netw0/nscan
Child process PID: 2524266, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-175/test_invalid_json_format_netwo0/nscan
Child process PID: 2524338, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x70ae88cdc670>
network_scanner_node = psutil.Process(pid=2524338, name='python3', status='sleeping', started='13:03:18')
network_status_client = (<rclpy.node.Node object at 0x70ae875a59c0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2523898 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2523937 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2524071 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2524178 no longer exists
Process 2524266 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2524338 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:03:32,846 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:03:32,847 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:03:32,847 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:03:32,847 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:03:32,860 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1225
total_tokens       4574
2025-03-30 13:03:32,860 - root.base_generator - INFO - Iteration 8: Attempt 6 failed.
2025-03-30 13:03:32,860 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 8) ---
2025-03-30 13:03:32,861 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:03:32,861 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:03:32,861 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:03:32,861 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:03:32,861 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:03:32,861 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:03:39,956 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:03:39,960 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:03:39,961 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:03:39,961 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1185, total_tokens=4534
2025-03-30 13:03:39,961 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:03:39,961 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:03:39,961 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:03:40,042 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:03:40,042 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:03:40,042 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:03:40,042 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:03:40,042 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:03:40,042 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:03:40,042 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:03:40,042 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:03:40,043 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:03:40,043 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:03:40,043 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:03:40,043 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:03:40,043 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:03:40,043 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:05:07,895 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.77s]
.Child process PID: 2524637, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2524706, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2524814, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-176/test_no_overlapping_scans_netw0/nscan
Child process PID: 2525001, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-176/test_invalid_json_format_netwo0/nscan
Child process PID: 2525095, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x72241e840670>
network_scanner_node = psutil.Process(pid=2525095, name='python3', status='sleeping', started='13:04:53')
network_status_client = (<rclpy.node.Node object at 0x72241d1a5f30>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2524637 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2524706 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2524814 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2524939 no longer exists
Process 2525001 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2525095 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:05:07,895 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:05:07,896 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:05:07,896 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:05:07,896 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:05:07,908 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1185
total_tokens       4534
2025-03-30 13:05:07,908 - root.base_generator - INFO - Iteration 8: Attempt 7 failed.
2025-03-30 13:05:07,908 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 8) ---
2025-03-30 13:05:07,909 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:05:07,909 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:05:07,909 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:05:07,909 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:05:07,909 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:05:07,909 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:05:15,531 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:05:15,535 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:05:15,535 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:05:15,535 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1172, total_tokens=4521
2025-03-30 13:05:15,536 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:05:15,536 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:05:15,536 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:05:15,617 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:05:15,617 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:05:15,617 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:05:15,617 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:05:15,617 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:05:15,617 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:05:15,618 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:05:15,618 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:05:15,618 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:05:15,618 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:05:15,618 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:05:15,618 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:05:15,618 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:05:15,618 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:07:03,906 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2525523, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2525566, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2525700, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-177/test_no_overlapping_scans_netw0/nscan
Child process PID: 2525884, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-177/test_invalid_json_format_netwo0/nscan
Child process PID: 2525968, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x73039b540580>
network_scanner_node = psutil.Process(pid=2525968, name='python3', status='sleeping', started='13:06:53')
network_status_client = (<rclpy.node.Node object at 0x730399da5840>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743329216, nanosec=469428900), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x730399da5840>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743329216, nanosec=469428900), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2525523 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2525566 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2525700 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2525822 no longer exists
Process 2525884 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2525968 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:07:03,906 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:07:03,907 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:07:03,907 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:07:03,907 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:07:03,919 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       116.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1172
total_tokens       4521
2025-03-30 13:07:03,920 - root.base_generator - INFO - Iteration 8: Attempt 8 failed.
2025-03-30 13:07:03,920 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 8) ---
2025-03-30 13:07:03,920 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:07:03,920 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:07:03,920 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:07:03,920 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:07:03,920 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:07:03,921 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:07:10,892 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:07:10,897 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:07:10,897 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:07:10,897 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1132, total_tokens=4481
2025-03-30 13:07:10,898 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:07:10,898 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:07:10,898 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:07:10,977 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:07:10,977 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:07:10,977 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:07:10,978 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:07:10,978 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:07:10,978 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:07:10,978 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:07:10,978 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:07:10,978 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:07:10,978 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:07:10,978 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:07:10,979 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:07:10,979 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:07:10,979 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:08:52,452 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.75s]
.Child process PID: 2526262, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2526352, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2526439, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-178/test_no_overlapping_scans_netw0/nscan
Child process PID: 2526630, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-178/test_invalid_json_format_netwo0/nscan
Child process PID: 2526738, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-178/test_outdated_json_results_net0/nscan
Child process PID: 2526815, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
F
=================================== FAILURES ===================================
__________ TestFull.test_outdated_json_results[network_scanner_node0] __________

self = <test_scanner_node.TestFull object at 0x78c4dc3e7070>
network_scanner_node = psutil.Process(pid=2526815, status='terminated', started='13:08:37')
network_status_client = (<rclpy.node.Node object at 0x78c4db4a5de0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_outdated_json_results(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON result file is older than 20 seconds,
        the scanner node publishes a message with an empty addresses list.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        # Create outdated JSON file - will check from the first scan
        data = {"7.7.7.7": {"state": "UP", "response_time_ms": 15, "error": None}}
        with open(json_file_path, "w") as f:
            json.dump(data, f)

        # Backdate the modification time by 20 seconds
        old_time = time.time() - 20
        os.utime(json_file_path, (old_time, old_time))

        client_node, received_msgs = network_status_client
>       assert wait_for_messages(
            client_node, received_msgs, count=3, timeout=10
        ), "Did not receive at least 3 messages in time"
E       AssertionError: Did not receive at least 3 messages in time
E       assert False
E        +  where False = wait_for_messages(<rclpy.node.Node object at 0x78c4db4a5de0>, [], count=3, timeout=10)

src/network_scanner/test/test_scanner_node.py:335: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_outdated_json_results[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 8 passed in 94.63s (0:01:34)

stderr:
Process 2526262 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2526352 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2526439 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2526584 no longer exists
Process 2526630 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 13:08:52,452 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:08:52,453 - root.ros2_runner - INFO - Tests failed: 1, passed: 8, skipped: 0
2025-03-30 13:08:52,453 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:08:52,453 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:08:52,466 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       108.5
success            False
final_state        TEST
tests_passed       8
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1132
total_tokens       4481
2025-03-30 13:08:52,466 - root.base_generator - INFO - Iteration 8: Attempt 9 failed.
2025-03-30 13:08:52,466 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 8) ---
2025-03-30 13:08:52,466 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:08:52,466 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:08:52,467 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:08:52,467 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:08:52,467 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:08:52,467 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:08:59,651 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:08:59,655 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:08:59,655 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:08:59,655 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1142, total_tokens=4491
2025-03-30 13:08:59,655 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:08:59,655 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:08:59,656 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:08:59,731 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:08:59,731 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:08:59,732 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:08:59,732 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:08:59,733 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:08:59,733 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:08:59,733 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:10:52,077 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.54s]

Summary: 1 package finished [0.70s]
.Child process PID: 2527291, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2527370, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2527436, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-179/test_no_overlapping_scans_netw0/nscan
Child process PID: 2527623, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-179/test_invalid_json_format_netwo0/nscan
Child process PID: 2527764, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b09ce338640>
network_scanner_node = psutil.Process(pid=2527764, name='python3', status='sleeping', started='13:10:37')
network_status_client = (<rclpy.node.Node object at 0x7b09ccba5960>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2527291 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2527370 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2527436 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2527584 no longer exists
Process 2527623 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2527764 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:10:52,077 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:10:52,078 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:10:52,078 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:10:52,078 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:10:52,090 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1142
total_tokens       4491
2025-03-30 13:10:52,091 - root.base_generator - INFO - Iteration 8: Attempt 10 failed.
2025-03-30 13:10:52,091 - root.base_generator - INFO - --- Starting Attempt 11 (Iteration 8) ---
2025-03-30 13:10:52,091 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:10:52,091 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:10:52,091 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:10:52,091 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:10:52,091 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:10:52,091 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:10:58,850 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:10:58,853 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:10:58,854 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:10:58,854 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1104, total_tokens=4453
2025-03-30 13:10:58,854 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:10:58,854 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:10:58,854 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:10:58,934 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:10:58,934 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:10:58,934 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:10:58,934 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:10:58,934 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:10:58,934 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:10:58,934 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:10:58,934 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:10:58,935 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:10:58,935 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:10:58,935 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:10:58,935 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:10:58,935 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:10:58,935 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:12:37,412 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.74s]
.Child process PID: 2528049, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2528108, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2528171, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-180/test_no_overlapping_scans_netw0/nscan
Child process PID: 2528361, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-180/test_invalid_json_format_netwo0/nscan
Child process PID: 2528504, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-180/test_outdated_json_results_net0/nscan
Child process PID: 2528547, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.48s (0:01:35)

stderr:
Process 2528049 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2528108 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2528171 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2528322 no longer exists
Process 2528361 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2528547 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:12:37,412 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:12:37,413 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:12:37,413 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:12:37,413 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:12:37,421 - root.base_generator - INFO - Attempt 11 finished with metrics:
metric             value
-----------------  -------
attempt_time       105.3
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1104
total_tokens       4453
2025-03-30 13:12:37,421 - root.base_generator - INFO - Iteration 8: Successful attempt achieved.
2025-03-30 13:12:37,422 - root.base_generator - INFO - Iteration 8 finished.
2025-03-30 13:12:37,422 - root.base_generator - INFO -  Iteration 9 started.
2025-03-30 13:12:37,422 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 9) ---
2025-03-30 13:12:37,422 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:12:37,422 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:12:37,422 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:12:37,422 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:12:37,422 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:12:37,422 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:12:44,820 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:12:44,823 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:12:44,823 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:12:44,823 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1211, total_tokens=4560
2025-03-30 13:12:44,824 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:12:44,824 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:12:44,824 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:12:44,902 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:12:44,902 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:12:44,902 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:12:44,902 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:12:44,903 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:12:44,903 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:12:44,903 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:12:44,903 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:12:44,903 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:12:44,903 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:12:44,903 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:12:44,903 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:12:44,903 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:12:44,904 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:14:37,201 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.72s]
.Child process PID: 2529008, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2529047, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2529178, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-181/test_no_overlapping_scans_netw0/nscan
Child process PID: 2529354, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-181/test_invalid_json_format_netwo0/nscan
Child process PID: 2529440, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7092bd734f40>
network_scanner_node = psutil.Process(pid=2529440, name='python3', status='sleeping', started='13:14:23')
network_status_client = (<rclpy.node.Node object at 0x7092bbf71a20>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.06s (0:01:25)

stderr:
Process 2529008 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2529047 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2529178 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2529257 no longer exists
Process 2529354 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2529440 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:14:37,201 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:14:37,202 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:14:37,203 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:14:37,203 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:14:37,216 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1211
total_tokens       4560
2025-03-30 13:14:37,216 - root.base_generator - INFO - Iteration 9: Attempt 1 failed.
2025-03-30 13:14:37,216 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 9) ---
2025-03-30 13:14:37,216 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:14:37,217 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:14:37,217 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:14:37,217 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:14:37,217 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:14:37,217 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:14:44,729 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:14:44,733 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:14:44,733 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:14:44,733 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1167, total_tokens=4516
2025-03-30 13:14:44,733 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:14:44,733 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:14:44,734 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:14:44,815 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:14:44,815 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:14:44,815 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:14:44,815 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:14:44,816 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:14:44,816 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:14:44,816 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:14:44,816 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:14:44,816 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:14:44,816 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:14:44,816 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:14:44,816 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:14:44,816 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:14:44,816 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:16:12,129 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.73s]
.Child process PID: 2529744, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2529781, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2529922, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-182/test_no_overlapping_scans_netw0/nscan
Child process PID: 2530108, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-182/test_invalid_json_format_netwo0/nscan
Child process PID: 2530176, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7999a643b1f0>
network_scanner_node = psutil.Process(pid=2530176, name='python3', status='sleeping', started='13:15:58')
network_status_client = (<rclpy.node.Node object at 0x7999a552df30>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.03s (0:01:25)

stderr:
Process 2529744 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2529781 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2529922 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2530020 no longer exists
Process 2530108 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2530176 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:16:12,130 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:16:12,131 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:16:12,131 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:16:12,131 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:16:12,144 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1167
total_tokens       4516
2025-03-30 13:16:12,144 - root.base_generator - INFO - Iteration 9: Attempt 2 failed.
2025-03-30 13:16:12,144 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 9) ---
2025-03-30 13:16:12,144 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:16:12,145 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:16:12,145 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:16:12,145 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:16:12,145 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:16:12,145 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:16:21,246 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:16:21,249 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:16:21,250 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:16:21,250 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1117, total_tokens=4466
2025-03-30 13:16:21,250 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:16:21,250 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:16:21,250 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:16:21,477 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:16:21,477 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:16:21,477 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:16:21,478 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:16:21,478 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:16:21,478 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:16:21,478 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:16:21,478 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:16:21,478 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:16:21,478 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:16:21,478 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:16:21,478 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:16:21,478 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:16:21,478 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:18:13,790 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2530635, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2530674, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2530811, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-183/test_no_overlapping_scans_netw0/nscan
Child process PID: 2530999, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-183/test_invalid_json_format_netwo0/nscan
Child process PID: 2531073, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x781aee3471f0>
network_scanner_node = psutil.Process(pid=2531073, name='python3', status='sleeping', started='13:17:59')
network_status_client = (<rclpy.node.Node object at 0x781aee345bd0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.07s (0:01:25)

stderr:
Process 2530635 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2530674 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2530811 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2530924 no longer exists
Process 2530999 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2531073 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:18:13,790 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:18:13,791 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:18:13,791 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:18:13,791 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:18:13,805 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       121.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1117
total_tokens       4466
2025-03-30 13:18:13,805 - root.base_generator - INFO - Iteration 9: Attempt 3 failed.
2025-03-30 13:18:13,805 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 9) ---
2025-03-30 13:18:13,805 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:18:13,805 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:18:13,805 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:18:13,806 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:18:13,806 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:18:13,806 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:18:20,715 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:18:20,719 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:18:20,719 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:18:20,719 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1114, total_tokens=4463
2025-03-30 13:18:20,719 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:18:20,719 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:18:20,720 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:18:20,798 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:18:20,798 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:18:20,798 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:18:20,798 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:18:20,798 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:18:20,799 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:18:20,799 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:18:20,799 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:18:20,799 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:18:20,799 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:18:20,799 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:18:20,799 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:18:20,799 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:18:20,799 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:19:59,208 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2531375, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2531451, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2531556, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-184/test_no_overlapping_scans_netw0/nscan
Child process PID: 2531741, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-184/test_invalid_json_format_netwo0/nscan
Child process PID: 2531846, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-184/test_outdated_json_results_net0/nscan
Child process PID: 2531922, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.48s (0:01:35)

stderr:
Process 2531375 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2531451 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2531556 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2531683 no longer exists
Process 2531741 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2531922 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:19:59,208 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:19:59,209 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:19:59,209 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:19:59,209 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:19:59,222 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       105.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1114
total_tokens       4463
2025-03-30 13:19:59,223 - root.base_generator - INFO - Iteration 9: Successful attempt achieved.
2025-03-30 13:19:59,223 - root.base_generator - INFO - Iteration 9 finished.
2025-03-30 13:19:59,223 - root.base_generator - INFO -  Iteration 10 started.
2025-03-30 13:19:59,223 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 10) ---
2025-03-30 13:19:59,223 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:19:59,223 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:19:59,224 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:19:59,224 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:19:59,224 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:19:59,224 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:20:07,580 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:20:07,583 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:20:07,583 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:20:07,584 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1178, total_tokens=4527
2025-03-30 13:20:07,584 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:20:07,584 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:20:07,584 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:20:07,666 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:20:07,666 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:20:07,666 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:20:07,666 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:20:07,666 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:20:07,667 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:20:07,667 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:20:07,667 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:20:07,667 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:20:07,667 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:20:07,667 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:20:07,667 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:20:07,667 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:20:07,667 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:22:00,008 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.74s]
.Child process PID: 2532351, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2532427, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2532487, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-185/test_no_overlapping_scans_netw0/nscan
Child process PID: 2532676, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-185/test_invalid_json_format_netwo0/nscan
Child process PID: 2532818, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x74d7d3adc640>
network_scanner_node = psutil.Process(pid=2532818, name='python3', status='sleeping', started='13:21:45')
network_status_client = (<rclpy.node.Node object at 0x74d7d23a5990>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.07s (0:01:25)

stderr:
Process 2532351 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2532427 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2532487 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2532634 no longer exists
Process 2532676 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2532818 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:22:00,009 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:22:00,010 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:22:00,010 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:22:00,010 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:22:00,024 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1178
total_tokens       4527
2025-03-30 13:22:00,024 - root.base_generator - INFO - Iteration 10: Attempt 1 failed.
2025-03-30 13:22:00,024 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 10) ---
2025-03-30 13:22:00,024 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:22:00,024 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:22:00,024 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:22:00,025 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:22:00,025 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:22:00,025 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:22:07,090 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:22:07,094 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:22:07,094 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:22:07,094 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1139, total_tokens=4488
2025-03-30 13:22:07,094 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:22:07,095 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:22:07,095 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:22:07,176 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:22:07,176 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:22:07,176 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:22:07,177 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:22:07,177 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:22:07,177 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:22:07,177 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:22:07,177 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:22:07,177 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:22:07,177 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:22:07,177 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:22:07,177 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:22:07,178 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:22:07,178 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:23:45,379 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.78s]
.Child process PID: 2533104, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2533161, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2533224, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-186/test_no_overlapping_scans_netw0/nscan
Child process PID: 2533416, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-186/test_invalid_json_format_netwo0/nscan
Child process PID: 2533557, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-186/test_outdated_json_results_net0/nscan
Child process PID: 2533601, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.47s (0:01:35)

stderr:
Process 2533104 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2533161 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2533224 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2533377 no longer exists
Process 2533416 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2533601 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:23:45,379 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:23:45,380 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:23:45,380 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:23:45,380 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:23:45,393 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       105.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1139
total_tokens       4488
2025-03-30 13:23:45,393 - root.base_generator - INFO - Iteration 10: Successful attempt achieved.
2025-03-30 13:23:45,393 - root.base_generator - INFO - Iteration 10 finished.
2025-03-30 13:23:45,393 - root.base_generator - INFO -  Iteration 11 started.
2025-03-30 13:23:45,393 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 11) ---
2025-03-30 13:23:45,393 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:23:45,394 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:23:45,394 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:23:45,394 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:23:45,394 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:23:45,394 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:23:53,114 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:23:53,118 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:23:53,118 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:23:53,118 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1225, total_tokens=4574
2025-03-30 13:23:53,119 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:23:53,119 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:23:53,119 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:23:53,200 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:23:53,200 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:23:53,200 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:23:53,200 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:23:53,200 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:23:53,201 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:23:53,201 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:23:53,201 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:23:53,201 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:23:53,201 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:23:53,201 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:23:53,201 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:23:53,201 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:23:53,201 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:25:45,529 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2534058, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2534097, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2534213, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-187/test_no_overlapping_scans_netw0/nscan
Child process PID: 2534385, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-187/test_invalid_json_format_netwo0/nscan
Child process PID: 2534493, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ed759240580>
network_scanner_node = psutil.Process(pid=2534493, name='python3', status='sleeping', started='13:25:31')
network_status_client = (<rclpy.node.Node object at 0x7ed7592421d0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2534058 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2534097 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2534213 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2534312 no longer exists
Process 2534385 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2534493 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:25:45,529 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:25:45,530 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:25:45,530 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:25:45,531 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:25:45,544 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1225
total_tokens       4574
2025-03-30 13:25:45,544 - root.base_generator - INFO - Iteration 11: Attempt 1 failed.
2025-03-30 13:25:45,544 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 11) ---
2025-03-30 13:25:45,544 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:25:45,545 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:25:45,545 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:25:45,545 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:25:45,545 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:25:45,545 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:25:52,971 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:25:52,974 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:25:52,974 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:25:52,975 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1207, total_tokens=4556
2025-03-30 13:25:52,975 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:25:52,975 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:25:52,975 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:25:53,057 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:25:53,057 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:25:53,057 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:25:53,057 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:25:53,057 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:25:53,057 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:25:53,058 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:25:53,058 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:25:53,058 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:25:53,058 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:25:53,058 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:25:53,058 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:25:53,058 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:25:53,058 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:27:20,542 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.77s]
.Child process PID: 2534794, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2534837, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2534963, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-188/test_no_overlapping_scans_netw0/nscan
Child process PID: 2535133, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-188/test_invalid_json_format_netwo0/nscan
Child process PID: 2535227, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ef217642d40>
network_scanner_node = psutil.Process(pid=2535227, name='python3', status='sleeping', started='13:27:06')
network_status_client = (<rclpy.node.Node object at 0x7ef2176422c0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.09s (0:01:25)

stderr:
Process 2534794 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2534837 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2534963 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2535043 no longer exists
Process 2535133 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2535227 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:27:20,542 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:27:20,543 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:27:20,543 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:27:20,543 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:27:20,557 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1207
total_tokens       4556
2025-03-30 13:27:20,557 - root.base_generator - INFO - Iteration 11: Attempt 2 failed.
2025-03-30 13:27:20,557 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 11) ---
2025-03-30 13:27:20,558 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:27:20,558 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:27:20,558 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:27:20,558 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:27:20,558 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:27:20,558 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:27:27,761 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:27:27,765 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:27:27,766 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:27:27,766 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1190, total_tokens=4539
2025-03-30 13:27:27,766 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:27:27,766 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:27:27,767 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:27:27,847 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:27:27,847 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:27:27,848 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:27:27,848 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:27:27,848 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:27:27,848 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:27:27,849 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:29:30,706 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2535676, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2535719, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2535827, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-189/test_no_overlapping_scans_netw0/nscan
Child process PID: 2535995, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-189/test_invalid_json_format_netwo0/nscan
Child process PID: 2536107, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-189/test_outdated_json_results_net0/nscan
Child process PID: 2536147, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.58s (0:01:35)

stderr:
Process 2535676 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2535719 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2535827 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2535926 no longer exists
Process 2535995 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2536147 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:29:30,706 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:29:30,707 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:29:30,707 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:29:30,707 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:29:30,720 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.1
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1190
total_tokens       4539
2025-03-30 13:29:30,720 - root.base_generator - INFO - Iteration 11: Successful attempt achieved.
2025-03-30 13:29:30,720 - root.base_generator - INFO - Iteration 11 finished.
2025-03-30 13:29:30,720 - root.base_generator - INFO -  Iteration 12 started.
2025-03-30 13:29:30,720 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 12) ---
2025-03-30 13:29:30,721 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:29:30,721 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:29:30,721 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:29:30,721 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:29:30,721 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:29:30,721 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:29:37,919 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:29:37,922 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:29:37,922 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:29:37,923 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1152, total_tokens=4501
2025-03-30 13:29:37,923 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:29:37,923 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:29:37,923 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:29:38,003 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:29:38,003 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:29:38,003 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:29:38,003 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:29:38,004 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:29:38,004 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:29:38,004 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:29:38,004 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:29:38,004 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:29:38,004 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:29:38,004 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:29:38,004 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:29:38,004 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:29:38,004 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:31:40,705 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.53s]

Summary: 1 package finished [0.71s]
.Child process PID: 2536609, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2536646, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2536780, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-190/test_no_overlapping_scans_netw0/nscan
Child process PID: 2536965, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-190/test_invalid_json_format_netwo0/nscan
Child process PID: 2537039, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-190/test_outdated_json_results_net0/nscan
Child process PID: 2537129, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.50s (0:01:35)

stderr:
Process 2536609 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2536646 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2536780 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2536883 no longer exists
Process 2536965 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2537129 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:31:40,705 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:31:40,706 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:31:40,706 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:31:40,706 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:31:40,720 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.0
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1152
total_tokens       4501
2025-03-30 13:31:40,720 - root.base_generator - INFO - Iteration 12: Successful attempt achieved.
2025-03-30 13:31:40,720 - root.base_generator - INFO - Iteration 12 finished.
2025-03-30 13:31:40,720 - root.base_generator - INFO -  Iteration 13 started.
2025-03-30 13:31:40,721 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 13) ---
2025-03-30 13:31:40,721 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:31:40,721 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:31:40,721 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:31:40,721 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:31:40,721 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:31:40,721 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:31:47,896 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:31:47,899 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:31:47,900 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:31:47,900 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1139, total_tokens=4488
2025-03-30 13:31:47,900 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:31:47,900 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:31:47,900 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:31:47,980 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:31:47,980 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:31:47,980 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:31:47,980 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:31:47,981 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:31:47,981 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:31:47,981 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:31:47,981 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:31:47,981 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:31:47,981 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:31:47,981 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:31:47,981 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:31:47,981 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:31:47,981 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:33:40,381 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.77s]
.Child process PID: 2537542, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2537621, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2537717, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-191/test_no_overlapping_scans_netw0/nscan
Child process PID: 2537906, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-191/test_invalid_json_format_netwo0/nscan
Child process PID: 2538012, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x78b6c1546d10>
network_scanner_node = psutil.Process(pid=2538012, name='python3', status='sleeping', started='13:33:26')
network_status_client = (<rclpy.node.Node object at 0x78b6c15447f0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2537542 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2537621 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2537717 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2537848 no longer exists
Process 2537906 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2538012 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:33:40,381 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:33:40,382 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:33:40,382 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:33:40,382 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:33:40,392 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1139
total_tokens       4488
2025-03-30 13:33:40,392 - root.base_generator - INFO - Iteration 13: Attempt 1 failed.
2025-03-30 13:33:40,392 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 13) ---
2025-03-30 13:33:40,392 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:33:40,392 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:33:40,393 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:33:40,393 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:33:40,393 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:33:40,393 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:33:47,806 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:33:47,809 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:33:47,809 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:33:47,809 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1177, total_tokens=4526
2025-03-30 13:33:47,810 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:33:47,810 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:33:47,810 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:33:47,888 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:33:47,888 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:33:47,888 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:33:47,888 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:33:47,889 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:33:47,889 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:33:47,889 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:33:47,889 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:33:47,889 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:33:47,889 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:33:47,889 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:33:47,889 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:33:47,889 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:33:47,889 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:35:11,285 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.80s]
.Child process PID: 2538275, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2538371, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2538453, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-192/test_no_overlapping_scans_netw0/nscan
Child process PID: 2538645, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-192/test_invalid_json_format_netwo0/nscan
Child process PID: 2538760, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x714c81adc580>
network_scanner_node = psutil.Process(pid=2538760, name='python3', status='sleeping', started='13:35:01')
network_status_client = (<rclpy.node.Node object at 0x714c81adcaf0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743330903, nanosec=855832633), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x714c81adcaf0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743330903, nanosec=855832633), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2538275 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2538371 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2538453 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2538597 no longer exists
Process 2538645 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2538760 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:35:11,286 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:35:11,287 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:35:11,287 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:35:11,287 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:35:11,301 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       90.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1177
total_tokens       4526
2025-03-30 13:35:11,301 - root.base_generator - INFO - Iteration 13: Attempt 2 failed.
2025-03-30 13:35:11,301 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 13) ---
2025-03-30 13:35:11,302 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:35:11,302 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:35:11,302 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:35:11,302 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:35:11,302 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:35:11,302 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:35:18,866 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:35:18,870 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:35:18,870 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:35:18,870 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1210, total_tokens=4559
2025-03-30 13:35:18,870 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:35:18,870 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:35:18,870 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:35:18,953 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:35:18,953 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:35:18,953 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:35:18,953 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:35:18,953 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:35:18,953 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:35:18,953 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:35:18,953 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:35:18,954 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:35:18,954 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:35:18,954 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:35:18,954 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:35:18,954 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:35:18,954 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:37:11,265 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.76s]
.Child process PID: 2539151, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2539190, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2539324, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-193/test_no_overlapping_scans_netw0/nscan
Child process PID: 2539513, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-193/test_invalid_json_format_netwo0/nscan
Child process PID: 2539581, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e28517471f0>
network_scanner_node = psutil.Process(pid=2539581, name='python3', status='sleeping', started='13:36:57')
network_status_client = (<rclpy.node.Node object at 0x7e28517475e0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2539151 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2539190 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2539324 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2539436 no longer exists
Process 2539513 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2539581 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:37:11,266 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:37:11,267 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:37:11,267 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:37:11,267 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:37:11,281 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1210
total_tokens       4559
2025-03-30 13:37:11,281 - root.base_generator - INFO - Iteration 13: Attempt 3 failed.
2025-03-30 13:37:11,281 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 13) ---
2025-03-30 13:37:11,281 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:37:11,282 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:37:11,282 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:37:11,282 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:37:11,282 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:37:11,282 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:37:18,154 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:37:18,158 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:37:18,158 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:37:18,158 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1114, total_tokens=4463
2025-03-30 13:37:18,158 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:37:18,158 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:37:18,159 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:37:18,239 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:37:18,239 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:37:18,240 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:37:18,240 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:37:18,240 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:37:18,240 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:37:18,240 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:37:18,240 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:37:18,240 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:37:18,240 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:37:18,241 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:37:18,241 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:37:18,241 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:37:18,241 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:38:55,893 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2539886, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2539950, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2540066, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-194/test_no_overlapping_scans_netw0/nscan
Child process PID: 2540249, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-194/test_invalid_json_format_netwo0/nscan
Child process PID: 2540345, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-194/test_outdated_json_results_net0/nscan
Child process PID: 2540431, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
F
=================================== FAILURES ===================================
__________ TestFull.test_outdated_json_results[network_scanner_node0] __________

self = <test_scanner_node.TestFull object at 0x7c4e0eae3070>
network_scanner_node = psutil.Process(pid=2540431, status='terminated', started='13:38:40')
network_status_client = (<rclpy.node.Node object at 0x7c4e0d3a1ed0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_outdated_json_results(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON result file is older than 20 seconds,
        the scanner node publishes a message with an empty addresses list.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        # Create outdated JSON file - will check from the first scan
        data = {"7.7.7.7": {"state": "UP", "response_time_ms": 15, "error": None}}
        with open(json_file_path, "w") as f:
            json.dump(data, f)

        # Backdate the modification time by 20 seconds
        old_time = time.time() - 20
        os.utime(json_file_path, (old_time, old_time))

        client_node, received_msgs = network_status_client
>       assert wait_for_messages(
            client_node, received_msgs, count=3, timeout=10
        ), "Did not receive at least 3 messages in time"
E       AssertionError: Did not receive at least 3 messages in time
E       assert False
E        +  where False = wait_for_messages(<rclpy.node.Node object at 0x7c4e0d3a1ed0>, [], count=3, timeout=10)

src/network_scanner/test/test_scanner_node.py:335: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_outdated_json_results[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 8 passed in 94.67s (0:01:34)

stderr:
Process 2539886 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2539950 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2540066 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2540189 no longer exists
Process 2540249 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 13:38:55,893 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:38:55,894 - root.ros2_runner - INFO - Tests failed: 1, passed: 8, skipped: 0
2025-03-30 13:38:55,894 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:38:55,895 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:38:55,908 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       104.6
success            False
final_state        TEST
tests_passed       8
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1114
total_tokens       4463
2025-03-30 13:38:55,909 - root.base_generator - INFO - Iteration 13: Attempt 4 failed.
2025-03-30 13:38:55,909 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 13) ---
2025-03-30 13:38:55,909 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:38:55,909 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:38:55,909 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:38:55,909 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:38:55,909 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:38:55,909 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:39:03,176 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:39:03,179 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:39:03,180 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:39:03,180 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1164, total_tokens=4513
2025-03-30 13:39:03,180 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:39:03,180 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:39:03,180 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:39:03,257 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:39:03,257 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:39:03,258 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:39:03,258 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:39:03,258 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:39:03,258 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:39:03,259 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:41:06,400 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.80s]
.Child process PID: 2540878, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2540975, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2541059, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-195/test_no_overlapping_scans_netw0/nscan
Child process PID: 2541247, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-195/test_invalid_json_format_netwo0/nscan
Child process PID: 2541367, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-195/test_outdated_json_results_net0/nscan
Child process PID: 2541428, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.81s (0:01:35)

stderr:
Process 2540878 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2540975 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2541059 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2541203 no longer exists
Process 2541247 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2541428 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:41:06,400 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:41:06,400 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:41:06,400 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:41:06,400 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:41:06,409 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.5
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1164
total_tokens       4513
2025-03-30 13:41:06,410 - root.base_generator - INFO - Iteration 13: Successful attempt achieved.
2025-03-30 13:41:06,410 - root.base_generator - INFO - Iteration 13 finished.
2025-03-30 13:41:06,410 - root.base_generator - INFO -  Iteration 14 started.
2025-03-30 13:41:06,410 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 14) ---
2025-03-30 13:41:06,410 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:41:06,410 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:41:06,410 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:41:06,410 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:41:06,410 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:41:06,410 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:41:13,345 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:41:13,349 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:41:13,349 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:41:13,349 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1136, total_tokens=4485
2025-03-30 13:41:13,349 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:41:13,349 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:41:13,349 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:41:13,622 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:41:13,622 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:41:13,623 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:41:13,623 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:41:13,623 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:41:13,623 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:41:13,624 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:43:16,340 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.73s]
.Child process PID: 2541860, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2541926, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2541985, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-196/test_no_overlapping_scans_netw0/nscan
Child process PID: 2542175, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-196/test_invalid_json_format_netwo0/nscan
Child process PID: 2542319, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-196/test_outdated_json_results_net0/nscan
Child process PID: 2542367, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.48s (0:01:35)

stderr:
Process 2541860 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2541926 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2541985 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2542139 no longer exists
Process 2542175 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2542367 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:43:16,341 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:43:16,342 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:43:16,342 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:43:16,342 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:43:16,356 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       129.9
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1136
total_tokens       4485
2025-03-30 13:43:16,356 - root.base_generator - INFO - Iteration 14: Successful attempt achieved.
2025-03-30 13:43:16,356 - root.base_generator - INFO - Iteration 14 finished.
2025-03-30 13:43:16,356 - root.base_generator - INFO -  Iteration 15 started.
2025-03-30 13:43:16,357 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 15) ---
2025-03-30 13:43:16,357 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:43:16,357 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:43:16,357 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:43:16,357 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:43:16,357 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:43:16,357 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:43:23,506 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:43:23,510 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:43:23,510 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:43:23,510 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1164, total_tokens=4513
2025-03-30 13:43:23,510 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:43:23,511 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:43:23,511 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:43:23,590 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:43:23,590 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:43:23,590 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:43:23,590 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:43:23,590 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:43:23,590 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:43:23,591 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:43:23,591 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:43:23,591 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:43:23,591 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:43:23,591 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:43:23,591 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:43:23,591 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:43:23,591 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:45:15,846 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.72s]
.Child process PID: 2542816, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2542859, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2542957, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-197/test_no_overlapping_scans_netw0/nscan
Child process PID: 2543129, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-197/test_invalid_json_format_netwo0/nscan
Child process PID: 2543252, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x72fdf9045030>
network_scanner_node = psutil.Process(pid=2543252, name='python3', status='sleeping', started='13:45:01')
network_status_client = (<rclpy.node.Node object at 0x72fdf9047550>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2542816 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2542859 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2542957 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2543068 no longer exists
Process 2543129 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2543252 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:45:15,847 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:45:15,847 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:45:15,847 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:45:15,847 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:45:15,855 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1164
total_tokens       4513
2025-03-30 13:45:15,855 - root.base_generator - INFO - Iteration 15: Attempt 1 failed.
2025-03-30 13:45:15,855 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 15) ---
2025-03-30 13:45:15,856 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:45:15,856 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:45:15,856 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:45:15,856 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:45:15,856 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:45:15,856 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:45:23,130 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:45:23,133 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:45:23,134 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:45:23,134 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1145, total_tokens=4494
2025-03-30 13:45:23,134 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:45:23,134 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:45:23,134 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:45:23,221 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:45:23,222 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:45:23,222 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:45:23,222 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:45:23,222 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:45:23,222 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:45:23,223 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:45:23,223 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:45:23,223 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:45:23,223 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:45:23,223 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:45:23,223 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:45:23,223 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:45:23,223 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:46:50,964 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.73s]
.Child process PID: 2543557, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2543596, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2543712, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-198/test_no_overlapping_scans_netw0/nscan
Child process PID: 2543880, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-198/test_invalid_json_format_netwo0/nscan
Child process PID: 2543989, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x769005641000>
network_scanner_node = psutil.Process(pid=2543989, name='python3', status='sleeping', started='13:46:36')
network_status_client = (<rclpy.node.Node object at 0x7690046f9e10>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.19s (0:01:25)

stderr:
Process 2543557 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2543596 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2543712 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2543806 no longer exists
Process 2543880 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2543989 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:46:50,964 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:46:50,965 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:46:50,965 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:46:50,965 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:46:50,979 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1145
total_tokens       4494
2025-03-30 13:46:50,979 - root.base_generator - INFO - Iteration 15: Attempt 2 failed.
2025-03-30 13:46:50,979 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 15) ---
2025-03-30 13:46:50,979 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:46:50,979 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:46:50,980 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:46:50,980 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:46:50,980 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:46:50,980 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:46:57,962 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:46:57,966 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:46:57,966 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:46:57,966 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1122, total_tokens=4471
2025-03-30 13:46:57,966 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:46:57,966 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:46:57,967 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:46:58,044 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:46:58,044 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:46:58,044 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:46:58,044 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:46:58,045 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:46:58,045 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:46:58,045 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:46:58,045 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:46:58,045 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:46:58,045 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:46:58,045 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:46:58,045 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:46:58,045 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:46:58,046 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:48:50,402 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.76s]
.Child process PID: 2544431, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2544474, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2544571, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-199/test_no_overlapping_scans_netw0/nscan
Child process PID: 2544727, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-199/test_invalid_json_format_netwo0/nscan
Child process PID: 2544871, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x77fbea33f1f0>
network_scanner_node = psutil.Process(pid=2544871, name='python3', status='sleeping', started='13:48:36')
network_status_client = (<rclpy.node.Node object at 0x77fbe8ba5c90>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.06s (0:01:25)

stderr:
Process 2544431 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2544474 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2544571 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2544689 no longer exists
Process 2544727 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2544871 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:48:50,402 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:48:50,403 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:48:50,403 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:48:50,404 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:48:50,417 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1122
total_tokens       4471
2025-03-30 13:48:50,417 - root.base_generator - INFO - Iteration 15: Attempt 3 failed.
2025-03-30 13:48:50,418 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 15) ---
2025-03-30 13:48:50,418 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:48:50,418 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:48:50,418 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:48:50,418 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:48:50,418 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:48:50,418 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:48:57,269 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:48:57,272 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:48:57,272 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:48:57,272 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1131, total_tokens=4480
2025-03-30 13:48:57,272 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:48:57,272 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:48:57,272 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:48:57,318 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:48:57,318 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:48:57,319 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:48:57,319 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:48:57,319 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:48:57,319 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:48:57,319 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:50:35,740 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.79s]
.Child process PID: 2545166, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2545214, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2545319, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-200/test_no_overlapping_scans_netw0/nscan
Child process PID: 2545485, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-200/test_invalid_json_format_netwo0/nscan
Child process PID: 2545603, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-200/test_outdated_json_results_net0/nscan
Child process PID: 2545642, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.44s (0:01:35)

stderr:
Process 2545166 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2545214 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2545319 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2545421 no longer exists
Process 2545485 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2545642 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:50:35,741 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:50:35,741 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 13:50:35,742 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 13:50:35,742 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 13:50:35,756 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       105.3
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1131
total_tokens       4480
2025-03-30 13:50:35,756 - root.base_generator - INFO - Iteration 15: Successful attempt achieved.
2025-03-30 13:50:35,756 - root.base_generator - INFO - Iteration 15 finished.
2025-03-30 13:50:35,756 - root.base_generator - INFO -  Iteration 16 started.
2025-03-30 13:50:35,757 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 16) ---
2025-03-30 13:50:35,757 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:50:35,757 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:50:35,757 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:50:35,757 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:50:35,757 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:50:35,757 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:50:42,701 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:50:42,704 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:50:42,704 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:50:42,705 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1138, total_tokens=4487
2025-03-30 13:50:42,705 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:50:42,705 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:50:42,705 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:50:42,787 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:50:42,787 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:50:42,787 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:50:42,787 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:50:42,787 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:50:42,787 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:50:42,787 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:50:42,788 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:50:42,788 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:50:42,788 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:50:42,788 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:50:42,788 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:50:42,788 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:50:42,788 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:52:35,077 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2546101, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2546138, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2546276, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-201/test_no_overlapping_scans_netw0/nscan
Child process PID: 2546464, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-201/test_invalid_json_format_netwo0/nscan
Child process PID: 2546533, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x784751240640>
network_scanner_node = psutil.Process(pid=2546533, name='python3', status='sleeping', started='13:52:20')
network_status_client = (<rclpy.node.Node object at 0x7847512408e0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.07s (0:01:25)

stderr:
Process 2546101 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2546138 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2546276 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2546380 no longer exists
Process 2546464 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2546533 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:52:35,077 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:52:35,078 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:52:35,078 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:52:35,078 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:52:35,092 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.3
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1138
total_tokens       4487
2025-03-30 13:52:35,092 - root.base_generator - INFO - Iteration 16: Attempt 1 failed.
2025-03-30 13:52:35,092 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 16) ---
2025-03-30 13:52:35,092 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:52:35,092 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:52:35,093 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:52:35,093 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:52:35,093 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:52:35,093 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:52:42,199 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:52:42,202 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:52:42,203 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:52:42,203 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1147, total_tokens=4496
2025-03-30 13:52:42,203 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:52:42,203 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:52:42,203 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:52:42,282 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:52:42,283 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:52:42,283 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:52:42,284 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:52:42,284 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:52:42,284 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:52:42,284 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:54:10,071 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.76s]
.Child process PID: 2546844, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2546920, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2547017, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-202/test_no_overlapping_scans_netw0/nscan
Child process PID: 2547206, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-202/test_invalid_json_format_netwo0/nscan
Child process PID: 2547314, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x775716c47310>
network_scanner_node = psutil.Process(pid=2547314, name='python3', status='sleeping', started='13:53:55')
network_status_client = (<rclpy.node.Node object at 0x775716c47a00>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2546844 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2546920 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2547017 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2547151 no longer exists
Process 2547206 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2547314 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:54:10,072 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:54:10,073 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:54:10,073 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:54:10,073 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:54:10,087 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1147
total_tokens       4496
2025-03-30 13:54:10,087 - root.base_generator - INFO - Iteration 16: Attempt 2 failed.
2025-03-30 13:54:10,087 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 16) ---
2025-03-30 13:54:10,088 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:54:10,088 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:54:10,088 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:54:10,088 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:54:10,088 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:54:10,088 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:54:17,284 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:54:17,288 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:54:17,288 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:54:17,288 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1102, total_tokens=4451
2025-03-30 13:54:17,288 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:54:17,289 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:54:17,289 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:54:17,366 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:54:17,366 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:54:17,366 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:54:17,367 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:54:17,367 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:54:17,367 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:54:17,367 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:54:17,367 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:54:17,367 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:54:17,367 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:54:17,367 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:54:17,368 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:54:17,368 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:54:17,368 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:56:02,614 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.74s]
.Child process PID: 2547726, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2547770, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2547903, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-203/test_no_overlapping_scans_netw0/nscan
Child process PID: 2548092, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-203/test_invalid_json_format_netwo0/nscan
Child process PID: 2548175, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7a67ccf48580>
network_scanner_node = psutil.Process(pid=2548175, name='python3', status='sleeping', started='13:55:55')
network_status_client = (<rclpy.node.Node object at 0x7a67cb7a99c0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332158, nanosec=264854450), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7a67cb7a99c0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332158, nanosec=264854450), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.97s (0:01:17)

stderr:
Process 2547726 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2547770 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2547903 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2548027 no longer exists
Process 2548092 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 13:56:02,614 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:56:02,615 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:56:02,615 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:56:02,615 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:56:02,629 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1102
total_tokens       4451
2025-03-30 13:56:02,629 - root.base_generator - INFO - Iteration 16: Attempt 3 failed.
2025-03-30 13:56:02,629 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 16) ---
2025-03-30 13:56:02,630 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:56:02,630 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:56:02,630 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:56:02,630 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:56:02,630 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:56:02,630 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:56:09,687 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:56:09,691 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:56:09,691 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:56:09,691 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1128, total_tokens=4477
2025-03-30 13:56:09,691 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:56:09,691 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:56:09,691 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:56:09,772 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:56:09,772 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:56:09,772 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:56:09,772 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:56:09,772 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:56:09,772 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:56:09,772 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:56:09,772 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:56:09,773 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:56:09,773 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:56:09,773 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:56:09,773 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:56:09,773 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:56:09,773 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:57:44,669 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.76s]
.Child process PID: 2548465, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2548552, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2548642, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-204/test_no_overlapping_scans_netw0/nscan
Child process PID: 2548826, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-204/test_invalid_json_format_netwo0/nscan
Child process PID: 2548947, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x76a77d0e0580>
network_scanner_node = psutil.Process(pid=2548947, name='python3', status='sleeping', started='13:57:30')
network_status_client = (<rclpy.node.Node object at 0x76a77b9a1ff0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2548465 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2548552 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2548642 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2548789 no longer exists
Process 2548826 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2548947 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:57:44,669 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:57:44,670 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:57:44,670 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:57:44,671 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:57:44,685 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       102.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1128
total_tokens       4477
2025-03-30 13:57:44,685 - root.base_generator - INFO - Iteration 16: Attempt 4 failed.
2025-03-30 13:57:44,685 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 16) ---
2025-03-30 13:57:44,686 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:57:44,686 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:57:44,686 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:57:44,686 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:57:44,686 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:57:44,686 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:57:51,784 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:57:51,787 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:57:51,788 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:57:51,788 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1160, total_tokens=4509
2025-03-30 13:57:51,788 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:57:51,788 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:57:51,788 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:57:51,871 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:57:51,871 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:57:51,871 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:57:51,871 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:57:51,872 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:57:51,872 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:57:51,872 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:57:51,872 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:57:51,872 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:57:51,872 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:57:51,872 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:57:51,872 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:57:51,873 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:57:51,873 - root.ros2_runner - INFO - Running tests...
2025-03-30 13:59:44,196 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2549349, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2549426, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2549526, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-205/test_no_overlapping_scans_netw0/nscan
Child process PID: 2549713, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-205/test_invalid_json_format_netwo0/nscan
Child process PID: 2549819, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7927da844580>
network_scanner_node = psutil.Process(pid=2549819, name='python3', status='sleeping', started='13:59:30')
network_status_client = (<rclpy.node.Node object at 0x7927d915dff0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.03s (0:01:25)

stderr:
Process 2549349 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2549426 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2549526 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2549665 no longer exists
Process 2549713 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2549819 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 13:59:44,196 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 13:59:44,197 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 13:59:44,197 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 13:59:44,197 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 13:59:44,212 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1160
total_tokens       4509
2025-03-30 13:59:44,212 - root.base_generator - INFO - Iteration 16: Attempt 5 failed.
2025-03-30 13:59:44,212 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 16) ---
2025-03-30 13:59:44,212 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 13:59:44,213 - root.generation_attempt - INFO - Initializing...
2025-03-30 13:59:44,213 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 13:59:44,213 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 13:59:44,213 - root.generation_attempt - INFO - Generating code...
2025-03-30 13:59:44,213 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 13:59:51,067 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 13:59:51,071 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 13:59:51,071 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 13:59:51,071 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1106, total_tokens=4455
2025-03-30 13:59:51,071 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 13:59:51,071 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 13:59:51,072 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 13:59:51,149 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 13:59:51,149 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 13:59:51,149 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 13:59:51,149 - root.generation_attempt - INFO - Saving code...
2025-03-30 13:59:51,149 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 13:59:51,150 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 13:59:51,150 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 13:59:51,150 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 13:59:51,150 - root.generation_attempt - INFO - Running tests...
2025-03-30 13:59:51,150 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 13:59:51,150 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 13:59:51,150 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 13:59:51,150 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 13:59:51,150 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:01:12,103 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.74s]
.Child process PID: 2550082, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2550189, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2550264, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-206/test_no_overlapping_scans_netw0/nscan
Child process PID: 2550449, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-206/test_invalid_json_format_netwo0/nscan
Child process PID: 2550586, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e2f83c45000>
network_scanner_node = psutil.Process(pid=2550586, name='python3', status='sleeping', started='14:01:05')
network_status_client = (<rclpy.node.Node object at 0x7e2f83c47430>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332467, nanosec=726730354), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7e2f83c47430>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332467, nanosec=726730354), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 78.00s (0:01:17)

stderr:
Process 2550082 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2550189 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2550264 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2550408 no longer exists
Process 2550449 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:01:12,103 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:01:12,104 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:01:12,104 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:01:12,104 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:01:12,119 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       87.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1106
total_tokens       4455
2025-03-30 14:01:12,120 - root.base_generator - INFO - Iteration 16: Attempt 6 failed.
2025-03-30 14:01:12,120 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 16) ---
2025-03-30 14:01:12,120 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:01:12,120 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:01:12,120 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:01:12,120 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:01:12,120 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:01:12,120 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:01:19,487 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:01:19,491 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:01:19,491 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:01:19,491 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1196, total_tokens=4545
2025-03-30 14:01:19,492 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:01:19,492 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:01:19,492 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:01:19,573 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:01:19,573 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:01:19,573 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:01:19,573 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:01:19,574 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:01:19,574 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:01:19,574 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:01:19,574 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:01:19,574 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:01:19,574 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:01:19,574 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:01:19,575 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:01:19,575 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:01:19,575 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:03:11,905 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.74s]
.Child process PID: 2550950, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2550989, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2551128, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-207/test_no_overlapping_scans_netw0/nscan
Child process PID: 2551313, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-207/test_invalid_json_format_netwo0/nscan
Child process PID: 2551387, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7c8d17f38f70>
network_scanner_node = psutil.Process(pid=2551387, name='python3', status='sleeping', started='14:02:57')
network_status_client = (<rclpy.node.Node object at 0x7c8d17f3b970>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2550950 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2550989 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2551128 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2551239 no longer exists
Process 2551313 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2551387 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:03:11,906 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:03:11,907 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:03:11,907 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:03:11,907 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:03:11,921 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1196
total_tokens       4545
2025-03-30 14:03:11,922 - root.base_generator - INFO - Iteration 16: Attempt 7 failed.
2025-03-30 14:03:11,922 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 16) ---
2025-03-30 14:03:11,922 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:03:11,922 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:03:11,922 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:03:11,922 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:03:11,922 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:03:11,922 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:03:18,970 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:03:18,973 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:03:18,973 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:03:18,974 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1103, total_tokens=4452
2025-03-30 14:03:18,974 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:03:18,974 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:03:18,974 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:03:19,054 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:03:19,054 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:03:19,054 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:03:19,054 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:03:19,055 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:03:19,055 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:03:19,055 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:03:19,055 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:03:19,055 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:03:19,055 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:03:19,055 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:03:19,055 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:03:19,056 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:03:19,056 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:04:46,867 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.76s]
.Child process PID: 2551688, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2551771, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2551868, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-208/test_no_overlapping_scans_netw0/nscan
Child process PID: 2552054, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-208/test_invalid_json_format_netwo0/nscan
Child process PID: 2552171, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e1cc78ded10>
network_scanner_node = psutil.Process(pid=2552171, name='python3', status='sleeping', started='14:04:32')
network_status_client = (<rclpy.node.Node object at 0x7e1cc61a5780>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2551688 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2551771 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2551868 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2552007 no longer exists
Process 2552054 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2552171 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:04:46,867 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:04:46,868 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:04:46,868 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:04:46,869 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:04:46,884 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1103
total_tokens       4452
2025-03-30 14:04:46,884 - root.base_generator - INFO - Iteration 16: Attempt 8 failed.
2025-03-30 14:04:46,884 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 16) ---
2025-03-30 14:04:46,884 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:04:46,884 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:04:46,885 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:04:46,885 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:04:46,885 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:04:46,885 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:04:53,747 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:04:53,750 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:04:53,750 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:04:53,750 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1112, total_tokens=4461
2025-03-30 14:04:53,751 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:04:53,751 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:04:53,751 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:04:53,823 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:04:53,823 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:04:53,823 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:04:53,823 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:04:53,823 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:04:53,823 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:04:53,823 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:04:53,824 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:04:53,824 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:04:53,824 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:04:53,824 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:04:53,824 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:04:53,824 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:04:53,824 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:06:42,107 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.74s]
.Child process PID: 2553412, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2553468, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2553585, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-209/test_no_overlapping_scans_netw0/nscan
Child process PID: 2553774, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-209/test_invalid_json_format_netwo0/nscan
Child process PID: 2553844, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x711587c45060>
network_scanner_node = psutil.Process(pid=2553844, name='python3', status='sleeping', started='14:06:32')
network_status_client = (<rclpy.node.Node object at 0x711586d39de0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332794, nanosec=673218505), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x711586d39de0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332794, nanosec=673218505), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2553412 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2553468 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2553585 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2553700 no longer exists
Process 2553774 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2553844 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:06:42,107 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:06:42,108 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:06:42,108 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:06:42,108 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:06:42,123 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.2
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1112
total_tokens       4461
2025-03-30 14:06:42,123 - root.base_generator - INFO - Iteration 16: Attempt 9 failed.
2025-03-30 14:06:42,123 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 16) ---
2025-03-30 14:06:42,124 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:06:42,124 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:06:42,124 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:06:42,124 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:06:42,124 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:06:42,124 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:06:49,130 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:06:49,134 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:06:49,134 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:06:49,134 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1165, total_tokens=4514
2025-03-30 14:06:49,134 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:06:49,135 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:06:49,135 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:06:49,215 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:06:49,216 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:06:49,216 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:06:49,216 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:06:49,216 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:06:49,216 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:06:49,216 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:06:49,216 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:06:49,217 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:06:49,217 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:06:49,217 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:06:49,217 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:06:49,217 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:06:49,217 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:08:17,145 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2554148, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2554237, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2554318, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-210/test_no_overlapping_scans_netw0/nscan
Child process PID: 2554516, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-210/test_invalid_json_format_netwo0/nscan
Child process PID: 2554636, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7845a12d8670>
network_scanner_node = psutil.Process(pid=2554636, name='python3', status='sleeping', started='14:08:07')
network_status_client = (<rclpy.node.Node object at 0x7845a12d8c10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332889, nanosec=706958744), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7845a12d8c10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743332889, nanosec=706958744), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.11s (0:01:21)

stderr:
Process 2554148 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2554237 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2554318 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2554468 no longer exists
Process 2554516 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2554636 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:08:17,146 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:08:17,147 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:08:17,147 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:08:17,147 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:08:17,162 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1165
total_tokens       4514
2025-03-30 14:08:17,162 - root.base_generator - INFO - Iteration 16: Attempt 10 failed.
2025-03-30 14:08:17,163 - root.base_generator - INFO - --- Starting Attempt 11 (Iteration 16) ---
2025-03-30 14:08:17,163 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:08:17,163 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:08:17,163 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:08:17,163 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:08:17,163 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:08:17,163 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:08:24,339 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:08:24,344 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:08:24,345 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:08:24,345 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1175, total_tokens=4524
2025-03-30 14:08:24,345 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:08:24,345 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:08:24,345 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:08:24,673 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:08:24,673 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:08:24,673 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:08:24,673 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:08:24,673 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:08:24,673 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:08:24,674 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:08:24,674 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:08:24,674 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:08:24,674 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:08:24,674 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:08:24,674 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:08:24,674 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:08:24,674 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:10:12,950 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.74s]
.Child process PID: 2555020, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2555131, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2555266, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-211/test_no_overlapping_scans_netw0/nscan
Child process PID: 2555453, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-211/test_invalid_json_format_netwo0/nscan
Child process PID: 2555523, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ad5387cf1f0>
network_scanner_node = psutil.Process(pid=2555523, name='python3', status='sleeping', started='14:10:02')
network_status_client = (<rclpy.node.Node object at 0x7ad5387ccd00>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333005, nanosec=537498961), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7ad5387ccd00>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333005, nanosec=537498961), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2555020 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2555131 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2555266 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2555380 no longer exists
Process 2555453 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2555523 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:10:12,951 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:10:12,952 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:10:12,952 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:10:12,952 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:10:12,968 - root.base_generator - INFO - Attempt 11 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1175
total_tokens       4524
2025-03-30 14:10:12,968 - root.base_generator - INFO - Iteration 16: Attempt 11 failed.
2025-03-30 14:10:12,968 - root.base_generator - INFO - --- Starting Attempt 12 (Iteration 16) ---
2025-03-30 14:10:12,968 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:10:12,968 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:10:12,968 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:10:12,969 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:10:12,969 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:10:12,969 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:10:19,887 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:10:19,890 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:10:19,891 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:10:19,891 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1112, total_tokens=4461
2025-03-30 14:10:19,891 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:10:19,891 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:10:19,891 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:10:19,972 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:10:19,972 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:10:19,972 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:10:19,972 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:10:19,973 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:10:19,973 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:10:19,973 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:10:19,973 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:10:19,973 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:10:19,973 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:10:19,973 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:10:19,973 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:10:19,973 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:10:19,973 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:11:44,874 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.63s]

Summary: 1 package finished [0.82s]
.Child process PID: 2555826, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2555905, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2555999, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-212/test_no_overlapping_scans_netw0/nscan
Child process PID: 2556192, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-212/test_invalid_json_format_netwo0/nscan
Child process PID: 2556300, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x74f51d43c640>
network_scanner_node = psutil.Process(pid=2556300, name='python3', status='sleeping', started='14:11:37')
network_status_client = (<rclpy.node.Node object at 0x74f51d43ca90>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333100, nanosec=508976391), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x74f51d43ca90>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333100, nanosec=508976391), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.99s (0:01:17)

stderr:
Process 2555826 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2555905 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2555999 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2556144 no longer exists
Process 2556192 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:11:44,874 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:11:44,875 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:11:44,875 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:11:44,876 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:11:44,890 - root.base_generator - INFO - Attempt 12 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1112
total_tokens       4461
2025-03-30 14:11:44,890 - root.base_generator - INFO - Iteration 16: Attempt 12 failed.
2025-03-30 14:11:44,890 - root.base_generator - INFO - --- Starting Attempt 13 (Iteration 16) ---
2025-03-30 14:11:44,891 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:11:44,891 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:11:44,891 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:11:44,891 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:11:44,891 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:11:44,891 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:11:52,029 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:11:52,032 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:11:52,033 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:11:52,033 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1134, total_tokens=4483
2025-03-30 14:11:52,033 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:11:52,033 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:11:52,033 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:11:52,112 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:11:52,112 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:11:52,112 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:11:52,112 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:11:52,113 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:11:52,113 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:11:52,113 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:11:52,113 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:11:52,113 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:11:52,113 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:11:52,113 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:11:52,113 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:11:52,113 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:11:52,113 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:13:40,362 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.72s]
.Child process PID: 2556689, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2556732, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2556860, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-213/test_no_overlapping_scans_netw0/nscan
Child process PID: 2557034, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-213/test_invalid_json_format_netwo0/nscan
Child process PID: 2557124, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7c1e52942d40>
network_scanner_node = psutil.Process(pid=2557124, name='python3', status='sleeping', started='14:13:30')
network_status_client = (<rclpy.node.Node object at 0x7c1e529405e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333212, nanosec=913760708), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7c1e529405e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333212, nanosec=913760708), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2556689 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2556732 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2556860 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2556943 no longer exists
Process 2557034 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2557124 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:13:40,363 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:13:40,364 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:13:40,364 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:13:40,364 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:13:40,379 - root.base_generator - INFO - Attempt 13 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1134
total_tokens       4483
2025-03-30 14:13:40,380 - root.base_generator - INFO - Iteration 16: Attempt 13 failed.
2025-03-30 14:13:40,380 - root.base_generator - INFO - --- Starting Attempt 14 (Iteration 16) ---
2025-03-30 14:13:40,380 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:13:40,380 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:13:40,380 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:13:40,380 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:13:40,380 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:13:40,380 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:13:47,580 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:13:47,584 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:13:47,584 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:13:47,584 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1138, total_tokens=4487
2025-03-30 14:13:47,584 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:13:47,585 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:13:47,585 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:13:47,667 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:13:47,667 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:13:47,667 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:13:47,667 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:13:47,668 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:13:47,668 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:13:47,668 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:13:47,668 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:13:47,668 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:13:47,668 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:13:47,668 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:13:47,668 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:13:47,668 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:13:47,668 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:15:19,343 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2557423, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2557468, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2557603, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-214/test_no_overlapping_scans_netw0/nscan
Child process PID: 2557783, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-214/test_invalid_json_format_netwo0/nscan
Child process PID: 2557861, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x766546844640>
network_scanner_node = psutil.Process(pid=2557861, name='python3', status='sleeping', started='14:15:05')
network_status_client = (<rclpy.node.Node object at 0x766545931960>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.03s (0:01:25)

stderr:
Process 2557423 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2557468 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2557603 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2557682 no longer exists
Process 2557783 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2557861 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:15:19,343 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:15:19,344 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:15:19,344 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:15:19,345 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:15:19,359 - root.base_generator - INFO - Attempt 14 finished with metrics:
metric             value
-----------------  -------
attempt_time       99.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1138
total_tokens       4487
2025-03-30 14:15:19,360 - root.base_generator - INFO - Iteration 16: Attempt 14 failed.
2025-03-30 14:15:19,360 - root.base_generator - INFO - --- Starting Attempt 15 (Iteration 16) ---
2025-03-30 14:15:19,360 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:15:19,360 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:15:19,360 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:15:19,360 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:15:19,360 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:15:19,360 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:15:26,331 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:15:26,335 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:15:26,335 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:15:26,335 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1163, total_tokens=4512
2025-03-30 14:15:26,335 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:15:26,335 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:15:26,336 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:15:26,416 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:15:26,416 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:15:26,416 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:15:26,416 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:15:26,416 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:15:26,416 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:15:26,416 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:15:26,416 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:15:26,417 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:15:26,417 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:15:26,417 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:15:26,417 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:15:26,417 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:15:26,417 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:17:18,758 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.76s]
.Child process PID: 2558310, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2558347, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2558466, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-215/test_no_overlapping_scans_netw0/nscan
Child process PID: 2558638, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-215/test_invalid_json_format_netwo0/nscan
Child process PID: 2558744, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b14c8d42d10>
network_scanner_node = psutil.Process(pid=2558744, name='python3', status='sleeping', started='14:17:04')
network_status_client = (<rclpy.node.Node object at 0x7b14c75a5990>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2558310 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2558347 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2558466 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2558561 no longer exists
Process 2558638 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2558744 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:17:18,758 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:17:18,759 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:17:18,759 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:17:18,759 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:17:18,775 - root.base_generator - INFO - Attempt 15 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1163
total_tokens       4512
2025-03-30 14:17:18,775 - root.base_generator - INFO - Iteration 16: Attempt 15 failed.
2025-03-30 14:17:18,776 - root.base_generator - INFO - --- Starting Attempt 16 (Iteration 16) ---
2025-03-30 14:17:18,776 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:17:18,776 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:17:18,776 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:17:18,776 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:17:18,776 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:17:18,776 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:17:25,586 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:17:25,590 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:17:25,590 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:17:25,590 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1087, total_tokens=4436
2025-03-30 14:17:25,590 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:17:25,590 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:17:25,591 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:17:25,670 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:17:25,671 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:17:25,671 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:17:25,671 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:17:25,671 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:17:25,671 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:17:25,671 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:17:25,671 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:17:25,672 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:17:25,672 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:17:25,672 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:17:25,672 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:17:25,672 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:17:25,672 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:18:46,626 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.77s]
.Child process PID: 2559044, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2559087, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2559219, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-216/test_no_overlapping_scans_netw0/nscan
Child process PID: 2559395, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-216/test_invalid_json_format_netwo0/nscan
Child process PID: 2559478, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x77944c84c640>
network_scanner_node = psutil.Process(pid=2559478, name='python3', status='sleeping', started='14:18:39')
network_status_client = (<rclpy.node.Node object at 0x77944b93d960>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333522, nanosec=266275104), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x77944b93d960>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333522, nanosec=266275104), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.94s (0:01:17)

stderr:
Process 2559044 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2559087 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2559219 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2559302 no longer exists
Process 2559395 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:18:46,626 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:18:46,627 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:18:46,627 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:18:46,627 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:18:46,643 - root.base_generator - INFO - Attempt 16 finished with metrics:
metric             value
-----------------  -------
attempt_time       87.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1087
total_tokens       4436
2025-03-30 14:18:46,643 - root.base_generator - INFO - Iteration 16: Attempt 16 failed.
2025-03-30 14:18:46,643 - root.base_generator - INFO - --- Starting Attempt 17 (Iteration 16) ---
2025-03-30 14:18:46,643 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:18:46,644 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:18:46,644 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:18:46,644 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:18:46,644 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:18:46,644 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:18:53,704 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:18:53,707 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:18:53,708 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:18:53,708 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1140, total_tokens=4489
2025-03-30 14:18:53,708 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:18:53,708 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:18:53,708 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:18:53,790 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:18:53,790 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:18:53,790 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:18:53,790 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:18:53,791 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:18:53,791 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:18:53,791 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:18:53,791 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:18:53,791 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:18:53,791 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:18:53,791 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:18:53,791 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:18:53,791 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:18:53,791 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:20:46,109 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.77s]
.Child process PID: 2559890, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2559947, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2560011, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-217/test_no_overlapping_scans_netw0/nscan
Child process PID: 2560198, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-217/test_invalid_json_format_netwo0/nscan
Child process PID: 2560340, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7cfe66d38670>
network_scanner_node = psutil.Process(pid=2560340, name='python3', status='sleeping', started='14:20:32')
network_status_client = (<rclpy.node.Node object at 0x7cfe66d38ac0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.02s (0:01:25)

stderr:
Process 2559890 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2559947 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2560011 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2560152 no longer exists
Process 2560198 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2560340 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:20:46,109 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:20:46,110 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:20:46,110 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:20:46,111 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:20:46,132 - root.base_generator - INFO - Attempt 17 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1140
total_tokens       4489
2025-03-30 14:20:46,132 - root.base_generator - INFO - Iteration 16: Attempt 17 failed.
2025-03-30 14:20:46,132 - root.base_generator - INFO - --- Starting Attempt 18 (Iteration 16) ---
2025-03-30 14:20:46,133 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:20:46,133 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:20:46,133 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:20:46,133 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:20:46,134 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:20:46,134 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:20:52,924 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:20:52,928 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:20:52,928 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:20:52,928 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1102, total_tokens=4451
2025-03-30 14:20:52,928 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:20:52,928 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:20:52,928 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:20:53,021 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:20:53,021 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:20:53,021 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:20:53,021 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:20:53,021 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:20:53,022 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:20:53,022 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:20:53,022 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:20:53,022 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:20:53,022 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:20:53,022 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:20:53,022 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:20:53,022 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:20:53,022 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:22:14,038 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2560636, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2560677, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2560755, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-218/test_no_overlapping_scans_netw0/nscan
Child process PID: 2560937, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-218/test_invalid_json_format_netwo0/nscan
Child process PID: 2561074, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e87a9145030>
network_scanner_node = psutil.Process(pid=2561074, name='python3', status='sleeping', started='14:22:07')
network_status_client = (<rclpy.node.Node object at 0x7e87a9147550>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333729, nanosec=686189286), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7e87a9147550>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333729, nanosec=686189286), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.94s (0:01:17)

stderr:
Process 2560636 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2560677 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2560755 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2560891 no longer exists
Process 2560937 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:22:14,038 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:22:14,039 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:22:14,040 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:22:14,040 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:22:14,056 - root.base_generator - INFO - Attempt 18 finished with metrics:
metric             value
-----------------  -------
attempt_time       87.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1102
total_tokens       4451
2025-03-30 14:22:14,056 - root.base_generator - INFO - Iteration 16: Attempt 18 failed.
2025-03-30 14:22:14,056 - root.base_generator - INFO - --- Starting Attempt 19 (Iteration 16) ---
2025-03-30 14:22:14,056 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:22:14,057 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:22:14,057 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:22:14,057 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:22:14,057 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:22:14,057 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:22:21,279 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:22:21,283 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:22:21,283 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:22:21,283 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1158, total_tokens=4507
2025-03-30 14:22:21,283 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:22:21,284 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:22:21,284 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:22:21,364 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:22:21,364 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:22:21,364 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:22:21,365 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:22:21,365 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:22:21,365 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:22:21,365 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:22:21,365 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:22:21,365 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:22:21,365 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:22:21,365 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:22:21,365 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:22:21,365 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:22:21,366 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:22:52,101 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.74s]
.E
==================================== ERRORS ====================================
_________________ ERROR at setup of TestFull.test_node_running _________________

request = <SubRequest 'network_scanner_node' for <Function test_node_running>>
tmp_path = PosixPath('/tmp/pytest-of-aleev/pytest-219/test_node_running0')
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x72da3c73d480>

    @pytest.fixture(scope="function")
    def network_scanner_node(request, tmp_path, monkeypatch):
        """Fixture that sets up a network scanner node with the provided parameters."""
        if not rclpy.ok():
            rclpy.init()

        # Default parameters
        network = "4.2.2.2"
        scan_period = 3
        mock_nscan = False
        mock_nscan_text = """#!/bin/bash
        echo "NSCAN"
        """
        if hasattr(request, "param"):
            params = request.param
            network = params.get("network", network)
            scan_period = params.get("scan_period", scan_period)
            mock_nscan = params.get("mock_nscan", mock_nscan)
            mock_nscan_text = params.get("mock_nscan_text", mock_nscan_text)

        if mock_nscan:
            print("Using mock nscan binary")
            nscan_path = os.path.join(tmp_path, "nscan")
            with open(nscan_path, "w") as f:
                f.write(mock_nscan_text)
            os.chmod(nscan_path, 0o755)

            monkeypatch.setenv("PATH", f"{tmp_path}:{os.environ.get('PATH')}")
            print(f"nscan path: {nscan_path}")

        runner = ros2_runner.ROS2Runner(
            node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={network!r} -p scan_period:={scan_period}",
            test_command="",
        )
>       runner.start_node()

src/network_scanner/test/test_scanner_node.py:46:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <codestral_ros2_gen.utils.ros2_runner.ROS2Runner object at 0x72da3c73d4b0>

    def start_node(self) -> None:
        """
        Start the ROS2 node and verify it launched successfully.

        If "skip / SKIP" is found in the node_command, the node is not started.

        Raises:
            RuntimeError: If the node fails to start or register with ROS2.
        """
        logger.info("Starting the ROS2 node...")
        if "skip" in self.node_command.lower():
            logger.info("Skipping node start as requested.")
            return
        else:
            self.node_process = subprocess.Popen(
                self.node_command,
                shell=True,
                executable="/bin/bash",
                stderr=subprocess.PIPE,
                stdout=subprocess.PIPE,
                text=True,
            )

            # Wait briefly for node to initialize
            time.sleep(2)

            # Check if process is still running
            if self.node_process.poll() is not None:
                # Process terminated - get error output
                stdout, stderr = self.node_process.communicate()
                error_msg = f"Node process terminated immediately.\nStdout: {stdout}\nStderr: {stderr}"
>               raise RuntimeError(error_msg)
E               RuntimeError: Node process terminated immediately.
E               Stdout: [ros2run]: Process exited with failure 1
E
E               Stderr: Traceback (most recent call last):
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 10, in <module>
E                   from rclpy.exceptions import ParameterNotDeclaredException, ParameterValueException
E               ImportError: cannot import name 'ParameterValueException' from 'rclpy.exceptions' (/opt/ros/humble/local/lib/python3.10/dist-packages/rclpy/exceptions.py)

../codestral_ros2_gen/src/codestral_ros2_gen/utils/ros2_runner.py:79: RuntimeError
=========================== short test summary info ============================
ERROR src/network_scanner/test/test_scanner_node.py::TestFull::test_node_running
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 passed, 1 error in 3.59s

stderr:

2025-03-30 14:22:52,101 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:22:52,102 - root.ros2_runner - INFO - Tests failed: 0, passed: 1, skipped: 0
2025-03-30 14:22:52,102 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:22:52,102 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:22:52,118 - root.base_generator - INFO - Attempt 19 finished with metrics:
metric             value
-----------------  -------
attempt_time       38.0
success            False
final_state        TEST
tests_passed       1
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1158
total_tokens       4507
2025-03-30 14:22:52,118 - root.base_generator - INFO - Iteration 16: Attempt 19 failed.
2025-03-30 14:22:52,119 - root.base_generator - INFO - --- Starting Attempt 20 (Iteration 16) ---
2025-03-30 14:22:52,119 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:22:52,119 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:22:52,119 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:22:52,119 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:22:52,119 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:22:52,119 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:22:59,662 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:22:59,666 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:22:59,666 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:22:59,666 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1224, total_tokens=4573
2025-03-30 14:22:59,666 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:22:59,667 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:22:59,667 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:22:59,745 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:22:59,745 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:22:59,745 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:22:59,745 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:22:59,746 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:22:59,746 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:22:59,746 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:22:59,746 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:22:59,746 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:22:59,746 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:22:59,746 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:22:59,746 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:22:59,746 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:22:59,746 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:24:48,089 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2561803, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2561869, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2561932, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-220/test_no_overlapping_scans_netw0/nscan
Child process PID: 2562113, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-220/test_invalid_json_format_netwo0/nscan
Child process PID: 2562257, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x73ad57041030>
network_scanner_node = psutil.Process(pid=2562257, name='python3', status='sleeping', started='14:24:37')
network_status_client = (<rclpy.node.Node object at 0x73ad57041ae0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333880, nanosec=628165533), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x73ad57041ae0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333880, nanosec=628165533), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2561803 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2561869 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2561932 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2562073 no longer exists
Process 2562113 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2562257 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:24:48,089 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:24:48,090 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:24:48,090 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:24:48,090 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:24:48,106 - root.base_generator - INFO - Attempt 20 finished with metrics:
metric             value
-----------------  -------
attempt_time       116.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1224
total_tokens       4573
2025-03-30 14:24:48,107 - root.base_generator - INFO - Iteration 16: Attempt 20 failed.
2025-03-30 14:24:48,107 - root.base_generator - INFO - --- Starting Attempt 21 (Iteration 16) ---
2025-03-30 14:24:48,107 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:24:48,107 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:24:48,107 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:24:48,107 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:24:48,108 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:24:48,108 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:24:55,224 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:24:55,228 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:24:55,228 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:24:55,228 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1123, total_tokens=4472
2025-03-30 14:24:55,228 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:24:55,228 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:24:55,228 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:24:55,308 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:24:55,308 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:24:55,308 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:24:55,308 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:24:55,309 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:24:55,309 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:24:55,309 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:24:55,309 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:24:55,309 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:24:55,309 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:24:55,309 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:24:55,309 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:24:55,309 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:24:55,309 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:26:40,535 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2562627, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2562718, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2562798, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-221/test_no_overlapping_scans_netw0/nscan
Child process PID: 2562983, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-221/test_invalid_json_format_netwo0/nscan
Child process PID: 2563103, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7debae4c7310>
network_scanner_node = psutil.Process(pid=2563103, name='python3', status='sleeping', started='14:26:33')
network_status_client = (<rclpy.node.Node object at 0x7debae4c7880>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333996, nanosec=179899880), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7debae4c7880>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743333996, nanosec=179899880), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.94s (0:01:17)

stderr:
Process 2562627 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2562718 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2562798 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2562940 no longer exists
Process 2562983 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:26:40,535 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:26:40,536 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:26:40,536 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:26:40,537 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:26:40,553 - root.base_generator - INFO - Attempt 21 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1123
total_tokens       4472
2025-03-30 14:26:40,553 - root.base_generator - INFO - Iteration 16: Attempt 21 failed.
2025-03-30 14:26:40,553 - root.base_generator - INFO - --- Starting Attempt 22 (Iteration 16) ---
2025-03-30 14:26:40,554 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:26:40,554 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:26:40,554 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:26:40,554 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:26:40,554 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:26:40,554 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:26:47,488 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:26:47,491 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:26:47,492 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:26:47,492 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1116, total_tokens=4465
2025-03-30 14:26:47,492 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:26:47,492 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:26:47,492 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:26:47,573 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:26:47,573 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:26:47,573 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:26:47,573 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:26:47,574 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:26:47,574 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:26:47,574 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:26:47,574 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:26:47,574 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:26:47,574 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:26:47,574 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:26:47,574 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:26:47,574 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:26:47,574 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:28:15,563 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.77s]
.Child process PID: 2563363, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2563466, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2563534, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-222/test_no_overlapping_scans_netw0/nscan
Child process PID: 2563723, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-222/test_invalid_json_format_netwo0/nscan
Child process PID: 2563863, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x754e3c0d8670>
network_scanner_node = psutil.Process(pid=2563863, name='python3', status='sleeping', started='14:28:08')
network_status_client = (<rclpy.node.Node object at 0x754e3a9a59c0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334091, nanosec=180843818), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x754e3a9a59c0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334091, nanosec=180843818), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 78.00s (0:01:17)

stderr:
Process 2563363 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2563466 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2563534 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2563683 no longer exists
Process 2563723 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:28:15,564 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:28:15,565 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:28:15,565 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:28:15,565 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:28:15,581 - root.base_generator - INFO - Attempt 22 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1116
total_tokens       4465
2025-03-30 14:28:15,582 - root.base_generator - INFO - Iteration 16: Attempt 22 failed.
2025-03-30 14:28:15,582 - root.base_generator - INFO - --- Starting Attempt 23 (Iteration 16) ---
2025-03-30 14:28:15,582 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:28:15,582 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:28:15,582 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:28:15,582 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:28:15,583 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:28:15,583 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:28:22,887 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:28:22,891 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:28:22,891 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:28:22,891 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1127, total_tokens=4476
2025-03-30 14:28:22,891 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:28:22,891 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:28:22,892 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:28:22,972 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:28:22,972 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:28:22,972 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:28:22,972 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:28:22,973 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:28:22,973 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:28:22,973 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:28:22,973 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:28:22,973 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:28:22,973 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:28:22,973 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:28:22,973 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:28:22,973 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:28:22,974 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:30:11,307 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2564220, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2564263, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2564401, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-223/test_no_overlapping_scans_netw0/nscan
Child process PID: 2564581, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-223/test_invalid_json_format_netwo0/nscan
Child process PID: 2564655, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x786c6aeced10>
network_scanner_node = psutil.Process(pid=2564655, name='python3', status='sleeping', started='14:30:01')
network_status_client = (<rclpy.node.Node object at 0x786c69752050>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334203, nanosec=868909242), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x786c69752050>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334203, nanosec=868909242), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2564220 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2564263 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2564401 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2564501 no longer exists
Process 2564581 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2564655 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:30:11,307 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:30:11,308 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:30:11,309 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:30:11,309 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:30:11,325 - root.base_generator - INFO - Attempt 23 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1127
total_tokens       4476
2025-03-30 14:30:11,326 - root.base_generator - INFO - Iteration 16: Attempt 23 failed.
2025-03-30 14:30:11,326 - root.base_generator - INFO - --- Starting Attempt 24 (Iteration 16) ---
2025-03-30 14:30:11,326 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:30:11,326 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:30:11,326 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:30:11,326 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:30:11,327 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:30:11,327 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:30:17,964 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:30:17,968 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:30:17,968 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:30:17,968 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1090, total_tokens=4439
2025-03-30 14:30:17,968 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:30:17,968 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:30:17,968 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:30:18,048 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:30:18,048 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:30:18,048 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:30:18,048 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:30:18,048 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:30:18,048 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:30:18,049 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:30:18,049 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:30:18,049 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:30:18,049 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:30:18,049 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:30:18,049 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:30:18,049 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:30:18,049 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:32:00,752 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2564959, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2565036, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2565134, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-224/test_no_overlapping_scans_netw0/nscan
Child process PID: 2565327, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-224/test_invalid_json_format_netwo0/nscan
Child process PID: 2565432, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-224/test_outdated_json_results_net0/nscan
Child process PID: 2565513, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.50s (0:01:35)

stderr:
Process 2564959 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2565036 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2565134 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2565263 no longer exists
Process 2565327 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2565513 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:32:00,752 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:32:00,753 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 14:32:00,753 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 14:32:00,753 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 14:32:00,770 - root.base_generator - INFO - Attempt 24 finished with metrics:
metric             value
-----------------  -------
attempt_time       109.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1090
total_tokens       4439
2025-03-30 14:32:00,770 - root.base_generator - INFO - Iteration 16: Successful attempt achieved.
2025-03-30 14:32:00,770 - root.base_generator - INFO - Iteration 16 finished.
2025-03-30 14:32:00,770 - root.base_generator - INFO -  Iteration 17 started.
2025-03-30 14:32:00,770 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 17) ---
2025-03-30 14:32:00,770 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:32:00,771 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:32:00,771 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:32:00,771 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:32:00,771 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:32:00,771 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:32:08,085 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:32:08,089 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:32:08,089 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:32:08,089 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1138, total_tokens=4487
2025-03-30 14:32:08,089 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:32:08,089 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:32:08,089 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:32:08,167 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:32:08,167 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:32:08,167 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:32:08,167 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:32:08,168 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:32:08,168 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:32:08,168 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:32:08,168 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:32:08,168 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:32:08,168 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:32:08,168 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:32:08,168 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:32:08,168 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:32:08,168 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:33:56,526 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.79s]
.Child process PID: 2565934, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2566013, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2566077, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-225/test_no_overlapping_scans_netw0/nscan
Child process PID: 2566263, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-225/test_invalid_json_format_netwo0/nscan
Child process PID: 2566405, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x79195f13cfd0>
network_scanner_node = psutil.Process(pid=2566405, name='python3', status='sleeping', started='14:33:46')
network_status_client = (<rclpy.node.Node object at 0x79195f13f520>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334429, nanosec=101188590), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x79195f13f520>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334429, nanosec=101188590), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2565934 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2566013 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2566077 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2566224 no longer exists
Process 2566263 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2566405 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:33:56,526 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:33:56,527 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:33:56,528 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:33:56,528 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:33:56,545 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1138
total_tokens       4487
2025-03-30 14:33:56,545 - root.base_generator - INFO - Iteration 17: Attempt 1 failed.
2025-03-30 14:33:56,545 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 17) ---
2025-03-30 14:33:56,545 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:33:56,545 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:33:56,545 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:33:56,546 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:33:56,546 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:33:56,546 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:34:03,441 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:34:03,445 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:34:03,445 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:34:03,445 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1110, total_tokens=4459
2025-03-30 14:34:03,445 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:34:03,446 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:34:03,446 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:34:03,524 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:34:03,524 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:34:03,524 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:34:03,524 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:34:03,525 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:34:03,525 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:34:03,525 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:34:03,525 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:34:03,525 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:34:03,525 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:34:03,525 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:34:03,525 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:34:03,525 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:34:03,525 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:35:28,408 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.76s]
.Child process PID: 2566692, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2566749, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2566827, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-226/test_no_overlapping_scans_netw0/nscan
Child process PID: 2567008, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-226/test_invalid_json_format_netwo0/nscan
Child process PID: 2567144, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7836809e4640>
network_scanner_node = psutil.Process(pid=2567144, name='python3', status='sleeping', started='14:35:21')
network_status_client = (<rclpy.node.Node object at 0x78367facd930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334524, nanosec=44068746), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x78367facd930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334524, nanosec=44068746), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.94s (0:01:17)

stderr:
Process 2566692 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2566749 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2566827 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2566953 no longer exists
Process 2567008 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:35:28,408 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:35:28,409 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:35:28,409 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:35:28,409 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:35:28,426 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1110
total_tokens       4459
2025-03-30 14:35:28,426 - root.base_generator - INFO - Iteration 17: Attempt 2 failed.
2025-03-30 14:35:28,426 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 17) ---
2025-03-30 14:35:28,426 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:35:28,426 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:35:28,426 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:35:28,426 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:35:28,427 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:35:28,427 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:35:35,797 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:35:35,800 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:35:35,800 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:35:35,800 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1177, total_tokens=4526
2025-03-30 14:35:35,801 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:35:35,801 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:35:35,801 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:35:35,880 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:35:35,880 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:35:35,880 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:35:35,880 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:35:35,881 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:35:35,881 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:35:35,881 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:35:35,881 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:35:35,881 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:35:35,881 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:35:35,881 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:35:35,881 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:35:35,881 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:35:35,881 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:37:24,245 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2567503, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2567590, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2567667, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-227/test_no_overlapping_scans_netw0/nscan
Child process PID: 2567860, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-227/test_invalid_json_format_netwo0/nscan
Child process PID: 2567980, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x739d31a3cfd0>
network_scanner_node = psutil.Process(pid=2567980, name='python3', status='sleeping', started='14:37:14')
network_status_client = (<rclpy.node.Node object at 0x739d31a3f280>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334636, nanosec=825192373), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x739d31a3f280>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334636, nanosec=825192373), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2567503 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2567590 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2567667 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2567822 no longer exists
Process 2567860 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2567980 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:37:24,245 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:37:24,246 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:37:24,246 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:37:24,247 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:37:24,263 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1177
total_tokens       4526
2025-03-30 14:37:24,264 - root.base_generator - INFO - Iteration 17: Attempt 3 failed.
2025-03-30 14:37:24,264 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 17) ---
2025-03-30 14:37:24,264 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:37:24,264 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:37:24,264 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:37:24,264 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:37:24,264 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:37:24,265 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:37:31,410 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:37:31,414 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:37:31,414 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:37:31,414 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1179, total_tokens=4528
2025-03-30 14:37:31,414 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:37:31,414 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:37:31,415 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:37:31,498 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:37:31,498 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:37:31,498 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:37:31,499 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:37:31,499 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:37:31,499 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:37:31,499 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:37:31,499 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:37:31,499 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:37:31,499 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:37:31,499 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:37:31,499 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:37:31,500 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:37:31,500 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:38:56,172 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.78s]
.Child process PID: 2568241, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2568346, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2568416, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-228/test_no_overlapping_scans_netw0/nscan
Child process PID: 2568597, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-228/test_invalid_json_format_netwo0/nscan
Child process PID: 2568730, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x70686a347310>
network_scanner_node = psutil.Process(pid=2568730, name='python3', status='sleeping', started='14:38:49')
network_status_client = (<rclpy.node.Node object at 0x706868badf30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334731, nanosec=781089905), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x706868badf30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334731, nanosec=781089905), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.98s (0:01:17)

stderr:
Process 2568241 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2568346 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2568416 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2568563 no longer exists
Process 2568597 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:38:56,172 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:38:56,173 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:38:56,173 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:38:56,174 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:38:56,191 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1179
total_tokens       4528
2025-03-30 14:38:56,191 - root.base_generator - INFO - Iteration 17: Attempt 4 failed.
2025-03-30 14:38:56,191 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 17) ---
2025-03-30 14:38:56,191 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:38:56,191 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:38:56,191 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:38:56,192 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:38:56,192 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:38:56,192 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:39:03,602 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:39:03,606 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:39:03,606 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:39:03,606 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1167, total_tokens=4516
2025-03-30 14:39:03,606 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:39:03,606 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:39:03,606 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:39:03,964 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:39:03,964 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:39:03,964 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:39:03,964 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:39:03,965 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:39:03,965 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:39:03,965 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:39:03,965 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:39:03,965 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:39:03,965 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:39:03,965 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:39:03,965 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:39:03,965 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:39:03,965 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:40:52,279 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.77s]
.Child process PID: 2569161, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2569210, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2569342, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-229/test_no_overlapping_scans_netw0/nscan
Child process PID: 2569525, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-229/test_invalid_json_format_netwo0/nscan
Child process PID: 2569604, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7d8ac13e4640>
network_scanner_node = psutil.Process(pid=2569604, name='python3', status='sleeping', started='14:40:42')
network_status_client = (<rclpy.node.Node object at 0x7d8ac04d2050>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334844, nanosec=847785617), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7d8ac04d2050>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743334844, nanosec=847785617), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.01s (0:01:21)

stderr:
Process 2569161 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2569210 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2569342 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2569430 no longer exists
Process 2569525 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2569604 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:40:52,280 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:40:52,281 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:40:52,281 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:40:52,281 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:40:52,299 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       116.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1167
total_tokens       4516
2025-03-30 14:40:52,299 - root.base_generator - INFO - Iteration 17: Attempt 5 failed.
2025-03-30 14:40:52,299 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 17) ---
2025-03-30 14:40:52,299 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:40:52,299 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:40:52,299 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:40:52,300 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:40:52,300 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:40:52,300 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:40:59,147 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:40:59,150 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:40:59,151 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:40:59,151 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1122, total_tokens=4471
2025-03-30 14:40:59,151 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:40:59,151 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:40:59,151 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:40:59,230 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:40:59,230 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:40:59,230 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:40:59,230 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:40:59,231 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:40:59,231 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:40:59,231 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:40:59,231 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:40:59,231 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:40:59,231 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:40:59,231 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:40:59,231 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:40:59,231 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:40:59,232 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:42:31,395 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2569904, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2569955, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2570077, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-230/test_no_overlapping_scans_netw0/nscan
Child process PID: 2570267, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-230/test_invalid_json_format_netwo0/nscan
Child process PID: 2570347, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e73a6a3d060>
network_scanner_node = psutil.Process(pid=2570347, name='python3', status='sleeping', started='14:42:17')
network_status_client = (<rclpy.node.Node object at 0x7e73a5ae5f60>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.15s (0:01:25)

stderr:
Process 2569904 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2569955 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2570077 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2570190 no longer exists
Process 2570267 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2570347 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:42:31,395 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:42:31,396 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:42:31,396 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:42:31,396 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:42:31,413 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       99.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1122
total_tokens       4471
2025-03-30 14:42:31,414 - root.base_generator - INFO - Iteration 17: Attempt 6 failed.
2025-03-30 14:42:31,414 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 17) ---
2025-03-30 14:42:31,414 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:42:31,414 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:42:31,414 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:42:31,414 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:42:31,415 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:42:31,415 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:42:38,697 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:42:38,699 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:42:38,699 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:42:38,699 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1179, total_tokens=4528
2025-03-30 14:42:38,699 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:42:38,699 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:42:38,699 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:42:38,747 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:42:38,747 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:42:38,748 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:42:38,748 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:42:38,748 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:42:38,748 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:44:27,011 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2570781, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2570830, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2570958, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-231/test_no_overlapping_scans_netw0/nscan
Child process PID: 2571139, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-231/test_invalid_json_format_netwo0/nscan
Child process PID: 2571218, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x77da5fa40670>
network_scanner_node = psutil.Process(pid=2571218, name='python3', status='sleeping', started='14:44:16')
network_status_client = (<rclpy.node.Node object at 0x77da5e36df30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335059, nanosec=556734700), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x77da5e36df30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335059, nanosec=556734700), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.06s (0:01:21)

stderr:
Process 2570781 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2570830 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2570958 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2571049 no longer exists
Process 2571139 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2571218 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:44:27,012 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:44:27,013 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:44:27,013 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:44:27,013 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:44:27,030 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1179
total_tokens       4528
2025-03-30 14:44:27,030 - root.base_generator - INFO - Iteration 17: Attempt 7 failed.
2025-03-30 14:44:27,031 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 17) ---
2025-03-30 14:44:27,031 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:44:27,031 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:44:27,031 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:44:27,031 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:44:27,031 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:44:27,031 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:44:34,057 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:44:34,061 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:44:34,061 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:44:34,061 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1118, total_tokens=4467
2025-03-30 14:44:34,061 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:44:34,062 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:44:34,062 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:44:34,143 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:44:34,144 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:44:34,144 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:44:34,144 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:44:34,144 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:44:34,144 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:44:34,144 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:44:34,144 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:44:34,144 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:44:34,145 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:44:34,145 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:44:34,145 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:44:34,145 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:44:34,145 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:46:01,996 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.76s]
.Child process PID: 2571517, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2571562, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2571699, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-232/test_no_overlapping_scans_netw0/nscan
Child process PID: 2571881, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-232/test_invalid_json_format_netwo0/nscan
Child process PID: 2571955, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7c453a9e8670>
network_scanner_node = psutil.Process(pid=2571955, name='python3', status='sleeping', started='14:45:51')
network_status_client = (<rclpy.node.Node object at 0x7c4539ab1f30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335154, nanosec=553916026), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7c4539ab1f30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335154, nanosec=553916026), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2571517 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2571562 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2571699 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2571798 no longer exists
Process 2571881 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2571955 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:46:01,996 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:46:01,997 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:46:01,997 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:46:01,997 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:46:02,014 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1118
total_tokens       4467
2025-03-30 14:46:02,014 - root.base_generator - INFO - Iteration 17: Attempt 8 failed.
2025-03-30 14:46:02,014 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 17) ---
2025-03-30 14:46:02,014 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:46:02,014 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:46:02,014 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:46:02,014 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:46:02,014 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:46:02,014 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:46:08,902 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:46:08,906 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:46:08,906 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:46:08,906 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1144, total_tokens=4493
2025-03-30 14:46:08,906 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:46:08,907 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:46:08,907 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:46:08,987 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:46:08,987 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:46:08,987 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:46:08,987 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:46:08,988 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:46:08,988 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:46:08,988 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:46:08,988 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:46:08,988 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:46:08,988 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:46:08,988 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:46:08,988 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:46:08,988 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:46:08,988 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:47:57,396 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2572392, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2572431, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2572545, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-233/test_no_overlapping_scans_netw0/nscan
Child process PID: 2572701, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-233/test_invalid_json_format_netwo0/nscan
Child process PID: 2572821, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x782f99244580>
network_scanner_node = psutil.Process(pid=2572821, name='python3', status='sleeping', started='14:47:47')
network_status_client = (<rclpy.node.Node object at 0x782f982f9c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335269, nanosec=957744893), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x782f982f9c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335269, nanosec=957744893), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.11s (0:01:21)

stderr:
Process 2572392 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2572431 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2572545 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2572641 no longer exists
Process 2572701 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2572821 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:47:57,396 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:47:57,397 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:47:57,398 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:47:57,398 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:47:57,416 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1144
total_tokens       4493
2025-03-30 14:47:57,416 - root.base_generator - INFO - Iteration 17: Attempt 9 failed.
2025-03-30 14:47:57,416 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 17) ---
2025-03-30 14:47:57,416 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:47:57,416 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:47:57,416 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:47:57,416 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:47:57,417 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:47:57,417 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:48:04,733 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:48:04,738 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:48:04,739 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:48:04,739 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1182, total_tokens=4531
2025-03-30 14:48:04,739 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:48:04,739 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:48:04,740 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:48:04,831 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:48:04,831 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:48:04,831 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:48:04,831 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:48:04,831 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:48:04,832 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:48:04,832 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:48:04,832 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:48:04,832 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:48:04,832 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:48:04,832 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:48:04,832 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:48:04,832 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:48:04,832 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:49:32,254 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.74s]
.Child process PID: 2573126, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2573163, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2573295, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-234/test_no_overlapping_scans_netw0/nscan
Child process PID: 2573468, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-234/test_invalid_json_format_netwo0/nscan
Child process PID: 2573556, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x71c056140fd0>
network_scanner_node = psutil.Process(pid=2573556, name='python3', status='sleeping', started='14:49:22')
network_status_client = (<rclpy.node.Node object at 0x71c0561430d0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335364, nanosec=817045818), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x71c0561430d0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335364, nanosec=817045818), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2573126 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2573163 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2573295 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2573380 no longer exists
Process 2573468 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2573556 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 14:49:32,255 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:49:32,256 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:49:32,256 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:49:32,256 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:49:32,274 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1182
total_tokens       4531
2025-03-30 14:49:32,274 - root.base_generator - INFO - Iteration 17: Attempt 10 failed.
2025-03-30 14:49:32,274 - root.base_generator - INFO - --- Starting Attempt 11 (Iteration 17) ---
2025-03-30 14:49:32,274 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:49:32,274 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:49:32,275 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:49:32,275 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:49:32,275 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:49:32,275 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 14:49:39,243 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 14:49:39,246 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 14:49:39,246 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 14:49:39,246 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1130, total_tokens=4479
2025-03-30 14:49:39,247 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 14:49:39,247 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 14:49:39,247 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 14:49:39,323 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 14:49:39,323 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Saving code...
2025-03-30 14:49:39,324 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Running tests...
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 14:49:39,324 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 14:49:39,324 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 14:49:39,325 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 14:49:39,325 - root.ros2_runner - INFO - Running tests...
2025-03-30 14:51:24,533 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.73s]
.Child process PID: 2573992, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2574029, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2574115, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-235/test_no_overlapping_scans_netw0/nscan
Child process PID: 2574287, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-235/test_invalid_json_format_netwo0/nscan
Child process PID: 2574423, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x75a715039000>
network_scanner_node = psutil.Process(pid=2574423, name='python3', status='sleeping', started='14:51:17')
network_status_client = (<rclpy.node.Node object at 0x75a71503b460>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335480, nanosec=174353719), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x75a71503b460>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743335480, nanosec=174353719), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.96s (0:01:17)

stderr:
Process 2573992 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2574029 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2574115 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2574247 no longer exists
Process 2574287 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 14:51:24,533 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 14:51:24,534 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 14:51:24,534 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 14:51:24,534 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 14:51:24,551 - root.base_generator - INFO - Attempt 11 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.3
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1130
total_tokens       4479
2025-03-30 14:51:24,551 - root.base_generator - INFO - Iteration 17: Attempt 11 failed.
2025-03-30 14:51:24,552 - root.base_generator - INFO - --- Starting Attempt 12 (Iteration 17) ---
2025-03-30 14:51:24,552 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 14:51:24,552 - root.generation_attempt - INFO - Initializing...
2025-03-30 14:51:24,552 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 14:51:24,552 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 14:51:24,552 - root.generation_attempt - INFO - Generating code...
2025-03-30 14:51:24,552 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:06:24,760 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 504 Gateway Timeout"
2025-03-30 15:06:24,761 - root.generation_attempt - ERROR - Exception on stage GENERATE:

API error: API error occurred: Status 504
{
  "message":"The upstream server is timing out",
  "request_id":"77618330e2c38a201c28976de525f575"
}

2025-03-30 15:06:24,761 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: FAILURE
2025-03-30 15:06:24,778 - root.base_generator - INFO - Attempt 12 finished with metrics:
metric             value
-----------------  --------
attempt_time       900.2
success            False
final_state        GENERATE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      0
completion_tokens  0
total_tokens       0
2025-03-30 15:06:24,778 - root.base_generator - INFO - Iteration 17: Attempt 12 failed.
2025-03-30 15:06:24,778 - root.base_generator - INFO - --- Starting Attempt 13 (Iteration 17) ---
2025-03-30 15:06:24,778 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:06:24,779 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:06:24,779 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:06:24,779 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:06:24,779 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:06:24,779 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:06:31,973 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:06:31,977 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:06:31,977 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:06:31,977 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1166, total_tokens=4515
2025-03-30 15:06:31,977 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:06:31,977 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:06:31,978 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:06:32,057 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:06:32,058 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:06:32,058 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:06:32,058 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:06:32,058 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:06:32,058 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:06:32,058 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:06:32,058 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:06:32,059 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:06:32,059 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:06:32,059 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:06:32,059 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:06:32,059 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:06:32,059 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:08:20,443 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2579444, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2579477, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2579557, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-236/test_no_overlapping_scans_netw0/nscan
Child process PID: 2579742, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-236/test_invalid_json_format_netwo0/nscan
Child process PID: 2579876, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7532ecd44670>
network_scanner_node = psutil.Process(pid=2579876, name='python3', status='sleeping', started='15:08:10')
network_status_client = (<rclpy.node.Node object at 0x7532eb5a5f30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336493, nanosec=8310875), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7532eb5a5f30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336493, nanosec=8310875), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.07s (0:01:21)

stderr:
Process 2579444 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2579477 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2579557 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2579694 no longer exists
Process 2579742 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2579876 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:08:20,443 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:08:20,444 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:08:20,444 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:08:20,444 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:08:20,457 - root.base_generator - INFO - Attempt 13 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1166
total_tokens       4515
2025-03-30 15:08:20,457 - root.base_generator - INFO - Iteration 17: Attempt 13 failed.
2025-03-30 15:08:20,457 - root.base_generator - INFO - --- Starting Attempt 14 (Iteration 17) ---
2025-03-30 15:08:20,457 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:08:20,457 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:08:20,457 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:08:20,457 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:08:20,458 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:08:20,458 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:08:27,781 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:08:27,785 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:08:27,786 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:08:27,786 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1132, total_tokens=4481
2025-03-30 15:08:27,786 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:08:27,786 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:08:27,786 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:08:27,863 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:08:27,864 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:08:27,864 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:08:27,864 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:08:27,864 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:08:27,864 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:08:27,864 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:08:27,864 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:08:27,864 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:08:27,865 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:08:27,865 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:08:27,865 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:08:27,865 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:08:27,865 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:09:52,295 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2580187, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2580222, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2580339, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-237/test_no_overlapping_scans_netw0/nscan
Child process PID: 2580569, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-237/test_invalid_json_format_netwo0/nscan
Child process PID: 2580683, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7a1c2a541060>
network_scanner_node = psutil.Process(pid=2580683, name='python3', status='sleeping', started='15:09:45')
network_status_client = (<rclpy.node.Node object at 0x7a1c28da9f60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336587, nanosec=939052432), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7a1c28da9f60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336587, nanosec=939052432), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.94s (0:01:17)

stderr:
Process 2580187 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2580222 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2580339 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2580504 no longer exists
Process 2580569 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 15:09:52,295 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:09:52,296 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:09:52,296 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:09:52,296 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:09:52,314 - root.base_generator - INFO - Attempt 14 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1132
total_tokens       4481
2025-03-30 15:09:52,314 - root.base_generator - INFO - Iteration 17: Attempt 14 failed.
2025-03-30 15:09:52,314 - root.base_generator - INFO - --- Starting Attempt 15 (Iteration 17) ---
2025-03-30 15:09:52,315 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:09:52,315 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:09:52,315 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:09:52,315 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:09:52,315 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:09:52,315 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:09:59,425 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:09:59,428 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:09:59,428 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:09:59,428 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1145, total_tokens=4494
2025-03-30 15:09:59,429 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:09:59,429 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:09:59,429 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:09:59,512 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:09:59,512 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:09:59,512 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:09:59,512 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:09:59,513 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:09:59,513 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:09:59,513 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:09:59,513 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:09:59,513 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:09:59,513 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:09:59,513 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:09:59,513 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:09:59,513 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:09:59,513 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:11:47,774 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.75s]
.Child process PID: 2581088, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2581157, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2581221, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-238/test_no_overlapping_scans_netw0/nscan
Child process PID: 2581402, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-238/test_invalid_json_format_netwo0/nscan
Child process PID: 2581551, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ade8509ce80>
network_scanner_node = psutil.Process(pid=2581551, name='python3', status='sleeping', started='15:11:37')
network_status_client = (<rclpy.node.Node object at 0x7ade83b769e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336700, nanosec=327224687), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7ade83b769e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336700, nanosec=327224687), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 80.98s (0:01:20)

stderr:
Process 2581088 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2581157 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2581221 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2581362 no longer exists
Process 2581402 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2581551 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:11:47,774 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:11:47,775 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:11:47,775 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:11:47,775 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:11:47,793 - root.base_generator - INFO - Attempt 15 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1145
total_tokens       4494
2025-03-30 15:11:47,793 - root.base_generator - INFO - Iteration 17: Attempt 15 failed.
2025-03-30 15:11:47,794 - root.base_generator - INFO - --- Starting Attempt 16 (Iteration 17) ---
2025-03-30 15:11:47,794 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:11:47,794 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:11:47,794 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:11:47,794 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:11:47,794 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:11:47,794 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:11:55,265 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:11:55,268 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:11:55,268 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:11:55,268 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1192, total_tokens=4541
2025-03-30 15:11:55,268 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:11:55,269 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:11:55,269 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:11:55,345 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:11:55,345 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:11:55,345 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:11:55,345 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:11:55,345 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:11:55,346 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:11:55,346 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:11:55,346 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:11:55,346 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:11:55,346 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:11:55,346 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:11:55,346 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:11:55,346 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:11:55,346 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:13:22,799 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.76s]
.Child process PID: 2581827, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2581890, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2581970, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-239/test_no_overlapping_scans_netw0/nscan
Child process PID: 2582150, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-239/test_invalid_json_format_netwo0/nscan
Child process PID: 2582286, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b2df6942d10>
network_scanner_node = psutil.Process(pid=2582286, name='python3', status='sleeping', started='15:13:12')
network_status_client = (<rclpy.node.Node object at 0x7b2df51a9c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336795, nanosec=367388464), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7b2df51a9c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743336795, nanosec=367388464), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2581827 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2581890 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2581970 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2582094 no longer exists
Process 2582150 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2582286 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:13:22,800 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:13:22,801 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:13:22,801 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:13:22,801 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:13:22,819 - root.base_generator - INFO - Attempt 16 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1192
total_tokens       4541
2025-03-30 15:13:22,819 - root.base_generator - INFO - Iteration 17: Attempt 16 failed.
2025-03-30 15:13:22,819 - root.base_generator - INFO - --- Starting Attempt 17 (Iteration 17) ---
2025-03-30 15:13:22,819 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:13:22,819 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:13:22,819 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:13:22,820 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:13:22,820 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:13:22,820 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:13:30,056 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:13:30,058 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:13:30,059 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:13:30,059 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1147, total_tokens=4496
2025-03-30 15:13:30,059 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:13:30,059 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:13:30,059 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:13:30,112 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:13:30,112 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:13:30,113 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:13:30,113 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:13:30,113 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:13:30,113 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:13:30,113 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:15:22,483 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.81s]
.Child process PID: 2582665, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2582762, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2582826, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-240/test_no_overlapping_scans_netw0/nscan
Child process PID: 2583008, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-240/test_invalid_json_format_netwo0/nscan
Child process PID: 2583137, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x75174f842d10>
network_scanner_node = psutil.Process(pid=2583137, name='python3', status='sleeping', started='15:15:08')
network_status_client = (<rclpy.node.Node object at 0x75174e16dde0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2582665 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2582762 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2582826 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2582977 no longer exists
Process 2583008 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2583137 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:15:22,484 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:15:22,485 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:15:22,485 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:15:22,485 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:15:22,503 - root.base_generator - INFO - Attempt 17 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1147
total_tokens       4496
2025-03-30 15:15:22,503 - root.base_generator - INFO - Iteration 17: Attempt 17 failed.
2025-03-30 15:15:22,503 - root.base_generator - INFO - --- Starting Attempt 18 (Iteration 17) ---
2025-03-30 15:15:22,503 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:15:22,503 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:15:22,503 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:15:22,503 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:15:22,504 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:15:22,504 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:15:29,686 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:15:29,689 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:15:29,689 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:15:29,689 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1173, total_tokens=4522
2025-03-30 15:15:29,690 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:15:29,690 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:15:29,690 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:15:29,773 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:15:29,773 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:15:29,773 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:15:29,773 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:15:29,774 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:15:29,774 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:15:29,774 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:15:29,774 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:15:29,774 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:15:29,774 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:15:29,774 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:15:29,774 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:15:29,774 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:15:29,774 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:16:53,473 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.80s]
.Child process PID: 2583418, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2583505, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2583569, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-241/test_no_overlapping_scans_netw0/nscan
Child process PID: 2583749, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-241/test_invalid_json_format_netwo0/nscan
Child process PID: 2583895, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7596587e4640>
network_scanner_node = psutil.Process(pid=2583895, name='python3', status='sleeping', started='15:16:43')
network_status_client = (<rclpy.node.Node object at 0x7596587e48e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337006, nanosec=26327404), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7596587e48e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337006, nanosec=26327404), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2583418 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2583505 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2583569 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2583710 no longer exists
Process 2583749 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2583895 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:16:53,474 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:16:53,474 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:16:53,475 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:16:53,475 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:16:53,493 - root.base_generator - INFO - Attempt 18 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1173
total_tokens       4522
2025-03-30 15:16:53,493 - root.base_generator - INFO - Iteration 17: Attempt 18 failed.
2025-03-30 15:16:53,493 - root.base_generator - INFO - --- Starting Attempt 19 (Iteration 17) ---
2025-03-30 15:16:53,494 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:16:53,494 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:16:53,494 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:16:53,494 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:16:53,494 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:16:53,494 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:17:00,499 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:17:00,503 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:17:00,503 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:17:00,503 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1173, total_tokens=4522
2025-03-30 15:17:00,503 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:17:00,503 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:17:00,503 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:17:00,581 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:17:00,582 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:17:00,582 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:17:00,582 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:17:00,582 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:17:00,582 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:17:00,582 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:17:00,582 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:17:00,582 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:17:00,583 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:17:00,583 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:17:00,583 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:17:00,583 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:17:00,583 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:18:48,878 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.77s]
.Child process PID: 2584265, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2584345, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2584432, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-242/test_no_overlapping_scans_netw0/nscan
Child process PID: 2584625, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-242/test_invalid_json_format_netwo0/nscan
Child process PID: 2584725, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ee6845ead10>
network_scanner_node = psutil.Process(pid=2584725, name='python3', status='sleeping', started='15:18:38')
network_status_client = (<rclpy.node.Node object at 0x7ee6845eb100>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337121, nanosec=439571541), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7ee6845eb100>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337121, nanosec=439571541), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.01s (0:01:21)

stderr:
Process 2584265 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2584345 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2584432 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2584561 no longer exists
Process 2584625 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2584725 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:18:48,878 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:18:48,879 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:18:48,879 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:18:48,879 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:18:48,898 - root.base_generator - INFO - Attempt 19 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1173
total_tokens       4522
2025-03-30 15:18:48,898 - root.base_generator - INFO - Iteration 17: Attempt 19 failed.
2025-03-30 15:18:48,898 - root.base_generator - INFO - --- Starting Attempt 20 (Iteration 17) ---
2025-03-30 15:18:48,898 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:18:48,898 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:18:48,898 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:18:48,899 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:18:48,899 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:18:48,899 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:18:56,088 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:18:56,091 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:18:56,091 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:18:56,092 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1128, total_tokens=4477
2025-03-30 15:18:56,092 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:18:56,092 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:18:56,092 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:18:56,172 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:18:56,172 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:18:56,172 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:18:56,172 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:18:56,173 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:18:56,173 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:18:56,173 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:18:56,173 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:18:56,173 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:18:56,173 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:18:56,173 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:18:56,173 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:18:56,173 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:18:56,174 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:20:27,886 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.79s]
.Child process PID: 2584998, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2585085, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2585170, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-243/test_no_overlapping_scans_netw0/nscan
Child process PID: 2585354, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-243/test_invalid_json_format_netwo0/nscan
Child process PID: 2585478, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x71cc816dc640>
network_scanner_node = psutil.Process(pid=2585478, name='python3', status='sleeping', started='15:20:13')
network_status_client = (<rclpy.node.Node object at 0x71cc816dcbb0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2584998 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2585085 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2585170 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2585317 no longer exists
Process 2585354 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2585478 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:20:27,886 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:20:27,887 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:20:27,887 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:20:27,887 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:20:27,906 - root.base_generator - INFO - Attempt 20 finished with metrics:
metric             value
-----------------  -------
attempt_time       99.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1128
total_tokens       4477
2025-03-30 15:20:27,906 - root.base_generator - INFO - Iteration 17: Attempt 20 failed.
2025-03-30 15:20:27,906 - root.base_generator - INFO - --- Starting Attempt 21 (Iteration 17) ---
2025-03-30 15:20:27,906 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:20:27,906 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:20:27,906 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:20:27,906 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:20:27,907 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:20:27,907 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:20:35,127 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:20:35,130 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:20:35,131 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:20:35,131 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1144, total_tokens=4493
2025-03-30 15:20:35,131 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:20:35,131 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:20:35,131 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:20:35,212 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:20:35,213 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:20:35,213 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:20:35,213 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:20:35,213 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:20:35,213 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:20:35,213 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:20:35,214 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:20:35,214 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:20:35,214 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:20:35,214 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:20:35,214 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:20:35,214 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:20:35,214 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:22:27,491 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.72s]
.Child process PID: 2585874, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2585943, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2586044, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-244/test_no_overlapping_scans_netw0/nscan
Child process PID: 2586238, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-244/test_invalid_json_format_netwo0/nscan
Child process PID: 2586324, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7058ed33ed10>
network_scanner_node = psutil.Process(pid=2586324, name='python3', status='sleeping', started='15:22:13')
network_status_client = (<rclpy.node.Node object at 0x7058ed33e1d0>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.03s (0:01:25)

stderr:
Process 2585874 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2585943 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2586044 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2586175 no longer exists
Process 2586238 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2586324 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:22:27,491 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:22:27,492 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:22:27,492 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:22:27,492 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:22:27,510 - root.base_generator - INFO - Attempt 21 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1144
total_tokens       4493
2025-03-30 15:22:27,511 - root.base_generator - INFO - Iteration 17: Attempt 21 failed.
2025-03-30 15:22:27,511 - root.base_generator - INFO - --- Starting Attempt 22 (Iteration 17) ---
2025-03-30 15:22:27,511 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:22:27,511 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:22:27,511 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:22:27,511 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:22:27,511 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:22:27,512 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:22:34,301 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:22:34,305 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:22:34,305 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:22:34,305 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1092, total_tokens=4441
2025-03-30 15:22:34,306 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:22:34,306 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:22:34,306 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:22:34,382 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:22:34,382 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:22:34,383 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:22:34,383 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:22:34,384 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:22:34,384 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:22:34,384 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:23:55,388 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.76s]
.Child process PID: 2586614, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2586705, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2586783, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-245/test_no_overlapping_scans_netw0/nscan
Child process PID: 2586973, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-245/test_invalid_json_format_netwo0/nscan
Child process PID: 2587089, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x79817b0e2d10>
network_scanner_node = psutil.Process(pid=2587089, name='python3', status='sleeping', started='15:23:48')
network_status_client = (<rclpy.node.Node object at 0x7981799a1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337431, nanosec=39946617), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7981799a1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337431, nanosec=39946617), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.95s (0:01:17)

stderr:
Process 2586614 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2586705 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2586783 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2586917 no longer exists
Process 2586973 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 15:23:55,388 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:23:55,389 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:23:55,389 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:23:55,389 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:23:55,408 - root.base_generator - INFO - Attempt 22 finished with metrics:
metric             value
-----------------  -------
attempt_time       87.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1092
total_tokens       4441
2025-03-30 15:23:55,408 - root.base_generator - INFO - Iteration 17: Attempt 22 failed.
2025-03-30 15:23:55,408 - root.base_generator - INFO - --- Starting Attempt 23 (Iteration 17) ---
2025-03-30 15:23:55,409 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:23:55,409 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:23:55,409 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:23:55,409 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:23:55,409 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:23:55,409 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:24:02,393 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:24:02,396 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:24:02,397 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:24:02,397 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1130, total_tokens=4479
2025-03-30 15:24:02,397 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:24:02,397 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:24:02,397 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:24:02,476 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:24:02,477 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:24:02,477 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:24:02,477 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:24:02,477 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:24:02,477 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:24:02,477 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:24:02,477 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:24:02,477 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:24:02,478 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:24:02,478 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:24:02,478 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:24:02,478 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:24:02,478 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:25:47,665 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2587468, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2587517, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2587629, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-246/test_no_overlapping_scans_netw0/nscan
Child process PID: 2587815, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-246/test_invalid_json_format_netwo0/nscan
Child process PID: 2587907, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x75f19c6d8670>
network_scanner_node = psutil.Process(pid=2587907, name='python3', status='sleeping', started='15:25:40')
network_status_client = (<rclpy.node.Node object at 0x75f19afa1e40>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337543, nanosec=315266976), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x75f19afa1e40>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337543, nanosec=315266976), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.93s (0:01:17)

stderr:
Process 2587468 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2587517 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2587629 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2587726 no longer exists
Process 2587815 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 15:25:47,666 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:25:47,667 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:25:47,667 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:25:47,667 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:25:47,686 - root.base_generator - INFO - Attempt 23 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.3
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1130
total_tokens       4479
2025-03-30 15:25:47,686 - root.base_generator - INFO - Iteration 17: Attempt 23 failed.
2025-03-30 15:25:47,686 - root.base_generator - INFO - --- Starting Attempt 24 (Iteration 17) ---
2025-03-30 15:25:47,686 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:25:47,686 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:25:47,687 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:25:47,687 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:25:47,687 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:25:47,687 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:25:55,198 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:25:55,201 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:25:55,202 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:25:55,202 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1189, total_tokens=4538
2025-03-30 15:25:55,202 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:25:55,202 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:25:55,202 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:25:55,282 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:25:55,282 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:25:55,282 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:25:55,282 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:25:55,282 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:25:55,282 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:25:55,283 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:25:55,283 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:25:55,283 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:25:55,283 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:25:55,283 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:25:55,283 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:25:55,283 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:25:55,283 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:27:25,780 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.63s]

Summary: 1 package finished [0.80s]
.Child process PID: 2588200, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2588250, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2588384, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-247/test_no_overlapping_scans_netw0/nscan
Child process PID: 2588553, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-247/test_invalid_json_format_netwo0/nscan
Child process PID: 2588644, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x71030dddad40>
network_scanner_node = psutil.Process(pid=2588644, name='python3', status='sleeping', started='15:27:15')
network_status_client = (<rclpy.node.Node object at 0x71030c571e10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337638, nanosec=340074552), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x71030c571e10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337638, nanosec=340074552), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2588200 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2588250 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2588384 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2588473 no longer exists
Process 2588553 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2588644 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:27:25,780 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:27:25,781 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:27:25,782 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:27:25,782 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:27:25,801 - root.base_generator - INFO - Attempt 24 finished with metrics:
metric             value
-----------------  -------
attempt_time       98.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1189
total_tokens       4538
2025-03-30 15:27:25,801 - root.base_generator - INFO - Iteration 17: Attempt 24 failed.
2025-03-30 15:27:25,801 - root.base_generator - INFO - --- Starting Attempt 25 (Iteration 17) ---
2025-03-30 15:27:25,801 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:27:25,801 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:27:25,801 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:27:25,802 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:27:25,802 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:27:25,802 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:27:32,732 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:27:32,736 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:27:32,736 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:27:32,736 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1102, total_tokens=4451
2025-03-30 15:27:32,736 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:27:32,736 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:27:32,736 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:27:32,817 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:27:32,817 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:27:32,817 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:27:32,817 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:27:32,817 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:27:32,818 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:27:32,818 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:27:32,818 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:27:32,818 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:27:32,818 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:27:32,818 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:27:32,818 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:27:32,818 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:27:32,818 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:29:25,172 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.79s]
.Child process PID: 2589080, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2589114, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2589212, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-248/test_no_overlapping_scans_netw0/nscan
Child process PID: 2589383, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-248/test_invalid_json_format_netwo0/nscan
Child process PID: 2589503, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x78637f7e4640>
network_scanner_node = psutil.Process(pid=2589503, name='python3', status='sleeping', started='15:29:11')
network_status_client = (<rclpy.node.Node object at 0x78637f7e4a90>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2589080 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2589114 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2589212 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2589329 no longer exists
Process 2589383 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2589503 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:29:25,173 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:29:25,174 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:29:25,174 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:29:25,174 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:29:25,192 - root.base_generator - INFO - Attempt 25 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1102
total_tokens       4451
2025-03-30 15:29:25,192 - root.base_generator - INFO - Iteration 17: Attempt 25 failed.
2025-03-30 15:29:25,192 - root.base_generator - INFO - --- Starting Attempt 26 (Iteration 17) ---
2025-03-30 15:29:25,192 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:29:25,193 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:29:25,193 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:29:25,193 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:29:25,193 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:29:25,193 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:29:32,238 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:29:32,241 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:29:32,241 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:29:32,241 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1148, total_tokens=4497
2025-03-30 15:29:32,241 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:29:32,241 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:29:32,241 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:29:32,318 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:29:32,318 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:29:32,318 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:29:32,318 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:29:32,318 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:29:32,318 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:29:32,318 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:29:32,319 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:29:32,319 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:29:32,319 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:29:32,319 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:29:32,319 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:29:32,319 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:29:32,319 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:30:02,796 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2589814, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2589849, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
F
=================================== FAILURES ===================================
__ TestFull.test_network_scanner_parameters[network_scanner_node0-expected0] ___

self = <test_scanner_node.TestFull object at 0x70830ec477f0>
network_scanner_node = psutil.Process(pid=2589849, name='python3', status='sleeping', started='15:29:45')
network_status_client = (<rclpy.node.Node object at 0x70830e19a470>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=...Time(sec=1743337795, nanosec=438845895), addresses=[network_scanner.msg.IPStatus(ip_address='8.8.8.8', status='UP')])])
expected = {'expected_interval': 3, 'expected_ip': ['8.8.8.8']}

    @pytest.mark.order(3)
    @pytest.mark.parametrize(
        "network_scanner_node,expected",
        [
            (
                {"network": "8.8.8.8", "scan_period": 3},
                {"expected_ip": ["8.8.8.8"], "expected_interval": 3},
            ),
            (
                {"network": "1.1.1.1, 8.8.4.4", "scan_period": 6},
                {"expected_ip": ["1.1.1.1", "8.8.4.4"], "expected_interval": 6},
            ),
        ],
        indirect=["network_scanner_node"],
    )
    def test_network_scanner_parameters(
        self, network_scanner_node, network_status_client, expected
    ):
        # Verify the node process is running
        assert network_scanner_node.is_running(), "Network scanner node is not running"

        client_node, received_msgs = network_status_client

        # Wait for at least 2 messages
        assert wait_for_messages(
            client_node, received_msgs, count=2, timeout=20
        ), f"Timeout waiting for messages. Received: {len(received_msgs)}"

        # Validate the content of the first two messages
        for msg in received_msgs[:2]:
            validate_message(msg, expected["expected_ip"])

        # Calculate the interval using ROS timestamps
        first_msg = received_msgs[0]
        second_msg = received_msgs[1]

        interval = (second_msg.stamp.sec - first_msg.stamp.sec) + (
            (second_msg.stamp.nanosec - first_msg.stamp.nanosec) * 1e-9
        )

        # Allow 1 second of tolerance for the interval check
>       assert (
            abs(interval - expected["expected_interval"]) < 1
        ), f"Interval {interval:.2f} sec, expected ~{expected['expected_interval']} sec"
E       AssertionError: Interval 5.99 sec, expected ~3 sec
E       assert 2.985551063 < 1
E        +  where 2.985551063 = abs((5.985551063 - 3))

src/network_scanner/test/test_scanner_node.py:179: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_network_scanner_parameters[network_scanner_node0-expected0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 2 passed in 27.68s

stderr:
Process 2589814 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2589849 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:30:02,797 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:30:02,798 - root.ros2_runner - INFO - Tests failed: 1, passed: 2, skipped: 0
2025-03-30 15:30:02,798 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:30:02,798 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:30:02,816 - root.base_generator - INFO - Attempt 26 finished with metrics:
metric             value
-----------------  -------
attempt_time       37.6
success            False
final_state        TEST
tests_passed       2
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1148
total_tokens       4497
2025-03-30 15:30:02,816 - root.base_generator - INFO - Iteration 17: Attempt 26 failed.
2025-03-30 15:30:02,816 - root.base_generator - INFO - --- Starting Attempt 27 (Iteration 17) ---
2025-03-30 15:30:02,816 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:30:02,816 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:30:02,817 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:30:02,817 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:30:02,817 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:30:02,817 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:30:06,073 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:30:06,076 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:30:06,076 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:30:06,076 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=498, total_tokens=3847
2025-03-30 15:30:06,077 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:30:06,077 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:30:06,077 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:30:06,077 - root.code_parser - WARNING - No valid '```python' code markers found in response
2025-03-30 15:30:06,077 - root.generation_attempt - ERROR - Exception on stage PARSE:

Parsing failed, no code returned.

2025-03-30 15:30:06,077 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: FAILURE
2025-03-30 15:30:06,096 - root.base_generator - INFO - Attempt 27 finished with metrics:
metric             value
-----------------  -------
attempt_time       3.3
success            False
final_state        PARSE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  498
total_tokens       3847
2025-03-30 15:30:06,097 - root.base_generator - INFO - Iteration 17: Attempt 27 failed.
2025-03-30 15:30:06,097 - root.base_generator - INFO - --- Starting Attempt 28 (Iteration 17) ---
2025-03-30 15:30:06,097 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:30:06,097 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:30:06,097 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:30:06,097 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:30:06,097 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:30:06,098 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:30:13,595 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:30:13,598 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:30:13,599 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:30:13,599 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1209, total_tokens=4558
2025-03-30 15:30:13,599 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:30:13,599 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:30:13,599 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:30:13,682 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:30:13,682 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:30:13,682 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:30:13,682 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:30:13,682 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:30:13,683 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:30:13,683 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:30:13,683 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:30:13,683 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:30:13,683 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:30:13,683 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:30:13,683 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:30:13,683 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:30:13,683 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:32:01,963 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.76s]
.Child process PID: 2590315, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2590364, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2590494, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-250/test_no_overlapping_scans_netw0/nscan
Child process PID: 2590658, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-250/test_invalid_json_format_netwo0/nscan
Child process PID: 2590758, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7f2e8533c640>
network_scanner_node = psutil.Process(pid=2590758, name='python3', status='sleeping', started='15:31:51')
network_status_client = (<rclpy.node.Node object at 0x7f2e8533cb80>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337914, nanosec=520969959), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7f2e8533cb80>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743337914, nanosec=520969959), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 80.99s (0:01:20)

stderr:
Process 2590315 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2590364 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2590494 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2590584 no longer exists
Process 2590658 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2590758 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:32:01,964 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:32:01,965 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:32:01,965 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:32:01,965 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:32:01,984 - root.base_generator - INFO - Attempt 28 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1209
total_tokens       4558
2025-03-30 15:32:01,984 - root.base_generator - INFO - Iteration 17: Attempt 28 failed.
2025-03-30 15:32:01,984 - root.base_generator - INFO - --- Starting Attempt 29 (Iteration 17) ---
2025-03-30 15:32:01,984 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:32:01,984 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:32:01,985 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:32:01,985 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:32:01,985 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:32:01,985 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:32:05,148 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:32:05,151 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:32:05,151 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:32:05,151 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=497, total_tokens=3846
2025-03-30 15:32:05,151 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:32:05,151 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:32:05,152 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:32:05,152 - root.code_parser - WARNING - No valid '```python' code markers found in response
2025-03-30 15:32:05,152 - root.generation_attempt - ERROR - Exception on stage PARSE:

Parsing failed, no code returned.

2025-03-30 15:32:05,152 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: FAILURE
2025-03-30 15:32:05,171 - root.base_generator - INFO - Attempt 29 finished with metrics:
metric             value
-----------------  -------
attempt_time       3.2
success            False
final_state        PARSE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  497
total_tokens       3846
2025-03-30 15:32:05,171 - root.base_generator - INFO - Iteration 17: Attempt 29 failed.
2025-03-30 15:32:05,171 - root.base_generator - INFO - --- Starting Attempt 30 (Iteration 17) ---
2025-03-30 15:32:05,171 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:32:05,172 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:32:05,172 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:32:05,172 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:32:05,172 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:32:05,172 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:32:11,585 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:32:11,589 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:32:11,589 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:32:11,589 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1071, total_tokens=4420
2025-03-30 15:32:11,590 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:32:11,590 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:32:11,590 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:32:12,018 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:32:12,018 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:32:12,018 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:32:12,019 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:32:12,019 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:32:12,019 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:32:12,019 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:32:12,019 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:32:12,019 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:32:12,019 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:32:12,019 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:32:12,019 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:32:12,019 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:32:12,019 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:33:49,384 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.75s]
.Child process PID: 2591051, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2591101, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2591234, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-251/test_no_overlapping_scans_netw0/nscan
Child process PID: 2591423, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-251/test_invalid_json_format_netwo0/nscan
Child process PID: 2591496, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-251/test_outdated_json_results_net0/nscan
Child process PID: 2591586, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.46s (0:01:33)

stderr:
Process 2591051 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2591101 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2591234 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2591323 no longer exists
Process 2591423 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2591586 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:33:49,384 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:33:49,385 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 15:33:49,385 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 15:33:49,385 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 15:33:49,404 - root.base_generator - INFO - Attempt 30 finished with metrics:
metric             value
-----------------  -------
attempt_time       104.2
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1071
total_tokens       4420
2025-03-30 15:33:49,405 - root.base_generator - INFO - Iteration 17: Successful attempt achieved.
2025-03-30 15:33:49,405 - root.base_generator - INFO - Iteration 17 finished.
2025-03-30 15:33:49,405 - root.base_generator - INFO -  Iteration 18 started.
2025-03-30 15:33:49,405 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 18) ---
2025-03-30 15:33:49,405 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:33:49,405 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:33:49,405 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:33:49,406 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:33:49,406 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:33:49,406 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:33:56,493 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:33:56,497 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:33:56,497 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:33:56,497 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1113, total_tokens=4462
2025-03-30 15:33:56,497 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:33:56,498 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:33:56,498 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:33:56,575 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:33:56,575 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:33:56,575 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:33:56,575 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:33:56,576 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:33:56,576 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:33:56,576 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:33:56,576 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:33:56,576 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:33:56,576 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:33:56,576 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:33:56,576 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:33:56,576 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:33:56,576 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:34:27,302 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.E
==================================== ERRORS ====================================
_________________ ERROR at setup of TestFull.test_node_running _________________

request = <SubRequest 'network_scanner_node' for <Function test_node_running>>
tmp_path = PosixPath('/tmp/pytest-of-aleev/pytest-252/test_node_running0')
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7dab80138e50>

    @pytest.fixture(scope="function")
    def network_scanner_node(request, tmp_path, monkeypatch):
        """Fixture that sets up a network scanner node with the provided parameters."""
        if not rclpy.ok():
            rclpy.init()

        # Default parameters
        network = "4.2.2.2"
        scan_period = 3
        mock_nscan = False
        mock_nscan_text = """#!/bin/bash
        echo "NSCAN"
        """
        if hasattr(request, "param"):
            params = request.param
            network = params.get("network", network)
            scan_period = params.get("scan_period", scan_period)
            mock_nscan = params.get("mock_nscan", mock_nscan)
            mock_nscan_text = params.get("mock_nscan_text", mock_nscan_text)

        if mock_nscan:
            print("Using mock nscan binary")
            nscan_path = os.path.join(tmp_path, "nscan")
            with open(nscan_path, "w") as f:
                f.write(mock_nscan_text)
            os.chmod(nscan_path, 0o755)

            monkeypatch.setenv("PATH", f"{tmp_path}:{os.environ.get('PATH')}")
            print(f"nscan path: {nscan_path}")

        runner = ros2_runner.ROS2Runner(
            node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={network!r} -p scan_period:={scan_period}",
            test_command="",
        )
>       runner.start_node()

src/network_scanner/test/test_scanner_node.py:46:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <codestral_ros2_gen.utils.ros2_runner.ROS2Runner object at 0x7dab80138cd0>

    def start_node(self) -> None:
        """
        Start the ROS2 node and verify it launched successfully.

        If "skip / SKIP" is found in the node_command, the node is not started.

        Raises:
            RuntimeError: If the node fails to start or register with ROS2.
        """
        logger.info("Starting the ROS2 node...")
        if "skip" in self.node_command.lower():
            logger.info("Skipping node start as requested.")
            return
        else:
            self.node_process = subprocess.Popen(
                self.node_command,
                shell=True,
                executable="/bin/bash",
                stderr=subprocess.PIPE,
                stdout=subprocess.PIPE,
                text=True,
            )

            # Wait briefly for node to initialize
            time.sleep(2)

            # Check if process is still running
            if self.node_process.poll() is not None:
                # Process terminated - get error output
                stdout, stderr = self.node_process.communicate()
                error_msg = f"Node process terminated immediately.\nStdout: {stdout}\nStderr: {stderr}"
>               raise RuntimeError(error_msg)
E               RuntimeError: Node process terminated immediately.
E               Stdout: [ros2run]: Process exited with failure 1
E
E               Stderr: Traceback (most recent call last):
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 121, in <module>
E                   main()
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 114, in main
E                   node = NetworkScannerNode()
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 41, in __init__
E                   qos_profile = QoSProfile(
E                 File "/opt/ros/humble/local/lib/python3.10/dist-packages/rclpy/qos.py", line 82, in __init__
E                   raise InvalidQoSProfileException('History and/or depth settings are required.')
E               rclpy.qos.InvalidQoSProfileException: ('Invalid QoSProfile', 'History and/or depth settings are required.')

../codestral_ros2_gen/src/codestral_ros2_gen/utils/ros2_runner.py:79: RuntimeError
=========================== short test summary info ============================
ERROR src/network_scanner/test/test_scanner_node.py::TestFull::test_node_running
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 passed, 1 error in 3.59s

stderr:

2025-03-30 15:34:27,303 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:34:27,304 - root.ros2_runner - INFO - Tests failed: 0, passed: 1, skipped: 0
2025-03-30 15:34:27,304 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:34:27,304 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:34:27,322 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       37.9
success            False
final_state        TEST
tests_passed       1
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1113
total_tokens       4462
2025-03-30 15:34:27,322 - root.base_generator - INFO - Iteration 18: Attempt 1 failed.
2025-03-30 15:34:27,322 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 18) ---
2025-03-30 15:34:27,323 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:34:27,323 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:34:27,323 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:34:27,323 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:34:27,323 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:34:27,323 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:34:34,228 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:34:34,232 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:34:34,232 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:34:34,232 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1126, total_tokens=4475
2025-03-30 15:34:34,232 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:34:34,233 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:34:34,233 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:34:34,312 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:34:34,312 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:34:34,312 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:34:34,312 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:34:34,312 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:34:34,313 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:34:34,313 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:34:34,313 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:34:34,313 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:34:34,313 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:34:34,313 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:34:34,313 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:34:34,313 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:34:34,313 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:36:22,610 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2592328, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2592431, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2592493, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-253/test_no_overlapping_scans_netw0/nscan
Child process PID: 2592678, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-253/test_invalid_json_format_netwo0/nscan
Child process PID: 2592818, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7717d68c71f0>
network_scanner_node = psutil.Process(pid=2592818, name='python3', status='sleeping', started='15:36:12')
network_status_client = (<rclpy.node.Node object at 0x7717d514d960>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338175, nanosec=181312736), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7717d514d960>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338175, nanosec=181312736), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2592328 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2592431 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2592493 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2592640 no longer exists
Process 2592678 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2592818 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:36:22,610 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:36:22,611 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:36:22,611 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:36:22,611 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:36:22,624 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.3
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1126
total_tokens       4475
2025-03-30 15:36:22,625 - root.base_generator - INFO - Iteration 18: Attempt 2 failed.
2025-03-30 15:36:22,625 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 18) ---
2025-03-30 15:36:22,625 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:36:22,625 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:36:22,625 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:36:22,625 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:36:22,625 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:36:22,626 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:36:29,888 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:36:29,892 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:36:29,892 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:36:29,892 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1129, total_tokens=4478
2025-03-30 15:36:29,892 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:36:29,892 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:36:29,892 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:36:29,972 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:36:29,972 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:36:29,972 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:36:29,972 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:36:29,973 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:36:29,973 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:36:29,973 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:36:29,973 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:36:29,973 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:36:29,973 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:36:29,973 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:36:29,973 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:36:29,973 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:36:29,973 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:38:32,739 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.73s]
.Child process PID: 2593187, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2593256, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2593356, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-254/test_no_overlapping_scans_netw0/nscan
Child process PID: 2593554, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-254/test_invalid_json_format_netwo0/nscan
Child process PID: 2593651, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-254/test_outdated_json_results_net0/nscan
Child process PID: 2593741, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.49s (0:01:35)

stderr:
Process 2593187 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2593256 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2593356 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2593486 no longer exists
Process 2593554 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2593741 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:38:32,740 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:38:32,740 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 15:38:32,740 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 15:38:32,741 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 15:38:32,760 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.1
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1129
total_tokens       4478
2025-03-30 15:38:32,760 - root.base_generator - INFO - Iteration 18: Successful attempt achieved.
2025-03-30 15:38:32,760 - root.base_generator - INFO - Iteration 18 finished.
2025-03-30 15:38:32,760 - root.base_generator - INFO -  Iteration 19 started.
2025-03-30 15:38:32,760 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 19) ---
2025-03-30 15:38:32,761 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:38:32,761 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:38:32,761 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:38:32,761 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:38:32,761 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:38:32,761 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:38:39,949 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:38:39,953 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:38:39,953 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:38:39,953 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1161, total_tokens=4510
2025-03-30 15:38:39,953 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:38:39,953 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:38:39,954 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:38:40,038 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:38:40,039 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:38:40,039 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:38:40,040 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:38:40,040 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:38:40,040 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:40:42,805 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2594200, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2594303, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2594365, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-255/test_no_overlapping_scans_netw0/nscan
Child process PID: 2594550, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-255/test_invalid_json_format_netwo0/nscan
Child process PID: 2594691, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-255/test_outdated_json_results_net0/nscan
Child process PID: 2594730, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.50s (0:01:35)

stderr:
Process 2594200 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2594303 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2594365 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2594512 no longer exists
Process 2594550 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2594730 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:40:42,806 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:40:42,806 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 15:40:42,807 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 15:40:42,807 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 15:40:42,826 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.0
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1161
total_tokens       4510
2025-03-30 15:40:42,826 - root.base_generator - INFO - Iteration 19: Successful attempt achieved.
2025-03-30 15:40:42,827 - root.base_generator - INFO - Iteration 19 finished.
2025-03-30 15:40:42,827 - root.base_generator - INFO -  Iteration 20 started.
2025-03-30 15:40:42,827 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 20) ---
2025-03-30 15:40:42,827 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:40:42,827 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:40:42,827 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:40:42,827 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:40:42,828 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:40:42,828 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:40:50,354 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:40:50,357 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:40:50,358 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:40:50,358 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1097, total_tokens=4446
2025-03-30 15:40:50,358 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:40:50,358 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:40:50,358 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:40:50,436 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:40:50,436 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:40:50,436 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:40:50,436 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:40:50,436 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:40:50,436 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:40:50,436 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:40:50,437 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:40:50,437 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:40:50,437 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:40:50,437 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:40:50,437 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:40:50,437 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:40:50,437 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:42:53,174 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.77s]
.Child process PID: 2595180, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2595227, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2595309, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-256/test_no_overlapping_scans_netw0/nscan
Child process PID: 2595487, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-256/test_invalid_json_format_netwo0/nscan
Child process PID: 2595623, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-256/test_outdated_json_results_net0/nscan
Child process PID: 2595676, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.45s (0:01:35)

stderr:
Process 2595180 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2595227 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2595309 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2595444 no longer exists
Process 2595487 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2595676 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:42:53,174 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:42:53,175 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 15:42:53,175 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 15:42:53,175 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 15:42:53,194 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.3
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1097
total_tokens       4446
2025-03-30 15:42:53,194 - root.base_generator - INFO - Iteration 20: Successful attempt achieved.
2025-03-30 15:42:53,195 - root.base_generator - INFO - Iteration 20 finished.
2025-03-30 15:42:53,195 - root.base_generator - INFO -  Iteration 21 started.
2025-03-30 15:42:53,195 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 21) ---
2025-03-30 15:42:53,195 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:42:53,195 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:42:53,195 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:42:53,195 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:42:53,196 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:42:53,196 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:43:00,556 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:43:00,559 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:43:00,560 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:43:00,560 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1174, total_tokens=4523
2025-03-30 15:43:00,560 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:43:00,560 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:43:00,560 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:43:00,641 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:43:00,642 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:43:00,642 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:43:00,642 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:43:00,642 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:43:00,642 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:43:00,642 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:43:00,642 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:43:00,643 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:43:00,643 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:43:00,643 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:43:00,643 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:43:00,643 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:43:00,643 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:44:52,965 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.72s]
.Child process PID: 2596127, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2596176, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2596284, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-257/test_no_overlapping_scans_netw0/nscan
Child process PID: 2596469, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-257/test_invalid_json_format_netwo0/nscan
Child process PID: 2596563, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x712264644670>
network_scanner_node = psutil.Process(pid=2596563, name='python3', status='sleeping', started='15:44:38')
network_status_client = (<rclpy.node.Node object at 0x712262f59960>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.06s (0:01:25)

stderr:
Process 2596127 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2596176 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2596284 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2596381 no longer exists
Process 2596469 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2596563 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:44:52,965 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:44:52,966 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:44:52,966 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:44:52,966 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:44:52,986 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1174
total_tokens       4523
2025-03-30 15:44:52,986 - root.base_generator - INFO - Iteration 21: Attempt 1 failed.
2025-03-30 15:44:52,986 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 21) ---
2025-03-30 15:44:52,986 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:44:52,986 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:44:52,986 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:44:52,987 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:44:52,987 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:44:52,987 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:45:00,301 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:45:00,305 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:45:00,305 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:45:00,305 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1135, total_tokens=4484
2025-03-30 15:45:00,305 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:45:00,305 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:45:00,305 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:45:00,382 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:45:00,383 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:45:00,383 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:45:00,384 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:45:00,384 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:45:00,384 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:45:00,384 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:46:23,924 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.71s]
.Child process PID: 2596859, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2596908, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2597041, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-258/test_no_overlapping_scans_netw0/nscan
Child process PID: 2597209, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-258/test_invalid_json_format_netwo0/nscan
Child process PID: 2597301, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e8df86dad10>
network_scanner_node = psutil.Process(pid=2597301, name='python3', status='sleeping', started='15:46:13')
network_status_client = (<rclpy.node.Node object at 0x7e8df86da230>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338776, nanosec=480857084), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7e8df86da230>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338776, nanosec=480857084), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.06s (0:01:21)

stderr:
Process 2596859 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2596908 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2597041 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2597130 no longer exists
Process 2597209 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2597301 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:46:23,924 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:46:23,925 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:46:23,925 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:46:23,926 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:46:23,945 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       90.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1135
total_tokens       4484
2025-03-30 15:46:23,945 - root.base_generator - INFO - Iteration 21: Attempt 2 failed.
2025-03-30 15:46:23,945 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 21) ---
2025-03-30 15:46:23,945 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:46:23,945 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:46:23,945 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:46:23,946 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:46:23,946 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:46:23,946 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:46:31,027 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:46:31,031 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:46:31,031 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:46:31,031 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1146, total_tokens=4495
2025-03-30 15:46:31,032 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:46:31,032 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:46:31,032 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:46:31,113 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:46:31,113 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:46:31,113 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:46:31,113 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:46:31,113 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:46:31,113 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:46:31,114 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:46:31,114 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:46:31,114 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:46:31,114 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:46:31,114 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:46:31,114 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:46:31,114 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:46:31,114 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:48:19,390 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.74s]
.Child process PID: 2597740, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2597771, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2597877, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-259/test_no_overlapping_scans_netw0/nscan
Child process PID: 2598041, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-259/test_invalid_json_format_netwo0/nscan
Child process PID: 2598165, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7219c2a3ed10>
network_scanner_node = psutil.Process(pid=2598165, name='python3', status='sleeping', started='15:48:09')
network_status_client = (<rclpy.node.Node object at 0x7219c1369780>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338891, nanosec=959493174), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7219c1369780>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338891, nanosec=959493174), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2597740 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2597771 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2597877 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2597983 no longer exists
Process 2598041 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2598165 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:48:19,391 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:48:19,392 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:48:19,392 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:48:19,392 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:48:19,411 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1146
total_tokens       4495
2025-03-30 15:48:19,412 - root.base_generator - INFO - Iteration 21: Attempt 3 failed.
2025-03-30 15:48:19,412 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 21) ---
2025-03-30 15:48:19,412 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:48:19,412 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:48:19,412 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:48:19,412 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:48:19,412 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:48:19,413 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:48:26,596 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:48:26,600 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:48:26,600 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:48:26,601 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1214, total_tokens=4563
2025-03-30 15:48:26,601 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:48:26,601 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:48:26,601 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:48:26,686 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:48:26,686 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:48:26,686 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:48:26,686 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:48:26,687 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:48:26,687 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:48:26,687 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:48:26,687 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:48:26,687 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:48:26,687 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:48:26,687 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:48:26,687 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:48:26,687 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:48:26,687 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:49:51,359 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.63s]

Summary: 1 package finished [0.81s]
.Child process PID: 2598472, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2598510, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2598624, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-260/test_no_overlapping_scans_netw0/nscan
Child process PID: 2598808, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-260/test_invalid_json_format_netwo0/nscan
Child process PID: 2598903, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e29e5d42d10>
network_scanner_node = psutil.Process(pid=2598903, name='python3', status='sleeping', started='15:49:44')
network_status_client = (<rclpy.node.Node object at 0x7e29e5d40970>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338986, nanosec=962166593), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7e29e5d40970>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743338986, nanosec=962166593), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 78.01s (0:01:18)

stderr:
Process 2598472 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2598510 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2598624 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2598727 no longer exists
Process 2598808 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 15:49:51,359 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:49:51,360 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:49:51,360 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:49:51,360 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:49:51,381 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1214
total_tokens       4563
2025-03-30 15:49:51,381 - root.base_generator - INFO - Iteration 21: Attempt 4 failed.
2025-03-30 15:49:51,381 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 21) ---
2025-03-30 15:49:51,381 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:49:51,382 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:49:51,382 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:49:51,382 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:49:51,382 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:49:51,382 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:49:58,950 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:49:58,954 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:49:58,954 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:49:58,954 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1223, total_tokens=4572
2025-03-30 15:49:58,954 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:49:58,954 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:49:58,955 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:49:59,038 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:49:59,039 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:49:59,039 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:49:59,040 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:49:59,040 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:49:59,040 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:49:59,040 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:51:47,272 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.71s]
.Child process PID: 2599308, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2599372, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2599439, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-261/test_no_overlapping_scans_netw0/nscan
Child process PID: 2599631, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-261/test_invalid_json_format_netwo0/nscan
Child process PID: 2599769, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x721499c3ed10>
network_scanner_node = psutil.Process(pid=2599769, name='python3', status='sleeping', started='15:51:37')
network_status_client = (<rclpy.node.Node object at 0x721498569780>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339099, nanosec=840212840), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x721498569780>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339099, nanosec=840212840), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2599308 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2599372 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2599439 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2599579 no longer exists
Process 2599631 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2599769 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:51:47,272 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:51:47,273 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:51:47,273 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:51:47,273 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:51:47,292 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1223
total_tokens       4572
2025-03-30 15:51:47,292 - root.base_generator - INFO - Iteration 21: Attempt 5 failed.
2025-03-30 15:51:47,292 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 21) ---
2025-03-30 15:51:47,292 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:51:47,293 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:51:47,293 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:51:47,293 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:51:47,293 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:51:47,293 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:51:54,502 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:51:54,505 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:51:54,506 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:51:54,506 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1159, total_tokens=4508
2025-03-30 15:51:54,506 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:51:54,506 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:51:54,506 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:51:54,588 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:51:54,588 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:51:54,588 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:51:54,588 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:51:54,589 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:51:54,589 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:51:54,589 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:51:54,589 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:51:54,589 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:51:54,589 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:51:54,589 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:51:54,589 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:51:54,589 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:51:54,589 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:53:19,153 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.74s]
.Child process PID: 2600050, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2600106, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2600185, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-262/test_no_overlapping_scans_netw0/nscan
Child process PID: 2600368, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-262/test_invalid_json_format_netwo0/nscan
Child process PID: 2600505, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b9967041060>
network_scanner_node = psutil.Process(pid=2600505, name='python3', status='sleeping', started='15:53:12')
network_status_client = (<rclpy.node.Node object at 0x7b99660e6080>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339194, nanosec=802222542), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7b99660e6080>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339194, nanosec=802222542), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.92s (0:01:17)

stderr:
Process 2600050 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2600106 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2600185 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2600316 no longer exists
Process 2600368 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 15:53:19,154 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:53:19,155 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:53:19,155 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:53:19,155 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:53:19,174 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1159
total_tokens       4508
2025-03-30 15:53:19,174 - root.base_generator - INFO - Iteration 21: Attempt 6 failed.
2025-03-30 15:53:19,175 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 21) ---
2025-03-30 15:53:19,175 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:53:19,175 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:53:19,175 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:53:19,175 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:53:19,175 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:53:19,175 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:53:26,599 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:53:26,602 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:53:26,602 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:53:26,602 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1183, total_tokens=4532
2025-03-30 15:53:26,603 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:53:26,603 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:53:26,603 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:53:26,682 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:53:26,682 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:53:26,682 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:53:26,682 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:53:26,683 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:53:26,683 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:53:26,683 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:53:26,683 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:53:26,683 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:53:26,683 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:53:26,683 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:53:26,683 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:53:26,683 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:53:26,683 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:53:57,440 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.80s]
.E
==================================== ERRORS ====================================
_________________ ERROR at setup of TestFull.test_node_running _________________

request = <SubRequest 'network_scanner_node' for <Function test_node_running>>
tmp_path = PosixPath('/tmp/pytest-of-aleev/pytest-263/test_node_running0')
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x772cecb9c820>

    @pytest.fixture(scope="function")
    def network_scanner_node(request, tmp_path, monkeypatch):
        """Fixture that sets up a network scanner node with the provided parameters."""
        if not rclpy.ok():
            rclpy.init()

        # Default parameters
        network = "4.2.2.2"
        scan_period = 3
        mock_nscan = False
        mock_nscan_text = """#!/bin/bash
        echo "NSCAN"
        """
        if hasattr(request, "param"):
            params = request.param
            network = params.get("network", network)
            scan_period = params.get("scan_period", scan_period)
            mock_nscan = params.get("mock_nscan", mock_nscan)
            mock_nscan_text = params.get("mock_nscan_text", mock_nscan_text)

        if mock_nscan:
            print("Using mock nscan binary")
            nscan_path = os.path.join(tmp_path, "nscan")
            with open(nscan_path, "w") as f:
                f.write(mock_nscan_text)
            os.chmod(nscan_path, 0o755)

            monkeypatch.setenv("PATH", f"{tmp_path}:{os.environ.get('PATH')}")
            print(f"nscan path: {nscan_path}")

        runner = ros2_runner.ROS2Runner(
            node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={network!r} -p scan_period:={scan_period}",
            test_command="",
        )
>       runner.start_node()

src/network_scanner/test/test_scanner_node.py:46:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <codestral_ros2_gen.utils.ros2_runner.ROS2Runner object at 0x772cecb9f8e0>

    def start_node(self) -> None:
        """
        Start the ROS2 node and verify it launched successfully.

        If "skip / SKIP" is found in the node_command, the node is not started.

        Raises:
            RuntimeError: If the node fails to start or register with ROS2.
        """
        logger.info("Starting the ROS2 node...")
        if "skip" in self.node_command.lower():
            logger.info("Skipping node start as requested.")
            return
        else:
            self.node_process = subprocess.Popen(
                self.node_command,
                shell=True,
                executable="/bin/bash",
                stderr=subprocess.PIPE,
                stdout=subprocess.PIPE,
                text=True,
            )

            # Wait briefly for node to initialize
            time.sleep(2)

            # Check if process is still running
            if self.node_process.poll() is not None:
                # Process terminated - get error output
                stdout, stderr = self.node_process.communicate()
                error_msg = f"Node process terminated immediately.\nStdout: {stdout}\nStderr: {stderr}"
>               raise RuntimeError(error_msg)
E               RuntimeError: Node process terminated immediately.
E               Stdout: [ros2run]: Process exited with failure 1
E
E               Stderr: Traceback (most recent call last):
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 9, in <module>
E                   from rclpy.exceptions import ParameterNotDeclaredException, ParameterValueException
E               ImportError: cannot import name 'ParameterValueException' from 'rclpy.exceptions' (/opt/ros/humble/local/lib/python3.10/dist-packages/rclpy/exceptions.py)

../codestral_ros2_gen/src/codestral_ros2_gen/utils/ros2_runner.py:79: RuntimeError
=========================== short test summary info ============================
ERROR src/network_scanner/test/test_scanner_node.py::TestFull::test_node_running
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 passed, 1 error in 3.58s

stderr:

2025-03-30 15:53:57,440 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:53:57,440 - root.ros2_runner - INFO - Tests failed: 0, passed: 1, skipped: 0
2025-03-30 15:53:57,440 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:53:57,441 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:53:57,450 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       38.3
success            False
final_state        TEST
tests_passed       1
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1183
total_tokens       4532
2025-03-30 15:53:57,450 - root.base_generator - INFO - Iteration 21: Attempt 7 failed.
2025-03-30 15:53:57,450 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 21) ---
2025-03-30 15:53:57,450 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:53:57,450 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:53:57,450 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:53:57,450 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:53:57,451 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:53:57,451 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:54:04,605 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:54:04,607 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:54:04,607 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:54:04,607 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1204, total_tokens=4553
2025-03-30 15:54:04,608 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:54:04,608 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:54:04,608 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:54:04,659 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:54:04,659 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:54:04,659 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:54:04,659 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:54:04,660 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:54:04,660 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:54:04,660 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:54:04,660 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:54:04,660 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:54:04,660 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:54:04,660 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:54:04,660 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:54:04,660 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:54:04,660 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:55:52,972 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2601233, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2601294, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2601372, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-264/test_no_overlapping_scans_netw0/nscan
Child process PID: 2601555, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-264/test_invalid_json_format_netwo0/nscan
Child process PID: 2601691, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b1830b3d030>
network_scanner_node = psutil.Process(pid=2601691, name='python3', status='sleeping', started='15:55:42')
network_status_client = (<rclpy.node.Node object at 0x7b1830b3f520>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339345, nanosec=528038809), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7b1830b3f520>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339345, nanosec=528038809), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2601233 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2601294 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2601372 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2601507 no longer exists
Process 2601555 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2601691 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:55:52,972 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:55:52,973 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:55:52,973 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:55:52,974 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:55:52,994 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1204
total_tokens       4553
2025-03-30 15:55:52,994 - root.base_generator - INFO - Iteration 21: Attempt 8 failed.
2025-03-30 15:55:52,994 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 21) ---
2025-03-30 15:55:52,994 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:55:52,995 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:55:52,995 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:55:52,995 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:55:52,995 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:55:52,995 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:56:00,281 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:56:00,284 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:56:00,285 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:56:00,285 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1174, total_tokens=4523
2025-03-30 15:56:00,285 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:56:00,285 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:56:00,285 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:56:00,366 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:56:00,366 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:56:00,366 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:56:00,366 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:56:00,366 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:56:00,366 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:56:00,366 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:56:00,366 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:56:00,367 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:56:00,367 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:56:00,367 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:56:00,367 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:56:00,367 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:56:00,367 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:57:52,708 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.76s]
.Child process PID: 2602080, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2602171, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2602241, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-265/test_no_overlapping_scans_netw0/nscan
Child process PID: 2602421, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-265/test_invalid_json_format_netwo0/nscan
Child process PID: 2602565, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x71b707842d10>
network_scanner_node = psutil.Process(pid=2602565, name='python3', status='sleeping', started='15:57:38')
network_status_client = (<rclpy.node.Node object at 0x71b707840d30>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2602080 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2602171 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2602241 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2602383 no longer exists
Process 2602421 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2602565 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:57:52,708 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:57:52,709 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:57:52,709 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:57:52,709 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:57:52,728 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1174
total_tokens       4523
2025-03-30 15:57:52,728 - root.base_generator - INFO - Iteration 21: Attempt 9 failed.
2025-03-30 15:57:52,729 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 21) ---
2025-03-30 15:57:52,729 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:57:52,729 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:57:52,729 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:57:52,729 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:57:52,729 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:57:52,729 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:57:56,062 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:57:56,065 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:57:56,066 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:57:56,066 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=498, total_tokens=3847
2025-03-30 15:57:56,066 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:57:56,066 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:57:56,066 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:57:56,066 - root.code_parser - WARNING - No valid '```python' code markers found in response
2025-03-30 15:57:56,067 - root.generation_attempt - ERROR - Exception on stage PARSE:

Parsing failed, no code returned.

2025-03-30 15:57:56,067 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: FAILURE
2025-03-30 15:57:56,086 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       3.3
success            False
final_state        PARSE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  498
total_tokens       3847
2025-03-30 15:57:56,087 - root.base_generator - INFO - Iteration 21: Attempt 10 failed.
2025-03-30 15:57:56,087 - root.base_generator - INFO - --- Starting Attempt 11 (Iteration 21) ---
2025-03-30 15:57:56,087 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:57:56,087 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:57:56,087 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:57:56,087 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:57:56,088 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:57:56,088 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 15:58:03,499 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 15:58:03,502 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 15:58:03,502 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 15:58:03,503 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1192, total_tokens=4541
2025-03-30 15:58:03,503 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 15:58:03,503 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 15:58:03,503 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 15:58:03,578 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 15:58:03,578 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 15:58:03,578 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 15:58:03,579 - root.generation_attempt - INFO - Saving code...
2025-03-30 15:58:03,579 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 15:58:03,579 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 15:58:03,579 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 15:58:03,579 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 15:58:03,579 - root.generation_attempt - INFO - Running tests...
2025-03-30 15:58:03,579 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 15:58:03,579 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 15:58:03,579 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 15:58:03,579 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 15:58:03,580 - root.ros2_runner - INFO - Running tests...
2025-03-30 15:59:55,837 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.73s]
.Child process PID: 2602976, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2603063, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2603132, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-266/test_no_overlapping_scans_netw0/nscan
Child process PID: 2603314, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-266/test_invalid_json_format_netwo0/nscan
Child process PID: 2603454, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x733d2cf3f310>
network_scanner_node = psutil.Process(pid=2603454, name='python3', status='sleeping', started='15:59:41')
network_status_client = (<rclpy.node.Node object at 0x733d2b7a9c60>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.03s (0:01:25)

stderr:
Process 2602976 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2603063 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2603132 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2603274 no longer exists
Process 2603314 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2603454 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 15:59:55,837 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 15:59:55,838 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 15:59:55,838 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 15:59:55,839 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 15:59:55,859 - root.base_generator - INFO - Attempt 11 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1192
total_tokens       4541
2025-03-30 15:59:55,859 - root.base_generator - INFO - Iteration 21: Attempt 11 failed.
2025-03-30 15:59:55,859 - root.base_generator - INFO - --- Starting Attempt 12 (Iteration 21) ---
2025-03-30 15:59:55,859 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 15:59:55,860 - root.generation_attempt - INFO - Initializing...
2025-03-30 15:59:55,860 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 15:59:55,860 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 15:59:55,860 - root.generation_attempt - INFO - Generating code...
2025-03-30 15:59:55,860 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:00:03,347 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:00:03,351 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:00:03,351 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:00:03,351 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1219, total_tokens=4568
2025-03-30 16:00:03,351 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:00:03,351 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:00:03,351 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:00:03,424 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:00:03,424 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:00:03,424 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:00:03,425 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:00:03,425 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:00:03,425 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:00:03,425 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:00:03,425 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:00:03,425 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:00:03,425 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:00:03,425 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:00:03,425 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:00:03,425 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:00:03,425 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:01:41,216 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2603730, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2603798, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2603863, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-267/test_no_overlapping_scans_netw0/nscan
Child process PID: 2604054, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-267/test_invalid_json_format_netwo0/nscan
Child process PID: 2604192, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-267/test_outdated_json_results_net0/nscan
Child process PID: 2604230, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.44s (0:01:35)

stderr:
Process 2603730 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2603798 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2603863 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2604004 no longer exists
Process 2604054 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2604230 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:01:41,217 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:01:41,217 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 16:01:41,218 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 16:01:41,218 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 16:01:41,238 - root.base_generator - INFO - Attempt 12 finished with metrics:
metric             value
-----------------  -------
attempt_time       105.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1219
total_tokens       4568
2025-03-30 16:01:41,238 - root.base_generator - INFO - Iteration 21: Successful attempt achieved.
2025-03-30 16:01:41,238 - root.base_generator - INFO - Iteration 21 finished.
2025-03-30 16:01:41,238 - root.base_generator - INFO -  Iteration 22 started.
2025-03-30 16:01:41,239 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 22) ---
2025-03-30 16:01:41,239 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:01:41,239 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:01:41,239 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:01:41,239 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:01:41,239 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:01:41,239 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:01:48,067 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:01:48,070 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:01:48,071 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:01:48,071 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1090, total_tokens=4439
2025-03-30 16:01:48,071 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:01:48,071 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:01:48,071 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:01:48,150 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:01:48,150 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:01:48,150 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:01:48,150 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:01:48,150 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:01:48,150 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:01:48,151 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:01:48,151 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:01:48,151 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:01:48,151 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:01:48,151 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:01:48,151 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:01:48,151 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:01:48,151 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:03:33,344 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2604688, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2604722, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2604831, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-268/test_no_overlapping_scans_netw0/nscan
Child process PID: 2604994, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-268/test_invalid_json_format_netwo0/nscan
Child process PID: 2605117, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x794dad44ed10>
network_scanner_node = psutil.Process(pid=2605117, name='python3', status='sleeping', started='16:03:26')
network_status_client = (<rclpy.node.Node object at 0x794dac53d990>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339808, nanosec=983791810), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x794dac53d990>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339808, nanosec=983791810), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.92s (0:01:17)

stderr:
Process 2604688 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2604722 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2604831 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2604940 no longer exists
Process 2604994 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:03:33,344 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:03:33,345 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:03:33,345 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:03:33,346 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:03:33,365 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1090
total_tokens       4439
2025-03-30 16:03:33,365 - root.base_generator - INFO - Iteration 22: Attempt 1 failed.
2025-03-30 16:03:33,365 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 22) ---
2025-03-30 16:03:33,365 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:03:33,365 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:03:33,365 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:03:33,366 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:03:33,366 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:03:33,366 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:03:40,209 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:03:40,212 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:03:40,213 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:03:40,213 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1102, total_tokens=4451
2025-03-30 16:03:40,213 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:03:40,213 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:03:40,213 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:03:40,289 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:03:40,289 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:03:40,289 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:03:40,289 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:03:40,289 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:03:40,289 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:03:40,289 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:03:40,289 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:03:40,290 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:03:40,290 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:03:40,290 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:03:40,290 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:03:40,290 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:03:40,290 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:05:08,340 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2605428, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2605466, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2605576, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-269/test_no_overlapping_scans_netw0/nscan
Child process PID: 2605740, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-269/test_invalid_json_format_netwo0/nscan
Child process PID: 2605856, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x73c6a6a40640>
network_scanner_node = psutil.Process(pid=2605856, name='python3', status='sleeping', started='16:05:01')
network_status_client = (<rclpy.node.Node object at 0x73c6a6a408e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339903, nanosec=989719692), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x73c6a6a408e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743339903, nanosec=989719692), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.95s (0:01:17)

stderr:
Process 2605428 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2605466 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2605576 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2605681 no longer exists
Process 2605740 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:05:08,340 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:05:08,341 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:05:08,341 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:05:08,341 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:05:08,354 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1102
total_tokens       4451
2025-03-30 16:05:08,354 - root.base_generator - INFO - Iteration 22: Attempt 2 failed.
2025-03-30 16:05:08,354 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 22) ---
2025-03-30 16:05:08,354 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:05:08,354 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:05:08,354 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:05:08,354 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:05:08,354 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:05:08,354 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:05:15,823 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:05:15,827 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:05:15,827 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:05:15,827 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1231, total_tokens=4580
2025-03-30 16:05:15,828 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:05:15,828 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:05:15,828 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:05:15,909 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:05:15,909 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:05:15,909 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:05:15,909 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:05:15,910 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:05:15,910 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:05:15,910 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:05:15,910 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:05:15,910 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:05:15,910 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:05:15,910 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:05:15,910 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:05:15,910 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:05:15,910 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:07:04,207 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2606257, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2606332, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2606397, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-270/test_no_overlapping_scans_netw0/nscan
Child process PID: 2606585, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-270/test_invalid_json_format_netwo0/nscan
Child process PID: 2606727, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x78748dde8580>
network_scanner_node = psutil.Process(pid=2606727, name='python3', status='sleeping', started='16:06:54')
network_status_client = (<rclpy.node.Node object at 0x78748dde8c70>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340016, nanosec=767076622), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x78748dde8c70>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340016, nanosec=767076622), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2606257 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2606332 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2606397 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2606538 no longer exists
Process 2606585 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2606727 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:07:04,207 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:07:04,208 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:07:04,208 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:07:04,208 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:07:04,229 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1231
total_tokens       4580
2025-03-30 16:07:04,229 - root.base_generator - INFO - Iteration 22: Attempt 3 failed.
2025-03-30 16:07:04,229 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 22) ---
2025-03-30 16:07:04,230 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:07:04,230 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:07:04,230 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:07:04,230 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:07:04,230 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:07:04,230 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:07:11,894 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:07:11,898 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:07:11,898 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:07:11,898 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1200, total_tokens=4549
2025-03-30 16:07:11,898 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:07:11,898 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:07:11,898 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:07:11,980 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:07:11,980 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:07:11,980 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:07:11,980 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:07:11,981 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:07:11,981 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:07:11,981 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:07:11,981 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:07:11,981 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:07:11,981 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:07:11,981 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:07:11,981 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:07:11,981 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:07:11,981 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:08:51,617 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2607009, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2607065, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2607148, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-271/test_no_overlapping_scans_netw0/nscan
Child process PID: 2607330, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-271/test_invalid_json_format_netwo0/nscan
Child process PID: 2607462, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-271/test_outdated_json_results_net0/nscan
Child process PID: 2607514, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.46s (0:01:33)

stderr:
Process 2607009 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2607065 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2607148 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2607283 no longer exists
Process 2607330 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2607514 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:08:51,617 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:08:51,618 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 16:08:51,618 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 16:08:51,618 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 16:08:51,639 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       107.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1200
total_tokens       4549
2025-03-30 16:08:51,639 - root.base_generator - INFO - Iteration 22: Successful attempt achieved.
2025-03-30 16:08:51,639 - root.base_generator - INFO - Iteration 22 finished.
2025-03-30 16:08:51,639 - root.base_generator - INFO -  Iteration 23 started.
2025-03-30 16:08:51,640 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 23) ---
2025-03-30 16:08:51,640 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:08:51,640 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:08:51,640 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:08:51,640 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:08:51,640 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:08:51,640 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:08:58,994 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:08:58,998 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:08:58,998 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:08:58,998 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1178, total_tokens=4527
2025-03-30 16:08:58,999 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:08:58,999 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:08:58,999 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:08:59,083 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:08:59,084 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:08:59,084 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:08:59,084 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:08:59,084 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:08:59,084 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:08:59,084 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:08:59,084 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:08:59,084 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:08:59,085 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:08:59,085 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:08:59,085 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:08:59,085 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:08:59,085 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:10:51,394 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.74s]
.Child process PID: 2608028, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2608065, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2608176, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-272/test_no_overlapping_scans_netw0/nscan
Child process PID: 2608341, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-272/test_invalid_json_format_netwo0/nscan
Child process PID: 2608455, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7deb99f3ed40>
network_scanner_node = psutil.Process(pid=2608455, name='python3', status='sleeping', started='16:10:37')
network_status_client = (<rclpy.node.Node object at 0x7deb98776290>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2608028 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2608065 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2608176 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2608281 no longer exists
Process 2608341 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2608455 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:10:51,394 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:10:51,394 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:10:51,395 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:10:51,395 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:10:51,407 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1178
total_tokens       4527
2025-03-30 16:10:51,407 - root.base_generator - INFO - Iteration 23: Attempt 1 failed.
2025-03-30 16:10:51,408 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 23) ---
2025-03-30 16:10:51,408 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:10:51,408 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:10:51,408 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:10:51,408 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:10:51,408 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:10:51,408 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:10:58,516 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:10:58,519 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:10:58,519 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:10:58,520 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1130, total_tokens=4479
2025-03-30 16:10:58,520 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:10:58,520 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:10:58,520 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:10:58,598 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:10:58,598 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:10:58,598 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:10:58,598 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:10:58,599 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:10:58,599 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:10:58,599 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:10:58,599 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:10:58,599 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:10:58,599 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:10:58,599 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:10:58,599 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:10:58,599 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:10:58,600 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:12:19,259 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.77s]
.Child process PID: 2608758, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2608805, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2608919, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-273/test_no_overlapping_scans_netw0/nscan
Child process PID: 2609104, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-273/test_invalid_json_format_netwo0/nscan
Child process PID: 2609201, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ba00b639030>
network_scanner_node = psutil.Process(pid=2609201, name='python3', status='sleeping', started='16:12:12')
network_status_client = (<rclpy.node.Node object at 0x7ba00b63b520>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340334, nanosec=922975179), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7ba00b63b520>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340334, nanosec=922975179), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.96s (0:01:17)

stderr:
Process 2608758 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2608805 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2608919 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2609018 no longer exists
Process 2609104 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:12:19,260 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:12:19,261 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:12:19,261 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:12:19,261 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:12:19,282 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       87.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1130
total_tokens       4479
2025-03-30 16:12:19,282 - root.base_generator - INFO - Iteration 23: Attempt 2 failed.
2025-03-30 16:12:19,282 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 23) ---
2025-03-30 16:12:19,282 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:12:19,282 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:12:19,283 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:12:19,283 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:12:19,283 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:12:19,283 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:12:26,591 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:12:26,594 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:12:26,595 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:12:26,595 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1146, total_tokens=4495
2025-03-30 16:12:26,595 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:12:26,595 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:12:26,595 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:12:26,676 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:12:26,676 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:12:26,676 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:12:26,677 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:12:26,677 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:12:26,677 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:12:26,677 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:12:26,677 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:12:26,677 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:12:26,677 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:12:26,677 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:12:26,677 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:12:26,678 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:12:26,678 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:14:15,104 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2609601, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2609664, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2609743, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-274/test_no_overlapping_scans_netw0/nscan
Child process PID: 2609924, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-274/test_invalid_json_format_netwo0/nscan
Child process PID: 2610058, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x783d547e8580>
network_scanner_node = psutil.Process(pid=2610058, name='python3', status='sleeping', started='16:14:04')
network_status_client = (<rclpy.node.Node object at 0x783d538b1d20>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340447, nanosec=647838405), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x783d538b1d20>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340447, nanosec=647838405), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.09s (0:01:21)

stderr:
Process 2609601 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2609664 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2609743 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2609875 no longer exists
Process 2609924 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2610058 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:14:15,104 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:14:15,105 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:14:15,105 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:14:15,105 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:14:15,126 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1146
total_tokens       4495
2025-03-30 16:14:15,126 - root.base_generator - INFO - Iteration 23: Attempt 3 failed.
2025-03-30 16:14:15,126 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 23) ---
2025-03-30 16:14:15,127 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:14:15,127 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:14:15,127 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:14:15,127 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:14:15,127 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:14:15,127 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:14:22,027 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:14:22,031 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:14:22,031 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:14:22,031 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1107, total_tokens=4456
2025-03-30 16:14:22,031 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:14:22,031 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:14:22,032 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:14:22,111 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:14:22,112 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:14:22,112 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:14:22,112 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:14:22,112 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:14:22,112 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:14:22,112 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:14:22,112 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:14:22,113 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:14:22,113 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:14:22,113 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:14:22,113 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:14:22,113 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:14:22,113 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:16:03,572 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.76s]
.Child process PID: 2610370, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2610403, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2610501, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-275/test_no_overlapping_scans_netw0/nscan
Child process PID: 2610673, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-275/test_invalid_json_format_netwo0/nscan
Child process PID: 2610799, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-275/test_outdated_json_results_net0/nscan
Child process PID: 2610858, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
F
=================================== FAILURES ===================================
__________ TestFull.test_outdated_json_results[network_scanner_node0] __________

self = <test_scanner_node.TestFull object at 0x785c8ed34d30>
network_scanner_node = psutil.Process(pid=2610858, status='terminated', started='16:15:48')
network_status_client = (<rclpy.node.Node object at 0x785c8d574b20>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_outdated_json_results(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON result file is older than 20 seconds,
        the scanner node publishes a message with an empty addresses list.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        # Create outdated JSON file - will check from the first scan
        data = {"7.7.7.7": {"state": "UP", "response_time_ms": 15, "error": None}}
        with open(json_file_path, "w") as f:
            json.dump(data, f)

        # Backdate the modification time by 20 seconds
        old_time = time.time() - 20
        os.utime(json_file_path, (old_time, old_time))

        client_node, received_msgs = network_status_client
>       assert wait_for_messages(
            client_node, received_msgs, count=3, timeout=10
        ), "Did not receive at least 3 messages in time"
E       AssertionError: Did not receive at least 3 messages in time
E       assert False
E        +  where False = wait_for_messages(<rclpy.node.Node object at 0x785c8d574b20>, [], count=3, timeout=10)

src/network_scanner/test/test_scanner_node.py:335: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_outdated_json_results[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 8 passed in 94.62s (0:01:34)

stderr:
Process 2610370 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2610403 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2610501 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2610625 no longer exists
Process 2610673 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:16:03,572 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:16:03,573 - root.ros2_runner - INFO - Tests failed: 1, passed: 8, skipped: 0
2025-03-30 16:16:03,573 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:16:03,573 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:16:03,594 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       108.4
success            False
final_state        TEST
tests_passed       8
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1107
total_tokens       4456
2025-03-30 16:16:03,594 - root.base_generator - INFO - Iteration 23: Attempt 4 failed.
2025-03-30 16:16:03,594 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 23) ---
2025-03-30 16:16:03,594 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:16:03,594 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:16:03,594 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:16:03,595 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:16:03,595 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:16:03,595 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:16:10,235 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:16:10,238 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:16:10,238 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:16:10,239 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1091, total_tokens=4440
2025-03-30 16:16:10,239 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:16:10,239 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:16:10,239 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:16:10,317 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:16:10,317 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:16:10,317 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:16:10,317 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:16:10,317 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:16:10,318 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:16:10,318 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:16:10,318 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:16:10,318 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:16:10,318 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:16:10,318 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:16:10,318 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:16:10,318 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:16:10,318 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:18:11,074 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2611290, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2611337, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2611476, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-276/test_no_overlapping_scans_netw0/nscan
Child process PID: 2611657, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-276/test_invalid_json_format_netwo0/nscan
Child process PID: 2611737, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-276/test_outdated_json_results_net0/nscan
Child process PID: 2611816, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.48s (0:01:33)

stderr:
Process 2611290 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2611337 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2611476 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2611561 no longer exists
Process 2611657 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2611816 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:18:11,075 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:18:11,076 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 16:18:11,076 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 16:18:11,076 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 16:18:11,096 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       127.5
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1091
total_tokens       4440
2025-03-30 16:18:11,097 - root.base_generator - INFO - Iteration 23: Successful attempt achieved.
2025-03-30 16:18:11,097 - root.base_generator - INFO - Iteration 23 finished.
2025-03-30 16:18:11,097 - root.base_generator - INFO -  Iteration 24 started.
2025-03-30 16:18:11,097 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 24) ---
2025-03-30 16:18:11,097 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:18:11,097 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:18:11,098 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:18:11,098 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:18:11,098 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:18:11,098 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:18:17,900 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:18:17,903 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:18:17,904 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:18:17,904 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1111, total_tokens=4460
2025-03-30 16:18:17,904 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:18:17,904 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:18:17,904 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:18:18,425 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:18:18,426 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:18:18,426 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:18:18,427 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:18:18,427 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:18:18,427 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:20:03,564 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.72s]
.Child process PID: 2612231, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2612303, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2612400, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-277/test_no_overlapping_scans_netw0/nscan
Child process PID: 2612589, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-277/test_invalid_json_format_netwo0/nscan
Child process PID: 2612696, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x703295138fd0>
network_scanner_node = psutil.Process(pid=2612696, name='python3', status='sleeping', started='16:19:56')
network_status_client = (<rclpy.node.Node object at 0x70329513b0d0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340799, nanosec=182933788), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x70329513b0d0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743340799, nanosec=182933788), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.94s (0:01:17)

stderr:
Process 2612231 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2612303 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2612400 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2612533 no longer exists
Process 2612589 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:20:03,564 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:20:03,565 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:20:03,565 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:20:03,565 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:20:03,586 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1111
total_tokens       4460
2025-03-30 16:20:03,586 - root.base_generator - INFO - Iteration 24: Attempt 1 failed.
2025-03-30 16:20:03,586 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 24) ---
2025-03-30 16:20:03,586 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:20:03,586 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:20:03,587 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:20:03,587 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:20:03,587 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:20:03,587 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:20:10,835 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:20:10,839 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:20:10,839 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:20:10,839 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1165, total_tokens=4514
2025-03-30 16:20:10,839 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:20:10,839 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:20:10,840 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:20:10,919 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:20:10,919 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:20:10,919 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:20:10,919 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:20:10,920 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:20:10,920 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:20:10,920 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:20:10,920 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:20:10,920 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:20:10,920 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:20:10,920 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:20:10,920 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:20:10,920 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:20:10,920 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:21:45,700 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2612974, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2613046, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2613135, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-278/test_no_overlapping_scans_netw0/nscan
Child process PID: 2613322, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-278/test_invalid_json_format_netwo0/nscan
Child process PID: 2613436, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7988261ead10>
network_scanner_node = psutil.Process(pid=2613436, name='python3', status='sleeping', started='16:21:31')
network_status_client = (<rclpy.node.Node object at 0x7988252b1e70>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2612974 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2613046 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2613135 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2613284 no longer exists
Process 2613322 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2613436 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:21:45,700 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:21:45,701 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:21:45,701 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:21:45,702 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:21:45,722 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       102.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1165
total_tokens       4514
2025-03-30 16:21:45,723 - root.base_generator - INFO - Iteration 24: Attempt 2 failed.
2025-03-30 16:21:45,723 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 24) ---
2025-03-30 16:21:45,723 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:21:45,723 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:21:45,723 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:21:45,723 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:21:45,724 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:21:45,724 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:21:53,290 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:21:53,293 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:21:53,294 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:21:53,294 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1226, total_tokens=4575
2025-03-30 16:21:53,294 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:21:53,294 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:21:53,294 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:21:53,376 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:21:53,376 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:21:53,376 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:21:53,376 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:21:53,377 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:21:53,377 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:21:53,377 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:21:53,377 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:21:53,377 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:21:53,377 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:21:53,377 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:21:53,377 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:21:53,377 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:21:53,377 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:23:41,735 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2613846, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2613920, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2614026, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-279/test_no_overlapping_scans_netw0/nscan
Child process PID: 2614219, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-279/test_invalid_json_format_netwo0/nscan
Child process PID: 2614323, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x79d4f1d471f0>
network_scanner_node = psutil.Process(pid=2614323, name='python3', status='sleeping', started='16:23:31')
network_status_client = (<rclpy.node.Node object at 0x79d4f05ade10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341014, nanosec=290810513), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x79d4f05ade10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341014, nanosec=290810513), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2613846 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2613920 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2614026 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2614153 no longer exists
Process 2614219 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2614323 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:23:41,735 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:23:41,736 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:23:41,736 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:23:41,736 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:23:41,758 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       116.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1226
total_tokens       4575
2025-03-30 16:23:41,758 - root.base_generator - INFO - Iteration 24: Attempt 3 failed.
2025-03-30 16:23:41,758 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 24) ---
2025-03-30 16:23:41,758 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:23:41,758 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:23:41,758 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:23:41,759 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:23:41,759 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:23:41,759 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:23:49,139 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:23:49,143 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:23:49,143 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:23:49,144 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1184, total_tokens=4533
2025-03-30 16:23:49,144 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:23:49,144 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:23:49,144 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:23:49,227 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:23:49,227 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:23:49,227 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:23:49,227 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:23:49,227 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:23:49,227 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:23:49,227 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:23:49,227 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:23:49,228 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:23:49,228 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:23:49,228 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:23:49,228 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:23:49,228 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:23:49,228 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:25:16,706 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2614604, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2614673, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2614766, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-280/test_no_overlapping_scans_netw0/nscan
Child process PID: 2614950, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-280/test_invalid_json_format_netwo0/nscan
Child process PID: 2615066, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7c3276f3c670>
network_scanner_node = psutil.Process(pid=2615066, name='python3', status='sleeping', started='16:25:06')
network_status_client = (<rclpy.node.Node object at 0x7c32757a1840>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341109, nanosec=273733519), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7c32757a1840>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341109, nanosec=273733519), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2614604 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2614673 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2614766 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2614914 no longer exists
Process 2614950 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2615066 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:25:16,706 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:25:16,707 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:25:16,707 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:25:16,707 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:25:16,728 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1184
total_tokens       4533
2025-03-30 16:25:16,728 - root.base_generator - INFO - Iteration 24: Attempt 4 failed.
2025-03-30 16:25:16,729 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 24) ---
2025-03-30 16:25:16,729 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:25:16,729 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:25:16,729 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:25:16,729 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:25:16,729 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:25:16,729 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:25:24,108 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:25:24,112 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:25:24,112 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:25:24,112 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1162, total_tokens=4511
2025-03-30 16:25:24,112 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:25:24,112 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:25:24,112 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:25:24,191 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:25:24,192 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:25:24,192 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:25:24,193 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:25:24,193 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:25:24,193 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:25:24,193 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:27:16,470 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.71s]
.Child process PID: 2615461, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2615516, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2615638, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-281/test_no_overlapping_scans_netw0/nscan
Child process PID: 2615826, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-281/test_invalid_json_format_netwo0/nscan
Child process PID: 2615907, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7d8f4b5e4580>
network_scanner_node = psutil.Process(pid=2615907, name='python3', status='sleeping', started='16:27:02')
network_status_client = (<rclpy.node.Node object at 0x7d8f4a6ad960>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2615461 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2615516 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2615638 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2615743 no longer exists
Process 2615826 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2615907 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:27:16,470 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:27:16,471 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:27:16,471 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:27:16,472 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:27:16,496 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1162
total_tokens       4511
2025-03-30 16:27:16,496 - root.base_generator - INFO - Iteration 24: Attempt 5 failed.
2025-03-30 16:27:16,496 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 24) ---
2025-03-30 16:27:16,497 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:27:16,497 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:27:16,497 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:27:16,497 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:27:16,497 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:27:16,497 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:27:23,624 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:27:23,628 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:27:23,629 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:27:23,629 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1133, total_tokens=4482
2025-03-30 16:27:23,629 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:27:23,630 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:27:23,630 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:27:23,718 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:27:23,718 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:27:23,718 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:27:23,718 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:27:23,719 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:27:23,719 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:27:23,719 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:27:23,719 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:27:23,719 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:27:23,719 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:27:23,719 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:27:23,719 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:27:23,719 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:27:23,719 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:28:47,432 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.80s]
.Child process PID: 2616205, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2616262, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2616374, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-282/test_no_overlapping_scans_netw0/nscan
Child process PID: 2616566, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-282/test_invalid_json_format_netwo0/nscan
Child process PID: 2616648, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x75873bd3c670>
network_scanner_node = psutil.Process(pid=2616648, name='python3', status='sleeping', started='16:28:37')
network_status_client = (<rclpy.node.Node object at 0x75873a5a1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341320, nanosec=9440566), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x75873a5a1930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341320, nanosec=9440566), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2616205 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2616262 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2616374 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2616486 no longer exists
Process 2616566 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2616648 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:28:47,432 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:28:47,433 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:28:47,433 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:28:47,433 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:28:47,455 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       90.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1133
total_tokens       4482
2025-03-30 16:28:47,455 - root.base_generator - INFO - Iteration 24: Attempt 6 failed.
2025-03-30 16:28:47,455 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 24) ---
2025-03-30 16:28:47,455 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:28:47,455 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:28:47,455 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:28:47,456 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:28:47,456 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:28:47,456 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:28:54,881 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:28:54,885 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:28:54,885 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:28:54,885 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1219, total_tokens=4568
2025-03-30 16:28:54,885 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:28:54,886 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:28:54,886 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:28:54,969 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:28:54,970 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:28:54,970 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:28:54,971 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:28:54,971 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:28:54,971 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:29:25,655 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.72s]
.E
==================================== ERRORS ====================================
_________________ ERROR at setup of TestFull.test_node_running _________________

request = <SubRequest 'network_scanner_node' for <Function test_node_running>>
tmp_path = PosixPath('/tmp/pytest-of-aleev/pytest-283/test_node_running0')
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x714f28039450>

    @pytest.fixture(scope="function")
    def network_scanner_node(request, tmp_path, monkeypatch):
        """Fixture that sets up a network scanner node with the provided parameters."""
        if not rclpy.ok():
            rclpy.init()

        # Default parameters
        network = "4.2.2.2"
        scan_period = 3
        mock_nscan = False
        mock_nscan_text = """#!/bin/bash
        echo "NSCAN"
        """
        if hasattr(request, "param"):
            params = request.param
            network = params.get("network", network)
            scan_period = params.get("scan_period", scan_period)
            mock_nscan = params.get("mock_nscan", mock_nscan)
            mock_nscan_text = params.get("mock_nscan_text", mock_nscan_text)

        if mock_nscan:
            print("Using mock nscan binary")
            nscan_path = os.path.join(tmp_path, "nscan")
            with open(nscan_path, "w") as f:
                f.write(mock_nscan_text)
            os.chmod(nscan_path, 0o755)

            monkeypatch.setenv("PATH", f"{tmp_path}:{os.environ.get('PATH')}")
            print(f"nscan path: {nscan_path}")

        runner = ros2_runner.ROS2Runner(
            node_command=f"ros2 run network_scanner scanner_node --ros-args -p network:={network!r} -p scan_period:={scan_period}",
            test_command="",
        )
>       runner.start_node()

src/network_scanner/test/test_scanner_node.py:46:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <codestral_ros2_gen.utils.ros2_runner.ROS2Runner object at 0x714f28039480>

    def start_node(self) -> None:
        """
        Start the ROS2 node and verify it launched successfully.

        If "skip / SKIP" is found in the node_command, the node is not started.

        Raises:
            RuntimeError: If the node fails to start or register with ROS2.
        """
        logger.info("Starting the ROS2 node...")
        if "skip" in self.node_command.lower():
            logger.info("Skipping node start as requested.")
            return
        else:
            self.node_process = subprocess.Popen(
                self.node_command,
                shell=True,
                executable="/bin/bash",
                stderr=subprocess.PIPE,
                stdout=subprocess.PIPE,
                text=True,
            )

            # Wait briefly for node to initialize
            time.sleep(2)

            # Check if process is still running
            if self.node_process.poll() is not None:
                # Process terminated - get error output
                stdout, stderr = self.node_process.communicate()
                error_msg = f"Node process terminated immediately.\nStdout: {stdout}\nStderr: {stderr}"
>               raise RuntimeError(error_msg)
E               RuntimeError: Node process terminated immediately.
E               Stdout: [ros2run]: Process exited with failure 1
E
E               Stderr: Traceback (most recent call last):
E                 File "/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node", line 10, in <module>
E                   from rclpy.exceptions import ParameterValueException
E               ImportError: cannot import name 'ParameterValueException' from 'rclpy.exceptions' (/opt/ros/humble/local/lib/python3.10/dist-packages/rclpy/exceptions.py)

../codestral_ros2_gen/src/codestral_ros2_gen/utils/ros2_runner.py:79: RuntimeError
=========================== short test summary info ============================
ERROR src/network_scanner/test/test_scanner_node.py::TestFull::test_node_running
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 passed, 1 error in 3.59s

stderr:

2025-03-30 16:29:25,655 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:29:25,656 - root.ros2_runner - INFO - Tests failed: 0, passed: 1, skipped: 0
2025-03-30 16:29:25,656 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:29:25,656 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:29:25,676 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       38.2
success            False
final_state        TEST
tests_passed       1
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1219
total_tokens       4568
2025-03-30 16:29:25,676 - root.base_generator - INFO - Iteration 24: Attempt 7 failed.
2025-03-30 16:29:25,677 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 24) ---
2025-03-30 16:29:25,677 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:29:25,677 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:29:25,677 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:29:25,677 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:29:25,677 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:29:25,677 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:29:32,700 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:29:32,704 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:29:32,704 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:29:32,704 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1132, total_tokens=4481
2025-03-30 16:29:32,704 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:29:32,704 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:29:32,705 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:29:32,783 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:29:32,783 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:29:32,784 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:29:32,784 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:29:32,785 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:29:32,785 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:29:32,785 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:31:25,098 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.76s]
.Child process PID: 2617394, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2617469, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2617591, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-284/test_no_overlapping_scans_netw0/nscan
Child process PID: 2617784, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-284/test_invalid_json_format_netwo0/nscan
Child process PID: 2617862, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e114993ed10>
network_scanner_node = psutil.Process(pid=2617862, name='python3', status='sleeping', started='16:31:11')
network_status_client = (<rclpy.node.Node object at 0x7e114993c640>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2617394 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2617469 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2617591 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2617702 no longer exists
Process 2617784 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2617862 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:31:25,099 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:31:25,100 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:31:25,100 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:31:25,100 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:31:25,122 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1132
total_tokens       4481
2025-03-30 16:31:25,122 - root.base_generator - INFO - Iteration 24: Attempt 8 failed.
2025-03-30 16:31:25,122 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 24) ---
2025-03-30 16:31:25,122 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:31:25,123 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:31:25,123 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:31:25,123 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:31:25,123 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:31:25,123 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:31:31,891 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:31:31,894 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:31:31,895 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:31:31,895 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1063, total_tokens=4412
2025-03-30 16:31:31,895 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:31:31,895 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:31:31,895 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:31:31,973 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:31:31,973 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:31:31,973 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:31:31,973 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:31:31,974 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:31:31,974 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:31:31,974 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:31:31,974 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:31:31,974 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:31:31,974 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:31:31,974 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:31:31,974 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:31:31,974 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:31:31,974 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:33:17,187 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.74s]
.Child process PID: 2618292, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2618340, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2618474, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-285/test_no_overlapping_scans_netw0/nscan
Child process PID: 2618638, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-285/test_invalid_json_format_netwo0/nscan
Child process PID: 2618739, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x71dcb79e4670>
network_scanner_node = psutil.Process(pid=2618739, name='python3', status='sleeping', started='16:33:10')
network_status_client = (<rclpy.node.Node object at 0x71dcb6acdf30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341592, nanosec=814059441), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x71dcb6acdf30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341592, nanosec=814059441), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.97s (0:01:17)

stderr:
Process 2618292 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2618340 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2618474 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2618559 no longer exists
Process 2618638 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:33:17,187 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:33:17,188 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:33:17,188 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:33:17,188 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:33:17,209 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1063
total_tokens       4412
2025-03-30 16:33:17,209 - root.base_generator - INFO - Iteration 24: Attempt 9 failed.
2025-03-30 16:33:17,210 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 24) ---
2025-03-30 16:33:17,210 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:33:17,210 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:33:17,210 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:33:17,210 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:33:17,210 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:33:17,210 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:33:24,291 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:33:24,294 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:33:24,294 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:33:24,295 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1115, total_tokens=4464
2025-03-30 16:33:24,295 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:33:24,295 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:33:24,295 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:33:24,375 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:33:24,375 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:33:24,376 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:33:24,376 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:33:24,377 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:33:24,377 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:33:24,377 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:34:55,237 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2619036, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2619089, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2619212, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-286/test_no_overlapping_scans_netw0/nscan
Child process PID: 2619405, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-286/test_invalid_json_format_netwo0/nscan
Child process PID: 2619483, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7d7b50244580>
network_scanner_node = psutil.Process(pid=2619483, name='python3', status='sleeping', started='16:34:45')
network_status_client = (<rclpy.node.Node object at 0x7d7b50246ef0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341687, nanosec=809666532), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7d7b50246ef0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341687, nanosec=809666532), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2619036 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2619089 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2619212 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2619322 no longer exists
Process 2619405 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2619483 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:34:55,237 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:34:55,238 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:34:55,238 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:34:55,239 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:34:55,259 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       98.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1115
total_tokens       4464
2025-03-30 16:34:55,260 - root.base_generator - INFO - Iteration 24: Attempt 10 failed.
2025-03-30 16:34:55,260 - root.base_generator - INFO - --- Starting Attempt 11 (Iteration 24) ---
2025-03-30 16:34:55,260 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:34:55,260 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:34:55,260 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:34:55,260 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:34:55,260 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:34:55,260 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:35:02,309 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:35:02,312 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:35:02,313 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:35:02,313 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1114, total_tokens=4463
2025-03-30 16:35:02,313 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:35:02,313 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:35:02,313 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:35:02,394 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:35:02,394 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:35:02,394 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:35:02,394 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:35:02,394 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:35:02,394 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:35:02,395 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:35:02,395 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:35:02,395 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:35:02,395 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:35:02,395 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:35:02,395 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:35:02,395 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:35:02,395 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:36:50,676 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.72s]
.Child process PID: 2619906, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2619954, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2620054, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-287/test_no_overlapping_scans_netw0/nscan
Child process PID: 2620235, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-287/test_invalid_json_format_netwo0/nscan
Child process PID: 2620349, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7c11eb8dad10>
network_scanner_node = psutil.Process(pid=2620349, name='python3', status='sleeping', started='16:36:40')
network_status_client = (<rclpy.node.Node object at 0x7c11ea1a5e40>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341803, nanosec=230108382), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7c11ea1a5e40>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341803, nanosec=230108382), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2619906 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2619954 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2620054 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2620159 no longer exists
Process 2620235 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2620349 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:36:50,676 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:36:50,677 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:36:50,677 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:36:50,677 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:36:50,690 - root.base_generator - INFO - Attempt 11 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1114
total_tokens       4463
2025-03-30 16:36:50,690 - root.base_generator - INFO - Iteration 24: Attempt 11 failed.
2025-03-30 16:36:50,690 - root.base_generator - INFO - --- Starting Attempt 12 (Iteration 24) ---
2025-03-30 16:36:50,690 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:36:50,690 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:36:50,690 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:36:50,690 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:36:50,690 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:36:50,691 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:36:58,072 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:36:58,075 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:36:58,076 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:36:58,076 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1124, total_tokens=4473
2025-03-30 16:36:58,076 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:36:58,076 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:36:58,076 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:36:58,156 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:36:58,156 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:36:58,157 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:36:58,157 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:36:58,158 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:36:58,158 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:36:58,158 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:38:22,519 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.76s]
.Child process PID: 2620642, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2620699, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2620826, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-288/test_no_overlapping_scans_netw0/nscan
Child process PID: 2620995, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-288/test_invalid_json_format_netwo0/nscan
Child process PID: 2621097, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x714063740580>
network_scanner_node = psutil.Process(pid=2621097, name='python3', status='sleeping', started='16:38:15')
network_status_client = (<rclpy.node.Node object at 0x714061fa1840>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341898, nanosec=174426363), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x714061fa1840>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743341898, nanosec=174426363), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.92s (0:01:17)

stderr:
Process 2620642 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2620699 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2620826 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2620918 no longer exists
Process 2620995 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:38:22,520 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:38:22,521 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:38:22,521 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:38:22,521 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:38:22,543 - root.base_generator - INFO - Attempt 12 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1124
total_tokens       4473
2025-03-30 16:38:22,544 - root.base_generator - INFO - Iteration 24: Attempt 12 failed.
2025-03-30 16:38:22,544 - root.base_generator - INFO - --- Starting Attempt 13 (Iteration 24) ---
2025-03-30 16:38:22,544 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:38:22,544 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:38:22,544 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:38:22,544 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:38:22,544 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:38:22,545 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:38:29,806 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:38:29,809 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:38:29,809 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:38:29,809 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1177, total_tokens=4526
2025-03-30 16:38:29,810 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:38:29,810 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:38:29,810 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:38:29,891 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:38:29,891 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:38:29,891 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:38:29,891 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:38:29,891 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:38:29,891 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:38:29,892 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:38:29,892 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:38:29,892 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:38:29,892 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:38:29,892 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:38:29,892 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:38:29,892 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:38:29,892 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:40:18,189 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.55s]

Summary: 1 package finished [0.72s]
.Child process PID: 2621509, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2621617, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2621710, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-289/test_no_overlapping_scans_netw0/nscan
Child process PID: 2621885, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-289/test_invalid_json_format_netwo0/nscan
Child process PID: 2622010, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7131d1fead10>
network_scanner_node = psutil.Process(pid=2622010, name='python3', status='sleeping', started='16:40:08')
network_status_client = (<rclpy.node.Node object at 0x7131d10b1d20>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342010, nanosec=741725429), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7131d10b1d20>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342010, nanosec=741725429), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.06s (0:01:21)

stderr:
Process 2621509 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2621617 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2621710 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2621830 no longer exists
Process 2621885 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2622010 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:40:18,189 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:40:18,190 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:40:18,191 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:40:18,191 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:40:18,214 - root.base_generator - INFO - Attempt 13 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1177
total_tokens       4526
2025-03-30 16:40:18,214 - root.base_generator - INFO - Iteration 24: Attempt 13 failed.
2025-03-30 16:40:18,214 - root.base_generator - INFO - --- Starting Attempt 14 (Iteration 24) ---
2025-03-30 16:40:18,214 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:40:18,214 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:40:18,214 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:40:18,214 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:40:18,215 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:40:18,215 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:40:25,403 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:40:25,407 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:40:25,407 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:40:25,407 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1207, total_tokens=4556
2025-03-30 16:40:25,407 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:40:25,407 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:40:25,408 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:40:25,487 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:40:25,487 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:40:25,487 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:40:25,487 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:40:25,487 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:40:25,487 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:40:25,487 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:40:25,487 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:40:25,488 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:40:25,488 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:40:25,488 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:40:25,488 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:40:25,488 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:40:25,488 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:41:53,120 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.80s]
.Child process PID: 2622317, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2622364, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2622458, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-290/test_no_overlapping_scans_netw0/nscan
Child process PID: 2622640, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-290/test_invalid_json_format_netwo0/nscan
Child process PID: 2622760, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x737a060db310>
network_scanner_node = psutil.Process(pid=2622760, name='python3', status='sleeping', started='16:41:43')
network_status_client = (<rclpy.node.Node object at 0x737a049a1f30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342105, nanosec=679368053), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x737a049a1f30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342105, nanosec=679368053), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.01s (0:01:21)

stderr:
Process 2622317 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2622364 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2622458 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2622570 no longer exists
Process 2622640 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2622760 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:41:53,120 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:41:53,121 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:41:53,121 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:41:53,121 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:41:53,134 - root.base_generator - INFO - Attempt 14 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1207
total_tokens       4556
2025-03-30 16:41:53,135 - root.base_generator - INFO - Iteration 24: Attempt 14 failed.
2025-03-30 16:41:53,135 - root.base_generator - INFO - --- Starting Attempt 15 (Iteration 24) ---
2025-03-30 16:41:53,135 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:41:53,135 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:41:53,135 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:41:53,135 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:41:53,135 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:41:53,135 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:42:00,318 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:42:00,321 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:42:00,321 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:42:00,322 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1157, total_tokens=4506
2025-03-30 16:42:00,322 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:42:00,322 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:42:00,322 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:42:00,399 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:42:00,399 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:42:00,399 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:42:00,399 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:42:00,399 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:42:00,400 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:42:00,400 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:42:00,400 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:42:00,400 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:42:00,400 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:42:00,400 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:42:00,400 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:42:00,400 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:42:00,400 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:43:48,665 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.75s]
.Child process PID: 2623180, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2623235, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2623321, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-291/test_no_overlapping_scans_netw0/nscan
Child process PID: 2623506, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-291/test_invalid_json_format_netwo0/nscan
Child process PID: 2623632, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x747a8a24ad40>
network_scanner_node = psutil.Process(pid=2623632, name='python3', status='sleeping', started='16:43:38')
network_status_client = (<rclpy.node.Node object at 0x747a8a248a30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342221, nanosec=237258289), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x747a8a248a30>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342221, nanosec=237258289), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.00s (0:01:20)

stderr:
Process 2623180 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2623235 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2623321 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2623452 no longer exists
Process 2623506 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2623632 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:43:48,665 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:43:48,666 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:43:48,666 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:43:48,666 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:43:48,688 - root.base_generator - INFO - Attempt 15 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1157
total_tokens       4506
2025-03-30 16:43:48,689 - root.base_generator - INFO - Iteration 24: Attempt 15 failed.
2025-03-30 16:43:48,689 - root.base_generator - INFO - --- Starting Attempt 16 (Iteration 24) ---
2025-03-30 16:43:48,689 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:43:48,689 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:43:48,689 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:43:48,689 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:43:48,689 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:43:48,689 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:43:56,167 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:43:56,171 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:43:56,171 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:43:56,171 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1200, total_tokens=4549
2025-03-30 16:43:56,172 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:43:56,172 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:43:56,172 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:43:56,252 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:43:56,253 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:43:56,253 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:43:56,254 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:43:56,254 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:43:56,254 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:45:23,690 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.76s]
.Child process PID: 2623941, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2623978, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2624074, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-292/test_no_overlapping_scans_netw0/nscan
Child process PID: 2624263, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-292/test_invalid_json_format_netwo0/nscan
Child process PID: 2624374, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x74799863c640>
network_scanner_node = psutil.Process(pid=2624374, name='python3', status='sleeping', started='16:45:13')
network_status_client = (<rclpy.node.Node object at 0x74799863e950>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342316, nanosec=254563013), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x74799863e950>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342316, nanosec=254563013), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2623941 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2623978 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2624074 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2624193 no longer exists
Process 2624263 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2624374 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:45:23,691 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:45:23,692 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:45:23,692 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:45:23,692 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:45:23,714 - root.base_generator - INFO - Attempt 16 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1200
total_tokens       4549
2025-03-30 16:45:23,715 - root.base_generator - INFO - Iteration 24: Attempt 16 failed.
2025-03-30 16:45:23,715 - root.base_generator - INFO - --- Starting Attempt 17 (Iteration 24) ---
2025-03-30 16:45:23,715 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:45:23,715 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:45:23,715 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:45:23,715 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:45:23,715 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:45:23,716 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:45:30,539 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:45:30,543 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:45:30,543 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:45:30,543 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1113, total_tokens=4462
2025-03-30 16:45:30,543 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:45:30,543 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:45:30,543 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:45:30,620 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:45:30,620 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:45:30,620 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:45:30,620 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:45:30,621 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:45:30,621 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:45:30,621 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:45:30,621 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:45:30,621 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:45:30,621 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:45:30,621 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:45:30,621 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:45:30,621 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:45:30,621 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:47:31,347 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.55s]

Summary: 1 package finished [0.71s]
.Child process PID: 2624768, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2624847, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2624927, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-293/test_no_overlapping_scans_netw0/nscan
Child process PID: 2625118, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-293/test_invalid_json_format_netwo0/nscan
Child process PID: 2625243, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-293/test_outdated_json_results_net0/nscan
Child process PID: 2625294, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.50s (0:01:33)

stderr:
Process 2624768 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2624847 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2624927 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2625059 no longer exists
Process 2625118 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2625294 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:47:31,348 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:47:31,348 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 16:47:31,349 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 16:47:31,349 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 16:47:31,371 - root.base_generator - INFO - Attempt 17 finished with metrics:
metric             value
-----------------  -------
attempt_time       127.6
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1113
total_tokens       4462
2025-03-30 16:47:31,371 - root.base_generator - INFO - Iteration 24: Successful attempt achieved.
2025-03-30 16:47:31,371 - root.base_generator - INFO - Iteration 24 finished.
2025-03-30 16:47:31,372 - root.base_generator - INFO -  Iteration 25 started.
2025-03-30 16:47:31,372 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 25) ---
2025-03-30 16:47:31,372 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:47:31,372 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:47:31,372 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:47:31,372 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:47:31,372 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:47:31,373 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:47:38,803 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:47:38,807 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:47:38,807 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:47:38,807 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1203, total_tokens=4552
2025-03-30 16:47:38,807 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:47:38,808 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:47:38,808 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:47:38,891 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:47:38,891 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:47:38,891 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:47:38,891 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:47:38,891 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:47:38,891 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:47:38,891 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:47:38,892 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:47:38,892 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:47:38,892 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:47:38,892 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:47:38,892 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:47:38,892 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:47:38,892 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:48:33,843 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.75s]
.Child process PID: 2625744, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2625788, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
F
=================================== FAILURES ===================================
__ TestFull.test_network_scanner_parameters[network_scanner_node0-expected0] ___

self = <test_scanner_node.TestFull object at 0x79eb74b38c40>
network_scanner_node = psutil.Process(pid=2625788, name='python3', status='sleeping', started='16:48:16')
network_status_client = (<rclpy.node.Node object at 0x79eb740fe410>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=...Time(sec=1743342506, nanosec=486162793), addresses=[network_scanner.msg.IPStatus(ip_address='8.8.8.8', status='UP')])])
expected = {'expected_interval': 3, 'expected_ip': ['8.8.8.8']}

    @pytest.mark.order(3)
    @pytest.mark.parametrize(
        "network_scanner_node,expected",
        [
            (
                {"network": "8.8.8.8", "scan_period": 3},
                {"expected_ip": ["8.8.8.8"], "expected_interval": 3},
            ),
            (
                {"network": "1.1.1.1, 8.8.4.4", "scan_period": 6},
                {"expected_ip": ["1.1.1.1", "8.8.4.4"], "expected_interval": 6},
            ),
        ],
        indirect=["network_scanner_node"],
    )
    def test_network_scanner_parameters(
        self, network_scanner_node, network_status_client, expected
    ):
        # Verify the node process is running
        assert network_scanner_node.is_running(), "Network scanner node is not running"

        client_node, received_msgs = network_status_client

        # Wait for at least 2 messages
        assert wait_for_messages(
            client_node, received_msgs, count=2, timeout=20
        ), f"Timeout waiting for messages. Received: {len(received_msgs)}"

        # Validate the content of the first two messages
        for msg in received_msgs[:2]:
            validate_message(msg, expected["expected_ip"])

        # Calculate the interval using ROS timestamps
        first_msg = received_msgs[0]
        second_msg = received_msgs[1]

        interval = (second_msg.stamp.sec - first_msg.stamp.sec) + (
            (second_msg.stamp.nanosec - first_msg.stamp.nanosec) * 1e-9
        )

        # Allow 1 second of tolerance for the interval check
>       assert (
            abs(interval - expected["expected_interval"]) < 1
        ), f"Interval {interval:.2f} sec, expected ~{expected['expected_interval']} sec"
E       AssertionError: Interval 5.99 sec, expected ~3 sec
E       assert 2.990184149 < 1
E        +  where 2.990184149 = abs((5.990184149 - 3))

src/network_scanner/test/test_scanner_node.py:179: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_network_scanner_parameters[network_scanner_node0-expected0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 2 passed in 27.69s

stderr:
Process 2625744 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2625788 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:48:33,844 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:48:33,845 - root.ros2_runner - INFO - Tests failed: 1, passed: 2, skipped: 0
2025-03-30 16:48:33,845 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:48:33,845 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:48:33,868 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       62.5
success            False
final_state        TEST
tests_passed       2
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1203
total_tokens       4552
2025-03-30 16:48:33,868 - root.base_generator - INFO - Iteration 25: Attempt 1 failed.
2025-03-30 16:48:33,868 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 25) ---
2025-03-30 16:48:33,868 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:48:33,868 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:48:33,869 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:48:33,869 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:48:33,869 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:48:33,869 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:48:40,864 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:48:40,868 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:48:40,868 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:48:40,869 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1130, total_tokens=4479
2025-03-30 16:48:40,869 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:48:40,869 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:48:40,869 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:48:40,948 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:48:40,948 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:48:40,948 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:48:40,948 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:48:40,948 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:48:40,948 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:48:40,949 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:48:40,949 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:48:40,949 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:48:40,949 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:48:40,949 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:48:40,949 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:48:40,949 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:48:40,949 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:50:41,671 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.72s]
.Child process PID: 2626236, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2626283, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2626382, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-295/test_no_overlapping_scans_netw0/nscan
Child process PID: 2626559, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-295/test_invalid_json_format_netwo0/nscan
Child process PID: 2626676, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-295/test_outdated_json_results_net0/nscan
Child process PID: 2626728, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.48s (0:01:33)

stderr:
Process 2626236 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2626283 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2626382 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2626502 no longer exists
Process 2626559 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2626728 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:50:41,671 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:50:41,672 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 16:50:41,672 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 16:50:41,672 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 16:50:41,694 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       127.8
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1130
total_tokens       4479
2025-03-30 16:50:41,694 - root.base_generator - INFO - Iteration 25: Successful attempt achieved.
2025-03-30 16:50:41,694 - root.base_generator - INFO - Iteration 25 finished.
2025-03-30 16:50:41,695 - root.base_generator - INFO -  Iteration 26 started.
2025-03-30 16:50:41,695 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 26) ---
2025-03-30 16:50:41,695 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:50:41,695 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:50:41,695 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:50:41,695 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:50:41,695 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:50:41,696 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:50:48,818 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:50:48,822 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:50:48,822 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:50:48,822 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1138, total_tokens=4487
2025-03-30 16:50:48,822 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:50:48,822 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:50:48,823 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:50:48,901 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:50:48,901 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:50:48,901 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:50:48,901 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:50:48,901 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:50:48,902 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:50:48,902 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:50:48,902 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:50:48,902 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:50:48,902 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:50:48,902 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:50:48,902 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:50:48,902 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:50:48,902 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:52:34,136 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.76s]
.Child process PID: 2627155, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2627211, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2627330, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-296/test_no_overlapping_scans_netw0/nscan
Child process PID: 2627504, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-296/test_invalid_json_format_netwo0/nscan
Child process PID: 2627609, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x79f9fb542d10>
network_scanner_node = psutil.Process(pid=2627609, name='python3', status='sleeping', started='16:52:27')
network_status_client = (<rclpy.node.Node object at 0x79f9f9da5e10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342749, nanosec=778491489), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x79f9f9da5e10>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342749, nanosec=778491489), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.95s (0:01:17)

stderr:
Process 2627155 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2627211 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2627330 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2627427 no longer exists
Process 2627504 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 16:52:34,136 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:52:34,137 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:52:34,137 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:52:34,137 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:52:34,160 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1138
total_tokens       4487
2025-03-30 16:52:34,160 - root.base_generator - INFO - Iteration 26: Attempt 1 failed.
2025-03-30 16:52:34,160 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 26) ---
2025-03-30 16:52:34,161 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:52:34,161 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:52:34,161 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:52:34,161 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:52:34,161 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:52:34,161 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:52:41,078 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:52:41,082 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:52:41,082 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:52:41,082 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1126, total_tokens=4475
2025-03-30 16:52:41,082 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:52:41,083 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:52:41,083 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:52:41,163 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:52:41,163 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:52:41,163 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:52:41,164 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:52:41,164 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:52:41,164 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:52:41,164 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:52:41,164 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:52:41,164 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:52:41,164 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:52:41,164 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:52:41,164 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:52:41,165 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:52:41,165 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:54:12,185 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.76s]
.Child process PID: 2627901, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2627958, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2628076, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-297/test_no_overlapping_scans_netw0/nscan
Child process PID: 2628252, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-297/test_invalid_json_format_netwo0/nscan
Child process PID: 2628346, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x731adc73c640>
network_scanner_node = psutil.Process(pid=2628346, name='python3', status='sleeping', started='16:54:02')
network_status_client = (<rclpy.node.Node object at 0x731adc73c8e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342844, nanosec=755005164), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x731adc73c8e0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342844, nanosec=755005164), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.01s (0:01:21)

stderr:
Process 2627901 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2627958 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2628076 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2628183 no longer exists
Process 2628252 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2628346 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:54:12,185 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:54:12,186 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:54:12,186 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:54:12,186 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:54:12,209 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       98.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1126
total_tokens       4475
2025-03-30 16:54:12,209 - root.base_generator - INFO - Iteration 26: Attempt 2 failed.
2025-03-30 16:54:12,209 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 26) ---
2025-03-30 16:54:12,209 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:54:12,210 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:54:12,210 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:54:12,210 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:54:12,210 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:54:12,210 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:54:19,262 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:54:19,265 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:54:19,266 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:54:19,266 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1151, total_tokens=4500
2025-03-30 16:54:19,266 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:54:19,266 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:54:19,266 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:54:19,346 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:54:19,346 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:54:19,346 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:54:19,346 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:54:19,346 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:54:19,347 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:54:19,347 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:54:19,347 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:54:19,347 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:54:19,347 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:54:19,347 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:54:19,347 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:54:19,347 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:54:19,347 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:56:07,640 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2628767, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2628813, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2628916, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-298/test_no_overlapping_scans_netw0/nscan
Child process PID: 2629095, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-298/test_invalid_json_format_netwo0/nscan
Child process PID: 2629211, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7a8e894ded10>
network_scanner_node = psutil.Process(pid=2629211, name='python3', status='sleeping', started='16:55:57')
network_status_client = (<rclpy.node.Node object at 0x7a8e894dc940>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342960, nanosec=192206615), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7a8e894dc940>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743342960, nanosec=192206615), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2628767 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2628813 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2628916 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2629023 no longer exists
Process 2629095 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2629211 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:56:07,640 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:56:07,641 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:56:07,642 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:56:07,642 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:56:07,663 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1151
total_tokens       4500
2025-03-30 16:56:07,663 - root.base_generator - INFO - Iteration 26: Attempt 3 failed.
2025-03-30 16:56:07,664 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 26) ---
2025-03-30 16:56:07,664 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:56:07,664 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:56:07,664 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:56:07,664 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:56:07,664 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:56:07,664 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:56:14,838 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:56:14,842 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:56:14,842 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:56:14,842 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1143, total_tokens=4492
2025-03-30 16:56:14,842 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:56:14,842 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:56:14,842 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:56:14,926 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:56:14,926 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:56:14,926 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:56:14,927 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:56:14,927 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:56:14,927 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:56:14,927 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:56:14,927 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:56:14,927 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:56:14,927 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:56:14,927 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:56:14,927 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:56:14,927 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:56:14,928 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:57:42,625 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.80s]
.Child process PID: 2629500, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2629558, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2629673, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-299/test_no_overlapping_scans_netw0/nscan
Child process PID: 2629852, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-299/test_invalid_json_format_netwo0/nscan
Child process PID: 2629956, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x731c741e8580>
network_scanner_node = psutil.Process(pid=2629956, name='python3', status='sleeping', started='16:57:32')
network_status_client = (<rclpy.node.Node object at 0x731c732d1f90>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343055, nanosec=180002208), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x731c732d1f90>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343055, nanosec=180002208), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2629500 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2629558 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2629673 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2629776 no longer exists
Process 2629852 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2629956 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:57:42,625 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:57:42,626 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:57:42,627 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:57:42,627 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:57:42,650 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1143
total_tokens       4492
2025-03-30 16:57:42,650 - root.base_generator - INFO - Iteration 26: Attempt 4 failed.
2025-03-30 16:57:42,650 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 26) ---
2025-03-30 16:57:42,650 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:57:42,651 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:57:42,651 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:57:42,651 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:57:42,651 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:57:42,651 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:57:50,740 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:57:50,743 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:57:50,744 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:57:50,744 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1312, total_tokens=4661
2025-03-30 16:57:50,744 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:57:50,744 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:57:50,744 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:57:50,832 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:57:50,832 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:57:50,832 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:57:50,832 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:57:50,832 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:57:50,832 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:57:50,832 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:57:50,832 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:57:50,833 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:57:50,833 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:57:50,833 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:57:50,833 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:57:50,833 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:57:50,833 - root.ros2_runner - INFO - Running tests...
2025-03-30 16:59:39,128 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2630381, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2630423, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2630530, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-300/test_no_overlapping_scans_netw0/nscan
Child process PID: 2630708, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-300/test_invalid_json_format_netwo0/nscan
Child process PID: 2630816, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7141902db310>
network_scanner_node = psutil.Process(pid=2630816, name='python3', status='sleeping', started='16:59:29')
network_status_client = (<rclpy.node.Node object at 0x7141902daa70>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343171, nanosec=675442265), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7141902daa70>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343171, nanosec=675442265), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2630381 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2630423 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2630530 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2630638 no longer exists
Process 2630708 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2630816 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 16:59:39,129 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 16:59:39,130 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 16:59:39,130 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 16:59:39,130 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 16:59:39,153 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       116.5
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1312
total_tokens       4661
2025-03-30 16:59:39,153 - root.base_generator - INFO - Iteration 26: Attempt 5 failed.
2025-03-30 16:59:39,153 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 26) ---
2025-03-30 16:59:39,153 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 16:59:39,153 - root.generation_attempt - INFO - Initializing...
2025-03-30 16:59:39,153 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 16:59:39,154 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 16:59:39,154 - root.generation_attempt - INFO - Generating code...
2025-03-30 16:59:39,154 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 16:59:46,244 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 16:59:46,248 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 16:59:46,248 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 16:59:46,248 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1145, total_tokens=4494
2025-03-30 16:59:46,248 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 16:59:46,248 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 16:59:46,248 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 16:59:46,327 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 16:59:46,327 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 16:59:46,327 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 16:59:46,328 - root.generation_attempt - INFO - Saving code...
2025-03-30 16:59:46,328 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 16:59:46,328 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 16:59:46,328 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 16:59:46,328 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 16:59:46,328 - root.generation_attempt - INFO - Running tests...
2025-03-30 16:59:46,328 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 16:59:46,328 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 16:59:46,328 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 16:59:46,329 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 16:59:46,329 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:01:18,045 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2631115, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2631162, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2631288, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-301/test_no_overlapping_scans_netw0/nscan
Child process PID: 2631468, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-301/test_invalid_json_format_netwo0/nscan
Child process PID: 2631560, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7d7fb6044580>
network_scanner_node = psutil.Process(pid=2631560, name='python3', status='sleeping', started='17:01:03')
network_status_client = (<rclpy.node.Node object at 0x7d7fb50f9c60>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 84.97s (0:01:24)

stderr:
Process 2631115 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2631162 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2631288 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2631390 no longer exists
Process 2631468 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2631560 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:01:18,045 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:01:18,046 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:01:18,046 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:01:18,046 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:01:18,069 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       98.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1145
total_tokens       4494
2025-03-30 17:01:18,069 - root.base_generator - INFO - Iteration 26: Attempt 6 failed.
2025-03-30 17:01:18,070 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 26) ---
2025-03-30 17:01:18,070 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:01:18,070 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:01:18,070 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:01:18,070 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:01:18,070 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:01:18,070 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:01:25,664 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:01:25,668 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:01:25,668 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:01:25,668 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1156, total_tokens=4505
2025-03-30 17:01:25,668 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:01:25,669 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:01:25,669 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:01:25,749 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:01:25,749 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:01:25,749 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:01:25,749 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:01:25,749 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:01:25,749 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:01:25,749 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:01:25,749 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:01:25,750 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:01:25,750 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:01:25,750 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:01:25,750 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:01:25,750 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:01:25,750 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:03:18,027 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.75s]
.Child process PID: 2632005, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2632052, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2632174, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-302/test_no_overlapping_scans_netw0/nscan
Child process PID: 2632341, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-302/test_invalid_json_format_netwo0/nscan
Child process PID: 2632449, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e9db2be8580>
network_scanner_node = psutil.Process(pid=2632449, name='python3', status='sleeping', started='17:03:03')
network_status_client = (<rclpy.node.Node object at 0x7e9db1cd1e40>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.03s (0:01:25)

stderr:
Process 2632005 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2632052 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2632174 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2632271 no longer exists
Process 2632341 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2632449 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:03:18,028 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:03:18,028 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:03:18,029 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:03:18,029 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:03:18,052 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       120.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1156
total_tokens       4505
2025-03-30 17:03:18,052 - root.base_generator - INFO - Iteration 26: Attempt 7 failed.
2025-03-30 17:03:18,052 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 26) ---
2025-03-30 17:03:18,053 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:03:18,053 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:03:18,053 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:03:18,053 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:03:18,053 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:03:18,053 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:03:24,918 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:03:24,922 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:03:24,922 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:03:24,922 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1115, total_tokens=4464
2025-03-30 17:03:24,922 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:03:24,922 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:03:24,923 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:03:25,007 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:03:25,007 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:03:25,007 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:03:25,007 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:03:25,008 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:03:25,008 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:03:25,008 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:03:25,008 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:03:25,008 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:03:25,008 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:03:25,008 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:03:25,008 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:03:25,009 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:03:25,009 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:04:53,048 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.79s]
.Child process PID: 2632741, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2632800, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2632916, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-303/test_no_overlapping_scans_netw0/nscan
Child process PID: 2633104, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-303/test_invalid_json_format_netwo0/nscan
Child process PID: 2633194, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ecaffa38fd0>
network_scanner_node = psutil.Process(pid=2633194, name='python3', status='sleeping', started='17:04:38')
network_status_client = (<rclpy.node.Node object at 0x7ecafe355d50>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.05s (0:01:25)

stderr:
Process 2632741 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2632800 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2632916 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2633014 no longer exists
Process 2633104 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2633194 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:04:53,048 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:04:53,048 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:04:53,048 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:04:53,049 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:04:53,063 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1115
total_tokens       4464
2025-03-30 17:04:53,063 - root.base_generator - INFO - Iteration 26: Attempt 8 failed.
2025-03-30 17:04:53,063 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 26) ---
2025-03-30 17:04:53,063 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:04:53,064 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:04:53,064 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:04:53,064 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:04:53,064 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:04:53,064 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:05:00,484 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:05:00,488 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:05:00,488 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:05:00,488 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1228, total_tokens=4577
2025-03-30 17:05:00,489 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:05:00,489 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:05:00,489 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:05:00,569 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:05:00,570 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:05:00,570 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:05:00,570 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:05:00,570 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:05:00,570 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:05:00,570 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:05:00,570 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:05:00,570 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:05:00,571 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:05:00,571 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:05:00,571 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:05:00,571 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:05:00,571 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:06:48,869 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.74s]
.Child process PID: 2633626, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2633685, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2633803, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-304/test_no_overlapping_scans_netw0/nscan
Child process PID: 2633985, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-304/test_invalid_json_format_netwo0/nscan
Child process PID: 2634081, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x71a86a043310>
network_scanner_node = psutil.Process(pid=2634081, name='python3', status='sleeping', started='17:06:38')
network_status_client = (<rclpy.node.Node object at 0x71a8690fdc90>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343601, nanosec=439261349), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x71a8690fdc90>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343601, nanosec=439261349), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2633626 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2633685 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2633803 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2633899 no longer exists
Process 2633985 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2634081 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:06:48,869 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:06:48,870 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:06:48,870 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:06:48,870 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:06:48,894 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1228
total_tokens       4577
2025-03-30 17:06:48,894 - root.base_generator - INFO - Iteration 26: Attempt 9 failed.
2025-03-30 17:06:48,894 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 26) ---
2025-03-30 17:06:48,894 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:06:48,895 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:06:48,895 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:06:48,895 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:06:48,895 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:06:48,895 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:06:55,927 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:06:55,931 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:06:55,931 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:06:55,931 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1119, total_tokens=4468
2025-03-30 17:06:55,931 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:06:55,932 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:06:55,932 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:06:56,012 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:06:56,012 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:06:56,012 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:06:56,012 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:06:56,013 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:06:56,013 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:06:56,013 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:06:56,013 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:06:56,013 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:06:56,013 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:06:56,013 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:06:56,013 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:06:56,014 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:06:56,014 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:08:38,310 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2634368, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2634425, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2634542, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-305/test_no_overlapping_scans_netw0/nscan
Child process PID: 2634732, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-305/test_invalid_json_format_netwo0/nscan
Child process PID: 2634825, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-305/test_outdated_json_results_net0/nscan
Child process PID: 2634916, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.48s (0:01:35)

stderr:
Process 2634368 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2634425 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2634542 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2634666 no longer exists
Process 2634732 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2634916 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:08:38,310 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:08:38,311 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 17:08:38,311 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 17:08:38,311 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 17:08:38,325 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       109.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1119
total_tokens       4468
2025-03-30 17:08:38,326 - root.base_generator - INFO - Iteration 26: Successful attempt achieved.
2025-03-30 17:08:38,326 - root.base_generator - INFO - Iteration 26 finished.
2025-03-30 17:08:38,326 - root.base_generator - INFO -  Iteration 27 started.
2025-03-30 17:08:38,326 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 27) ---
2025-03-30 17:08:38,326 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:08:38,326 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:08:38,326 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:08:38,326 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:08:38,326 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:08:38,326 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:08:45,215 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:08:45,219 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:08:45,219 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:08:45,219 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1151, total_tokens=4500
2025-03-30 17:08:45,219 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:08:45,219 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:08:45,219 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:08:45,297 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:08:45,297 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:08:45,297 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:08:45,297 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:08:45,298 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:08:45,298 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:08:45,298 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:08:45,298 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:08:45,298 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:08:45,298 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:08:45,298 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:08:45,298 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:08:45,298 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:08:45,298 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:10:37,717 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.79s]
.Child process PID: 2635393, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2635480, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2635558, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-306/test_no_overlapping_scans_netw0/nscan
Child process PID: 2635740, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-306/test_invalid_json_format_netwo0/nscan
Child process PID: 2635874, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7a972724ed10>
network_scanner_node = psutil.Process(pid=2635874, name='python3', status='sleeping', started='17:10:23')
network_status_client = (<rclpy.node.Node object at 0x7a972724c700>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.08s (0:01:25)

stderr:
Process 2635393 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2635480 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2635558 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2635697 no longer exists
Process 2635740 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2635874 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:10:37,718 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:10:37,718 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:10:37,719 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:10:37,719 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:10:37,742 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1151
total_tokens       4500
2025-03-30 17:10:37,742 - root.base_generator - INFO - Iteration 27: Attempt 1 failed.
2025-03-30 17:10:37,742 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 27) ---
2025-03-30 17:10:37,743 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:10:37,743 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:10:37,743 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:10:37,743 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:10:37,743 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:10:37,743 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:10:44,910 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:10:44,914 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:10:44,914 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:10:44,914 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1145, total_tokens=4494
2025-03-30 17:10:44,914 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:10:44,915 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:10:44,915 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:10:45,471 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:10:45,471 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:10:45,471 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:10:45,471 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:10:45,471 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:10:45,472 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:10:45,472 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:10:45,472 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:10:45,472 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:10:45,472 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:10:45,472 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:10:45,472 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:10:45,472 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:10:45,472 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:12:30,733 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.75s]
.Child process PID: 2636273, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2636360, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2636444, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-307/test_no_overlapping_scans_netw0/nscan
Child process PID: 2636625, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-307/test_invalid_json_format_netwo0/nscan
Child process PID: 2636756, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e87d5443310>
network_scanner_node = psutil.Process(pid=2636756, name='python3', status='sleeping', started='17:12:23')
network_status_client = (<rclpy.node.Node object at 0x7e87d44fd930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343946, nanosec=391319389), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7e87d44fd930>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743343946, nanosec=391319389), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 78.00s (0:01:18)

stderr:
Process 2636273 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2636360 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2636444 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2636577 no longer exists
Process 2636625 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 17:12:30,733 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:12:30,734 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:12:30,735 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:12:30,735 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:12:30,759 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       113.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1145
total_tokens       4494
2025-03-30 17:12:30,759 - root.base_generator - INFO - Iteration 27: Attempt 2 failed.
2025-03-30 17:12:30,759 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 27) ---
2025-03-30 17:12:30,759 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:12:30,759 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:12:30,759 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:12:30,760 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:12:30,760 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:12:30,760 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:12:38,308 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:12:38,311 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:12:38,311 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:12:38,311 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1216, total_tokens=4565
2025-03-30 17:12:38,312 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:12:38,312 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:12:38,312 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:12:38,393 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:12:38,393 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:12:38,393 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:12:38,393 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:12:38,393 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:12:38,393 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:12:38,394 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:12:38,394 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:12:38,394 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:12:38,394 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:12:38,394 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:12:38,394 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:12:38,394 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:12:38,394 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:14:21,256 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.75s]
.Child process PID: 2637040, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2637113, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2637191, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-308/test_no_overlapping_scans_netw0/nscan
Child process PID: 2637371, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-308/test_invalid_json_format_netwo0/nscan
Child process PID: 2637506, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-308/test_outdated_json_results_net0/nscan
Child process PID: 2637549, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.51s (0:01:33)

stderr:
Process 2637040 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2637113 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2637191 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2637320 no longer exists
Process 2637371 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2637549 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:14:21,256 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:14:21,257 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 17:14:21,257 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 17:14:21,257 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 17:14:21,281 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       110.5
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1216
total_tokens       4565
2025-03-30 17:14:21,281 - root.base_generator - INFO - Iteration 27: Successful attempt achieved.
2025-03-30 17:14:21,281 - root.base_generator - INFO - Iteration 27 finished.
2025-03-30 17:14:21,281 - root.base_generator - INFO -  Iteration 28 started.
2025-03-30 17:14:21,282 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 28) ---
2025-03-30 17:14:21,282 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:14:21,282 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:14:21,282 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:14:21,282 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:14:21,282 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:14:21,282 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:14:28,503 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:14:28,507 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:14:28,507 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:14:28,507 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1190, total_tokens=4539
2025-03-30 17:14:28,507 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:14:28,508 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:14:28,508 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:14:28,588 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:14:28,588 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:14:28,588 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:14:28,588 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:14:28,588 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:14:28,588 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:14:28,589 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:14:28,589 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:14:28,589 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:14:28,589 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:14:28,589 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:14:28,589 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:14:28,589 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:14:28,589 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:16:16,872 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.56s]

Summary: 1 package finished [0.73s]
.Child process PID: 2637994, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2638034, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2638133, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-309/test_no_overlapping_scans_netw0/nscan
Child process PID: 2638311, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-309/test_invalid_json_format_netwo0/nscan
Child process PID: 2638426, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x775e59794e80>
network_scanner_node = psutil.Process(pid=2638426, name='python3', status='sleeping', started='17:16:06')
network_status_client = (<rclpy.node.Node object at 0x775e58177250>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743344169, nanosec=433948828), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x775e58177250>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743344169, nanosec=433948828), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2637994 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2638034 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2638133 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2638261 no longer exists
Process 2638311 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2638426 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:16:16,872 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:16:16,873 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:16:16,873 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:16:16,873 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:16:16,897 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1190
total_tokens       4539
2025-03-30 17:16:16,897 - root.base_generator - INFO - Iteration 28: Attempt 1 failed.
2025-03-30 17:16:16,897 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 28) ---
2025-03-30 17:16:16,897 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:16:16,897 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:16:16,897 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:16:16,898 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:16:16,898 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:16:16,898 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:16:24,095 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:16:24,099 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:16:24,099 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:16:24,099 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1145, total_tokens=4494
2025-03-30 17:16:24,099 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:16:24,100 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:16:24,100 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:16:24,178 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:16:24,178 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:16:24,178 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:16:24,178 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:16:24,179 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:16:24,179 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:16:24,179 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:16:24,179 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:16:24,179 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:16:24,179 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:16:24,179 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:16:24,179 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:16:24,179 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:16:24,179 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:17:55,877 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.78s]
.Child process PID: 2638734, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2638779, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2638895, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-310/test_no_overlapping_scans_netw0/nscan
Child process PID: 2639065, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-310/test_invalid_json_format_netwo0/nscan
Child process PID: 2639181, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7600d9cd8670>
network_scanner_node = psutil.Process(pid=2639181, name='python3', status='sleeping', started='17:17:41')
network_status_client = (<rclpy.node.Node object at 0x7600d85a1e40>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.06s (0:01:25)

stderr:
Process 2638734 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2638779 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2638895 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2638995 no longer exists
Process 2639065 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2639181 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:17:55,878 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:17:55,878 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:17:55,879 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:17:55,879 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:17:55,902 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       99.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1145
total_tokens       4494
2025-03-30 17:17:55,903 - root.base_generator - INFO - Iteration 28: Attempt 2 failed.
2025-03-30 17:17:55,903 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 28) ---
2025-03-30 17:17:55,903 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:17:55,903 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:17:55,903 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:17:55,903 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:17:55,903 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:17:55,904 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:17:59,123 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:17:59,126 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:17:59,127 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:17:59,127 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=486, total_tokens=3835
2025-03-30 17:17:59,127 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:17:59,127 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:17:59,127 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:17:59,127 - root.code_parser - WARNING - No valid '```python' code markers found in response
2025-03-30 17:17:59,128 - root.generation_attempt - ERROR - Exception on stage PARSE:

Parsing failed, no code returned.

2025-03-30 17:17:59,128 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: FAILURE
2025-03-30 17:17:59,152 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       3.2
success            False
final_state        PARSE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  486
total_tokens       3835
2025-03-30 17:17:59,152 - root.base_generator - INFO - Iteration 28: Attempt 3 failed.
2025-03-30 17:17:59,152 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 28) ---
2025-03-30 17:17:59,152 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:17:59,152 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:17:59,152 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:17:59,153 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:17:59,153 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:17:59,153 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:32:59,281 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 504 Gateway Timeout"
2025-03-30 17:32:59,282 - root.generation_attempt - ERROR - Exception on stage GENERATE:

API error: API error occurred: Status 504
{
  "message":"The upstream server is timing out",
  "request_id":"7258012e73c38c415810a33c89a21215"
}

2025-03-30 17:32:59,282 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: FAILURE
2025-03-30 17:32:59,305 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  --------
attempt_time       900.1
success            False
final_state        GENERATE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      0
completion_tokens  0
total_tokens       0
2025-03-30 17:32:59,305 - root.base_generator - INFO - Iteration 28: Attempt 4 failed.
2025-03-30 17:32:59,305 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 28) ---
2025-03-30 17:32:59,306 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:32:59,306 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:32:59,306 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:32:59,306 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:32:59,306 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:32:59,306 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:33:06,149 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:33:06,152 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:33:06,152 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:33:06,153 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1104, total_tokens=4453
2025-03-30 17:33:06,153 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:33:06,153 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:33:06,153 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:33:06,233 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:33:06,233 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:33:06,233 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:33:06,234 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:33:06,234 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:33:06,234 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:33:06,234 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:33:06,234 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:33:06,234 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:33:06,234 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:33:06,234 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:33:06,235 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:33:06,235 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:33:06,235 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:34:58,539 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.76s]
.Child process PID: 2644513, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2644566, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2644651, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-311/test_no_overlapping_scans_netw0/nscan
Child process PID: 2644828, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-311/test_invalid_json_format_netwo0/nscan
Child process PID: 2644960, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x76969033c640>
network_scanner_node = psutil.Process(pid=2644960, name='python3', status='sleeping', started='17:34:44')
network_status_client = (<rclpy.node.Node object at 0x76968eba1930>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.04s (0:01:25)

stderr:
Process 2644513 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2644566 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2644651 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2644783 no longer exists
Process 2644828 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2644960 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:34:58,539 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:34:58,540 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:34:58,540 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:34:58,540 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:34:58,563 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       119.2
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1104
total_tokens       4453
2025-03-30 17:34:58,563 - root.base_generator - INFO - Iteration 28: Attempt 5 failed.
2025-03-30 17:34:58,563 - root.base_generator - INFO - --- Starting Attempt 6 (Iteration 28) ---
2025-03-30 17:34:58,563 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:34:58,563 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:34:58,564 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:34:58,564 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:34:58,564 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:34:58,564 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:35:07,440 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:35:07,444 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:35:07,444 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:35:07,444 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1244, total_tokens=4593
2025-03-30 17:35:07,444 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:35:07,444 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:35:07,445 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:35:07,525 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:35:07,525 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:35:07,525 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:35:07,525 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:35:07,526 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:35:07,526 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:35:07,526 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:35:07,526 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:35:07,526 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:35:07,526 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:35:07,526 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:35:07,526 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:35:07,526 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:35:07,526 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:36:55,787 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.55s]

Summary: 1 package finished [0.71s]
.Child process PID: 2645401, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2645455, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2645540, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-312/test_no_overlapping_scans_netw0/nscan
Child process PID: 2645715, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-312/test_invalid_json_format_netwo0/nscan
Child process PID: 2645850, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x744f1f846d10>
network_scanner_node = psutil.Process(pid=2645850, name='python3', status='sleeping', started='17:36:45')
network_status_client = (<rclpy.node.Node object at 0x744f1e931ed0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345408, nanosec=346713026), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x744f1e931ed0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345408, nanosec=346713026), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2645401 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2645455 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2645540 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2645671 no longer exists
Process 2645715 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2645850 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:36:55,787 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:36:55,788 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:36:55,788 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:36:55,789 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:36:55,812 - root.base_generator - INFO - Attempt 6 finished with metrics:
metric             value
-----------------  -------
attempt_time       117.2
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1244
total_tokens       4593
2025-03-30 17:36:55,813 - root.base_generator - INFO - Iteration 28: Attempt 6 failed.
2025-03-30 17:36:55,813 - root.base_generator - INFO - --- Starting Attempt 7 (Iteration 28) ---
2025-03-30 17:36:55,813 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:36:55,813 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:36:55,813 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:36:55,813 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:36:55,814 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:36:55,814 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:37:04,947 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:37:04,950 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:37:04,951 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:37:04,951 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1211, total_tokens=4560
2025-03-30 17:37:04,951 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:37:04,951 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:37:04,951 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:37:05,029 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:37:05,029 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:37:05,029 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:37:05,029 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:37:05,030 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:37:05,030 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:37:05,030 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:37:05,030 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:37:05,030 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:37:05,030 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:37:05,030 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:37:05,030 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:37:05,030 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:37:05,030 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:38:30,780 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.79s]
.Child process PID: 2646150, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2646197, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2646296, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-313/test_no_overlapping_scans_netw0/nscan
Child process PID: 2646472, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-313/test_invalid_json_format_netwo0/nscan
Child process PID: 2646599, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x748de973ed10>
network_scanner_node = psutil.Process(pid=2646599, name='python3', status='sleeping', started='17:38:20')
network_status_client = (<rclpy.node.Node object at 0x748de7f9e080>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345503, nanosec=331272043), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x748de7f9e080>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345503, nanosec=331272043), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2646150 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2646197 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2646296 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2646421 no longer exists
Process 2646472 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2646599 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:38:30,781 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:38:30,782 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:38:30,782 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:38:30,782 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:38:30,806 - root.base_generator - INFO - Attempt 7 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1211
total_tokens       4560
2025-03-30 17:38:30,806 - root.base_generator - INFO - Iteration 28: Attempt 7 failed.
2025-03-30 17:38:30,806 - root.base_generator - INFO - --- Starting Attempt 8 (Iteration 28) ---
2025-03-30 17:38:30,807 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:38:30,807 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:38:30,807 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:38:30,807 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:38:30,807 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:38:30,807 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:38:37,929 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:38:37,932 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:38:37,933 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:38:37,933 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1119, total_tokens=4468
2025-03-30 17:38:37,933 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:38:37,933 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:38:37,933 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:38:38,014 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:38:38,015 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:38:38,015 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:38:38,016 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:38:38,016 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:38:38,016 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:40:26,371 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.79s]
.Child process PID: 2647080, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2647139, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2647218, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-314/test_no_overlapping_scans_netw0/nscan
Child process PID: 2647395, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-314/test_invalid_json_format_netwo0/nscan
Child process PID: 2647532, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x72bc663cd060>
network_scanner_node = psutil.Process(pid=2647532, name='python3', status='sleeping', started='17:40:16')
network_status_client = (<rclpy.node.Node object at 0x72bc64ba5d20>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345618, nanosec=928143108), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x72bc64ba5d20>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345618, nanosec=928143108), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2647080 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2647139 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2647218 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2647347 no longer exists
Process 2647395 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2647532 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:40:26,371 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:40:26,372 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:40:26,372 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:40:26,372 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:40:26,397 - root.base_generator - INFO - Attempt 8 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.6
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1119
total_tokens       4468
2025-03-30 17:40:26,397 - root.base_generator - INFO - Iteration 28: Attempt 8 failed.
2025-03-30 17:40:26,397 - root.base_generator - INFO - --- Starting Attempt 9 (Iteration 28) ---
2025-03-30 17:40:26,397 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:40:26,397 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:40:26,397 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:40:26,398 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:40:26,398 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:40:26,398 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:40:34,048 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:40:34,052 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:40:34,052 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:40:34,052 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1233, total_tokens=4582
2025-03-30 17:40:34,052 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:40:34,052 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:40:34,052 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:40:34,135 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:40:34,135 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:40:34,135 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:40:34,135 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:40:34,135 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:40:34,135 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:40:34,136 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:40:34,136 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:40:34,136 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:40:34,136 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:40:34,136 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:40:34,136 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:40:34,136 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:40:34,136 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:42:01,346 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.80s]
.Child process PID: 2647828, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2647871, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2647955, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-315/test_no_overlapping_scans_netw0/nscan
Child process PID: 2648141, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-315/test_invalid_json_format_netwo0/nscan
Child process PID: 2648271, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7ead9de39030>
network_scanner_node = psutil.Process(pid=2648271, name='python3', status='sleeping', started='17:41:51')
network_status_client = (<rclpy.node.Node object at 0x7ead9de3b400>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345713, nanosec=929247307), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7ead9de3b400>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345713, nanosec=929247307), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.03s (0:01:21)

stderr:
Process 2647828 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2647871 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2647955 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2648088 no longer exists
Process 2648141 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2648271 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:42:01,346 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:42:01,347 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:42:01,347 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:42:01,348 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:42:01,372 - root.base_generator - INFO - Attempt 9 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1233
total_tokens       4582
2025-03-30 17:42:01,372 - root.base_generator - INFO - Iteration 28: Attempt 9 failed.
2025-03-30 17:42:01,372 - root.base_generator - INFO - --- Starting Attempt 10 (Iteration 28) ---
2025-03-30 17:42:01,372 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:42:01,373 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:42:01,373 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:42:01,373 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:42:01,373 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:42:01,373 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:42:08,751 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:42:08,755 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:42:08,755 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:42:08,755 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1184, total_tokens=4533
2025-03-30 17:42:08,756 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:42:08,756 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:42:08,756 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:42:08,836 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:42:08,836 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:42:08,836 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:42:08,837 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:42:08,837 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:42:08,837 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:42:08,837 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:42:08,837 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:42:08,837 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:42:08,837 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:42:08,837 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:42:08,837 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:42:08,838 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:42:08,838 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:43:57,152 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.73s]
.Child process PID: 2648685, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2648744, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2648823, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-316/test_no_overlapping_scans_netw0/nscan
Child process PID: 2649011, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-316/test_invalid_json_format_netwo0/nscan
Child process PID: 2649142, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x77db7a0d9060>
network_scanner_node = psutil.Process(pid=2649142, name='python3', status='sleeping', started='17:43:47')
network_status_client = (<rclpy.node.Node object at 0x77db789a1990>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345829, nanosec=719599903), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x77db789a1990>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345829, nanosec=719599903), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.07s (0:01:21)

stderr:
Process 2648685 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2648744 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2648823 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2648960 no longer exists
Process 2649011 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2649142 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:43:57,152 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:43:57,153 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:43:57,153 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:43:57,153 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:43:57,178 - root.base_generator - INFO - Attempt 10 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.8
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1184
total_tokens       4533
2025-03-30 17:43:57,178 - root.base_generator - INFO - Iteration 28: Attempt 10 failed.
2025-03-30 17:43:57,178 - root.base_generator - INFO - --- Starting Attempt 11 (Iteration 28) ---
2025-03-30 17:43:57,178 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:43:57,178 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:43:57,178 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:43:57,179 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:43:57,179 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:43:57,179 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:44:04,078 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:44:04,082 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:44:04,082 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:44:04,082 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1123, total_tokens=4472
2025-03-30 17:44:04,082 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:44:04,083 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:44:04,083 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:44:04,163 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:44:04,163 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:44:04,163 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:44:04,163 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:44:04,164 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:44:04,164 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:44:04,164 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:44:04,164 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:44:04,164 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:44:04,164 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:44:04,164 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:44:04,164 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:44:04,164 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:44:04,164 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:45:29,115 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.58s]

Summary: 1 package finished [0.73s]
.Child process PID: 2649443, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2649484, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2649570, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-317/test_no_overlapping_scans_netw0/nscan
Child process PID: 2649757, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-317/test_invalid_json_format_netwo0/nscan
Child process PID: 2649881, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x77c56de44640>
network_scanner_node = psutil.Process(pid=2649881, name='python3', status='sleeping', started='17:45:22')
network_status_client = (<rclpy.node.Node object at 0x77c56de44bb0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345924, nanosec=758817254), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x77c56de44bb0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743345924, nanosec=758817254), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 78.03s (0:01:18)

stderr:
Process 2649443 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2649484 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2649570 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2649702 no longer exists
Process 2649757 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 17:45:29,115 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:45:29,116 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:45:29,116 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:45:29,117 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:45:29,141 - root.base_generator - INFO - Attempt 11 finished with metrics:
metric             value
-----------------  -------
attempt_time       91.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1123
total_tokens       4472
2025-03-30 17:45:29,141 - root.base_generator - INFO - Iteration 28: Attempt 11 failed.
2025-03-30 17:45:29,141 - root.base_generator - INFO - --- Starting Attempt 12 (Iteration 28) ---
2025-03-30 17:45:29,141 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:45:29,142 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:45:29,142 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:45:29,142 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:45:29,142 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:45:29,142 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:45:36,126 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:45:36,130 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:45:36,130 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:45:36,130 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1127, total_tokens=4476
2025-03-30 17:45:36,130 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:45:36,131 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:45:36,131 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:45:36,212 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:45:36,212 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:45:36,213 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:45:36,213 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:45:36,213 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:45:36,213 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:45:36,213 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:45:36,213 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:45:36,213 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:45:36,213 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:45:36,214 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:45:36,214 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:45:36,214 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:45:36,214 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:47:24,533 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2650256, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2650346, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2650425, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-318/test_no_overlapping_scans_netw0/nscan
Child process PID: 2650608, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-318/test_invalid_json_format_netwo0/nscan
Child process PID: 2650740, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x762e6ae42d10>
network_scanner_node = psutil.Process(pid=2650740, name='python3', status='sleeping', started='17:47:14')
network_status_client = (<rclpy.node.Node object at 0x762e6ae40910>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346037, nanosec=94687527), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x762e6ae40910>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346037, nanosec=94687527), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.00s (0:01:20)

stderr:
Process 2650256 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2650346 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2650425 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2650563 no longer exists
Process 2650608 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2650740 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:47:24,533 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:47:24,533 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:47:24,533 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:47:24,534 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:47:24,549 - root.base_generator - INFO - Attempt 12 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1127
total_tokens       4476
2025-03-30 17:47:24,549 - root.base_generator - INFO - Iteration 28: Attempt 12 failed.
2025-03-30 17:47:24,549 - root.base_generator - INFO - --- Starting Attempt 13 (Iteration 28) ---
2025-03-30 17:47:24,549 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:47:24,549 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:47:24,550 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:47:24,550 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:47:24,550 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:47:24,550 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:47:31,561 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:47:31,565 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:47:31,565 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:47:31,565 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1123, total_tokens=4472
2025-03-30 17:47:31,565 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:47:31,566 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:47:31,566 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:47:31,644 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:47:31,644 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:47:31,644 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:47:31,645 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:47:31,645 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:47:31,645 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:47:31,645 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:47:31,645 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:47:31,645 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:47:31,645 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:47:31,645 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:47:31,645 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:47:31,645 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:47:31,646 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:48:59,544 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2651022, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2651091, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2651165, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-319/test_no_overlapping_scans_netw0/nscan
Child process PID: 2651354, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-319/test_invalid_json_format_netwo0/nscan
Child process PID: 2651488, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x76d275fe4580>
network_scanner_node = psutil.Process(pid=2651488, name='python3', status='sleeping', started='17:48:49')
network_status_client = (<rclpy.node.Node object at 0x76d2750b1c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346132, nanosec=108081883), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x76d2750b1c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346132, nanosec=108081883), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2651022 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2651091 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2651165 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2651302 no longer exists
Process 2651354 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2651488 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:48:59,544 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:48:59,545 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:48:59,545 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:48:59,545 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:48:59,570 - root.base_generator - INFO - Attempt 13 finished with metrics:
metric             value
-----------------  -------
attempt_time       95.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1123
total_tokens       4472
2025-03-30 17:48:59,570 - root.base_generator - INFO - Iteration 28: Attempt 13 failed.
2025-03-30 17:48:59,570 - root.base_generator - INFO - --- Starting Attempt 14 (Iteration 28) ---
2025-03-30 17:48:59,570 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:48:59,570 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:48:59,571 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:48:59,571 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:48:59,571 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:48:59,571 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:49:06,883 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:49:06,887 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:49:06,887 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:49:06,887 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1127, total_tokens=4476
2025-03-30 17:49:06,887 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:49:06,888 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:49:06,888 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:49:06,968 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:49:06,968 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:49:06,968 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:49:06,968 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:49:06,968 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:49:06,968 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:49:06,968 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:49:06,969 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:49:06,969 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:49:06,969 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:49:06,969 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:49:06,969 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:49:06,969 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:49:06,969 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:50:55,260 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.74s]
.Child process PID: 2651865, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2651956, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2652027, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-320/test_no_overlapping_scans_netw0/nscan
Child process PID: 2652218, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-320/test_invalid_json_format_netwo0/nscan
Child process PID: 2652350, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7b63f1c48580>
network_scanner_node = psutil.Process(pid=2652350, name='python3', status='sleeping', started='17:50:45')
network_status_client = (<rclpy.node.Node object at 0x7b63f1c48ac0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346247, nanosec=821992578), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7b63f1c48ac0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346247, nanosec=821992578), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.05s (0:01:21)

stderr:
Process 2651865 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2651956 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2652027 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2652173 no longer exists
Process 2652218 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2652350 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:50:55,260 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:50:55,261 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:50:55,261 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:50:55,261 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:50:55,286 - root.base_generator - INFO - Attempt 14 finished with metrics:
metric             value
-----------------  -------
attempt_time       115.7
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1127
total_tokens       4476
2025-03-30 17:50:55,286 - root.base_generator - INFO - Iteration 28: Attempt 14 failed.
2025-03-30 17:50:55,286 - root.base_generator - INFO - --- Starting Attempt 15 (Iteration 28) ---
2025-03-30 17:50:55,286 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:50:55,286 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:50:55,287 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:50:55,287 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:50:55,287 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:50:55,287 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:51:02,888 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:51:02,892 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:51:02,892 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:51:02,892 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1228, total_tokens=4577
2025-03-30 17:51:02,892 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:51:02,892 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:51:02,892 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:51:02,976 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:51:02,976 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:51:02,976 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:51:02,976 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:51:02,976 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:51:02,976 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:51:02,976 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:51:02,976 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:51:02,977 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:51:02,977 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:51:02,977 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:51:02,977 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:51:02,977 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:51:02,977 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:52:30,232 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.79s]
.Child process PID: 2652609, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2652695, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2652769, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-321/test_no_overlapping_scans_netw0/nscan
Child process PID: 2652963, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-321/test_invalid_json_format_netwo0/nscan
Child process PID: 2653091, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7c263734ad10>
network_scanner_node = psutil.Process(pid=2653091, name='python3', status='sleeping', started='17:52:20')
network_status_client = (<rclpy.node.Node object at 0x7c2635ba9810>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346342, nanosec=794541419), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7c2635ba9810>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346342, nanosec=794541419), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.02s (0:01:21)

stderr:
Process 2652609 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2652695 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2652769 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2652912 no longer exists
Process 2652963 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2653091 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:52:30,233 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:52:30,234 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:52:30,234 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:52:30,234 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:52:30,259 - root.base_generator - INFO - Attempt 15 finished with metrics:
metric             value
-----------------  -------
attempt_time       94.9
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1228
total_tokens       4577
2025-03-30 17:52:30,259 - root.base_generator - INFO - Iteration 28: Attempt 15 failed.
2025-03-30 17:52:30,259 - root.base_generator - INFO - --- Starting Attempt 16 (Iteration 28) ---
2025-03-30 17:52:30,259 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:52:30,259 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:52:30,260 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:52:30,260 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:52:30,260 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:52:30,260 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:52:37,216 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:52:37,220 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:52:37,220 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:52:37,220 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1140, total_tokens=4489
2025-03-30 17:52:37,220 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:52:37,220 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:52:37,221 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:52:37,300 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:52:37,300 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:52:37,300 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:52:37,300 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:52:37,300 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:52:37,300 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:52:37,301 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:52:37,301 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:52:37,301 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:52:37,301 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:52:37,301 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:52:37,301 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:52:37,301 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:52:37,301 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:54:38,061 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.76s]
.Child process PID: 2653467, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2653554, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2653640, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-322/test_no_overlapping_scans_netw0/nscan
Child process PID: 2653822, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-322/test_invalid_json_format_netwo0/nscan
Child process PID: 2653943, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-322/test_outdated_json_results_net0/nscan
Child process PID: 2654008, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.47s (0:01:33)

stderr:
Process 2653467 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2653554 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2653640 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2653778 no longer exists
Process 2653822 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2654008 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:54:38,061 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:54:38,062 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 17:54:38,062 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 17:54:38,062 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 17:54:38,087 - root.base_generator - INFO - Attempt 16 finished with metrics:
metric             value
-----------------  -------
attempt_time       127.8
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1140
total_tokens       4489
2025-03-30 17:54:38,087 - root.base_generator - INFO - Iteration 28: Successful attempt achieved.
2025-03-30 17:54:38,087 - root.base_generator - INFO - Iteration 28 finished.
2025-03-30 17:54:38,088 - root.base_generator - INFO -  Iteration 29 started.
2025-03-30 17:54:38,088 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 29) ---
2025-03-30 17:54:38,088 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:54:38,088 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:54:38,088 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:54:38,088 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:54:38,088 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:54:38,089 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:54:44,801 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:54:44,804 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:54:44,804 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:54:44,804 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1080, total_tokens=4429
2025-03-30 17:54:44,804 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:54:44,804 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:54:44,805 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:54:44,879 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:54:44,879 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:54:44,879 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:54:44,879 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:54:44,880 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:54:44,880 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:54:44,880 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:54:44,880 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:54:44,880 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:54:44,880 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:54:44,880 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:54:44,880 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:54:44,880 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:54:44,880 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:56:30,177 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.61s]

Summary: 1 package finished [0.79s]
.Child process PID: 2654571, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2654663, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2654743, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-323/test_no_overlapping_scans_netw0/nscan
Child process PID: 2654924, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-323/test_invalid_json_format_netwo0/nscan
Child process PID: 2655058, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x733d73a3ed10>
network_scanner_node = psutil.Process(pid=2655058, name='python3', status='sleeping', started='17:56:23')
network_status_client = (<rclpy.node.Node object at 0x733d72369de0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346585, nanosec=780085275), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x733d72369de0>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346585, nanosec=780085275), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.99s (0:01:17)

stderr:
Process 2654571 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2654663 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2654743 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2654876 no longer exists
Process 2654924 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 17:56:30,177 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:56:30,178 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:56:30,178 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:56:30,179 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:56:30,203 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.1
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1080
total_tokens       4429
2025-03-30 17:56:30,203 - root.base_generator - INFO - Iteration 29: Attempt 1 failed.
2025-03-30 17:56:30,204 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 29) ---
2025-03-30 17:56:30,204 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:56:30,204 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:56:30,204 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:56:30,204 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:56:30,204 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:56:30,204 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:56:37,476 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:56:37,480 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:56:37,480 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:56:37,480 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1144, total_tokens=4493
2025-03-30 17:56:37,480 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:56:37,481 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:56:37,481 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:56:37,560 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:56:37,560 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:56:37,560 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:56:37,560 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:56:37,560 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:56:37,560 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:56:37,561 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:56:37,561 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:56:37,561 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:56:37,561 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:56:37,561 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:56:37,561 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:56:37,561 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:56:37,561 - root.ros2_runner - INFO - Running tests...
2025-03-30 17:58:12,211 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.60s]

Summary: 1 package finished [0.78s]
.Child process PID: 2655350, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2655410, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2655489, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-324/test_no_overlapping_scans_netw0/nscan
Child process PID: 2655667, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-324/test_invalid_json_format_netwo0/nscan
Child process PID: 2655807, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
Node process status: sleeping
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7dd315e40640>
network_scanner_node = psutil.Process(pid=2655807, name='python3', status='sleeping', started='17:57:58')
network_status_client = (<rclpy.node.Node object at 0x7dd315e40a90>, [])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
        assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."

        ros_node = network_scanner_node
>       with pytest.raises(psutil.NoSuchProcess):
E       Failed: DID NOT RAISE <class 'psutil.NoSuchProcess'>

src/network_scanner/test/test_scanner_node.py:301: Failed
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 85.02s (0:01:25)

stderr:
Process 2655350 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2655410 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2655489 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2655617 no longer exists
Process 2655667 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2655807 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 17:58:12,211 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 17:58:12,212 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 17:58:12,212 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 17:58:12,212 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 17:58:12,237 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       102.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1144
total_tokens       4493
2025-03-30 17:58:12,237 - root.base_generator - INFO - Iteration 29: Attempt 2 failed.
2025-03-30 17:58:12,237 - root.base_generator - INFO - --- Starting Attempt 3 (Iteration 29) ---
2025-03-30 17:58:12,237 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 17:58:12,237 - root.generation_attempt - INFO - Initializing...
2025-03-30 17:58:12,237 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 17:58:12,238 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 17:58:12,238 - root.generation_attempt - INFO - Generating code...
2025-03-30 17:58:12,238 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 17:58:19,287 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 17:58:19,291 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 17:58:19,291 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 17:58:19,291 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1144, total_tokens=4493
2025-03-30 17:58:19,291 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 17:58:19,291 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 17:58:19,291 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 17:58:19,371 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 17:58:19,371 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 17:58:19,371 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 17:58:19,371 - root.generation_attempt - INFO - Saving code...
2025-03-30 17:58:19,371 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 17:58:19,372 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 17:58:19,372 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 17:58:19,372 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 17:58:19,372 - root.generation_attempt - INFO - Running tests...
2025-03-30 17:58:19,372 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 17:58:19,372 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 17:58:19,372 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 17:58:19,372 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 17:58:19,372 - root.ros2_runner - INFO - Running tests...
2025-03-30 18:00:04,614 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.57s]

Summary: 1 package finished [0.75s]
.Child process PID: 2656211, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2656289, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2656364, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-325/test_no_overlapping_scans_netw0/nscan
Child process PID: 2656554, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-325/test_invalid_json_format_netwo0/nscan
Child process PID: 2656681, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7e4ef1942d10>
network_scanner_node = psutil.Process(pid=2656681, name='python3', status='sleeping', started='17:59:57')
network_status_client = (<rclpy.node.Node object at 0x7e4ef1940a00>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346800, nanosec=268984679), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7e4ef1940a00>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346800, nanosec=268984679), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 77.96s (0:01:17)

stderr:
Process 2656211 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2656289 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2656364 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2656503 no longer exists
Process 2656554 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children

2025-03-30 18:00:04,614 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 18:00:04,615 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 18:00:04,615 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 18:00:04,615 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 18:00:04,641 - root.base_generator - INFO - Attempt 3 finished with metrics:
metric             value
-----------------  -------
attempt_time       112.4
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1144
total_tokens       4493
2025-03-30 18:00:04,641 - root.base_generator - INFO - Iteration 29: Attempt 3 failed.
2025-03-30 18:00:04,641 - root.base_generator - INFO - --- Starting Attempt 4 (Iteration 29) ---
2025-03-30 18:00:04,641 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 18:00:04,641 - root.generation_attempt - INFO - Initializing...
2025-03-30 18:00:04,642 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 18:00:04,642 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 18:00:04,642 - root.generation_attempt - INFO - Generating code...
2025-03-30 18:00:04,642 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 18:00:12,072 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 18:00:12,076 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 18:00:12,076 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 18:00:12,076 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1196, total_tokens=4545
2025-03-30 18:00:12,076 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 18:00:12,076 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 18:00:12,077 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 18:00:12,156 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 18:00:12,156 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Saving code...
2025-03-30 18:00:12,157 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Running tests...
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 18:00:12,157 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 18:00:12,158 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 18:00:12,158 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 18:00:12,158 - root.ros2_runner - INFO - Running tests...
2025-03-30 18:01:42,657 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2656984, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2657029, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2657109, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-326/test_no_overlapping_scans_netw0/nscan
Child process PID: 2657298, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-326/test_invalid_json_format_netwo0/nscan
Child process PID: 2657420, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 1 messages:
Message 0:
F
=================================== FAILURES ===================================
___________ TestFull.test_invalid_json_format[network_scanner_node0] ___________

self = <test_scanner_node.TestFull object at 0x7c396f13f1f0>
network_scanner_node = psutil.Process(pid=2657420, name='python3', status='sleeping', started='18:01:32')
network_status_client = (<rclpy.node.Node object at 0x7c396d9a5c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346895, nanosec=208469764), addresses=[])])

    @pytest.mark.parametrize(
        "network_scanner_node",
        [
            {
                "network": "1.2.3.4",
                "scan_period": 2,
                "mock_nscan": True,
            },
        ],
        indirect=["network_scanner_node"],
    )
    def test_invalid_json_format(self, network_scanner_node, network_status_client):
        """
        Test that when the JSON file format isn't valid.
        """
        # Expected path for the JSON file produced by nscan
        json_file_path = "/tmp/nscan_results.json"
        if os.path.exists(json_file_path):
            os.remove(json_file_path)

        with open(json_file_path, "w") as f:
            f.buffer.write(b"{malformed json content")

        client_node, received_msgs = network_status_client
        # timeout 4 to wait for process shuts down
>       assert not wait_for_messages(
            client_node, received_msgs, count=1, timeout=4
        ), "Expected no messages, but received one."
E       AssertionError: Expected no messages, but received one.
E       assert not True
E        +  where True = wait_for_messages(<rclpy.node.Node object at 0x7c396d9a5c60>, [network_scanner.msg.NetworkStatus(stamp=builtin_interfaces.msg.Time(sec=1743346895, nanosec=208469764), addresses=[])], count=1, timeout=4)

src/network_scanner/test/test_scanner_node.py:296: AssertionError
=========================== short test summary info ============================
FAILED src/network_scanner/test/test_scanner_node.py::TestFull::test_invalid_json_format[network_scanner_node0]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed, 7 passed in 81.04s (0:01:21)

stderr:
Process 2656984 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2657029 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2657109 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2657244 no longer exists
Process 2657298 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2657420 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 18:01:42,658 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 18:01:42,659 - root.ros2_runner - INFO - Tests failed: 1, passed: 7, skipped: 0
2025-03-30 18:01:42,659 - root.generation_attempt - WARNING - Tests failed.
2025-03-30 18:01:42,659 - root.generation_attempt - INFO - Exiting state: TEST -> New state: FAILURE
2025-03-30 18:01:42,684 - root.base_generator - INFO - Attempt 4 finished with metrics:
metric             value
-----------------  -------
attempt_time       98.0
success            False
final_state        TEST
tests_passed       7
tests_failed       1
tests_skipped      0
prompt_tokens      3349
completion_tokens  1196
total_tokens       4545
2025-03-30 18:01:42,684 - root.base_generator - INFO - Iteration 29: Attempt 4 failed.
2025-03-30 18:01:42,684 - root.base_generator - INFO - --- Starting Attempt 5 (Iteration 29) ---
2025-03-30 18:01:42,684 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 18:01:42,684 - root.generation_attempt - INFO - Initializing...
2025-03-30 18:01:42,685 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 18:01:42,685 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 18:01:42,685 - root.generation_attempt - INFO - Generating code...
2025-03-30 18:01:42,685 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 18:01:51,198 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 18:01:51,201 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 18:01:51,201 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 18:01:51,202 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1210, total_tokens=4559
2025-03-30 18:01:51,202 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 18:01:51,202 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 18:01:51,202 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 18:01:51,284 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 18:01:51,284 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 18:01:51,284 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 18:01:51,284 - root.generation_attempt - INFO - Saving code...
2025-03-30 18:01:51,284 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 18:01:51,284 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 18:01:51,284 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 18:01:51,284 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 18:01:51,285 - root.generation_attempt - INFO - Running tests...
2025-03-30 18:01:51,285 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 18:01:51,285 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 18:01:51,285 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 18:01:51,285 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 18:01:51,285 - root.ros2_runner - INFO - Running tests...
2025-03-30 18:03:52,081 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.62s]

Summary: 1 package finished [0.78s]
.Child process PID: 2657825, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2657904, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2657980, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-327/test_no_overlapping_scans_netw0/nscan
Child process PID: 2658170, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-327/test_invalid_json_format_netwo0/nscan
Child process PID: 2658300, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-327/test_outdated_json_results_net0/nscan
Child process PID: 2658359, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 93.50s (0:01:33)

stderr:
Process 2657825 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2657904 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2657980 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2658119 no longer exists
Process 2658170 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2658359 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 18:03:52,082 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 18:03:52,082 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 18:03:52,082 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 18:03:52,083 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 18:03:52,108 - root.base_generator - INFO - Attempt 5 finished with metrics:
metric             value
-----------------  -------
attempt_time       129.4
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1210
total_tokens       4559
2025-03-30 18:03:52,108 - root.base_generator - INFO - Iteration 29: Successful attempt achieved.
2025-03-30 18:03:52,108 - root.base_generator - INFO - Iteration 29 finished.
2025-03-30 18:03:52,109 - root.base_generator - INFO -  Iteration 30 started.
2025-03-30 18:03:52,109 - root.base_generator - INFO - --- Starting Attempt 1 (Iteration 30) ---
2025-03-30 18:03:52,109 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 18:03:52,109 - root.generation_attempt - INFO - Initializing...
2025-03-30 18:03:52,109 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 18:03:52,109 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 18:03:52,110 - root.generation_attempt - INFO - Generating code...
2025-03-30 18:03:52,110 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 18:03:55,492 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 18:03:55,495 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 18:03:55,495 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 18:03:55,495 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=511, total_tokens=3860
2025-03-30 18:03:55,496 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 18:03:55,496 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 18:03:55,496 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 18:03:55,496 - root.code_parser - WARNING - No valid '```python' code markers found in response
2025-03-30 18:03:55,496 - root.generation_attempt - ERROR - Exception on stage PARSE:

Parsing failed, no code returned.

2025-03-30 18:03:55,496 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: FAILURE
2025-03-30 18:03:55,521 - root.base_generator - INFO - Attempt 1 finished with metrics:
metric             value
-----------------  -------
attempt_time       3.4
success            False
final_state        PARSE
tests_passed       0
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  511
total_tokens       3860
2025-03-30 18:03:55,521 - root.base_generator - INFO - Iteration 30: Attempt 1 failed.
2025-03-30 18:03:55,521 - root.base_generator - INFO - --- Starting Attempt 2 (Iteration 30) ---
2025-03-30 18:03:55,522 - root.generation_attempt - INFO - Entering state: INITIALIZE
2025-03-30 18:03:55,522 - root.generation_attempt - INFO - Initializing...
2025-03-30 18:03:55,522 - root.generation_attempt - INFO - Exiting state: INITIALIZE -> New state: GENERATE
2025-03-30 18:03:55,522 - root.generation_attempt - INFO - Entering state: GENERATE
2025-03-30 18:03:55,522 - root.generation_attempt - INFO - Generating code...
2025-03-30 18:03:55,522 - root.mistral_client - INFO - Start generating completion from Mistral AI
2025-03-30 18:04:03,282 - httpx - INFO - HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 18:04:03,286 - root.mistral_client - INFO - Completion generated successfully
2025-03-30 18:04:03,286 - root.generation_attempt - INFO - Code generated successfully.
2025-03-30 18:04:03,286 - root.generation_attempt - INFO - Model usage: prompt_tokens=3349, completion_tokens=1118, total_tokens=4467
2025-03-30 18:04:03,286 - root.generation_attempt - INFO - Exiting state: GENERATE -> New state: PARSE
2025-03-30 18:04:03,286 - root.generation_attempt - INFO - Entering state: PARSE
2025-03-30 18:04:03,286 - root.generation_attempt - INFO - Parsing generated code...
2025-03-30 18:04:03,360 - root.generation_attempt - INFO - Parsing succeeded.
2025-03-30 18:04:03,360 - root.generation_attempt - INFO - Exiting state: PARSE -> New state: SAVE
2025-03-30 18:04:03,360 - root.generation_attempt - INFO - Entering state: SAVE
2025-03-30 18:04:03,360 - root.generation_attempt - INFO - Saving code...
2025-03-30 18:04:03,360 - root.file_io - INFO - Code successfully saved and made executable: src/network_scanner/network_scanner/scanner_node.py
2025-03-30 18:04:03,360 - root.generation_attempt - INFO - Code saved successfully.
2025-03-30 18:04:03,360 - root.generation_attempt - INFO - Exiting state: SAVE -> New state: TEST
2025-03-30 18:04:03,360 - root.generation_attempt - INFO - Entering state: TEST
2025-03-30 18:04:03,361 - root.generation_attempt - INFO - Running tests...
2025-03-30 18:04:03,361 - root.generation_attempt - INFO - Built node command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && SKIP
2025-03-30 18:04:03,361 - root.generation_attempt - INFO - Built test command: source /opt/ros/humble/setup.bash && colcon build --packages-select network_scanner && source install/setup.bash && pytest -q -s -x src/network_scanner/test/test_scanner_node.py::TestFull
2025-03-30 18:04:03,361 - root.ros2_runner - INFO - Starting the ROS2 node...
2025-03-30 18:04:03,361 - root.ros2_runner - INFO - Skipping node start as requested.
2025-03-30 18:04:03,361 - root.ros2_runner - INFO - Running tests...
2025-03-30 18:06:06,129 - root.ros2_runner - INFO - Test output captured:
stdout:
Starting >>> network_scanner
Finished <<< network_scanner [0.59s]

Summary: 1 package finished [0.77s]
.Child process PID: 2658808, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=4.2.2.2', '-p', 'scan_period:=3']
.Child process PID: 2658858, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=8.8.8.8', '-p', 'scan_period:=3']
Received 2 messages:
Message 0:
  IP: 8.8.8.8, Status: UP
Message 1:
  IP: 8.8.8.8, Status: UP
.Child process PID: 2658979, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.1.1.1, 8.8.4.4', '-p', 'scan_period:=6']
Received 2 messages:
Message 0:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
Message 1:
  IP: 1.1.1.1, Status: UP
  IP: 8.8.4.4, Status: UP
..Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-328/test_no_overlapping_scans_netw0/nscan
Child process PID: 2659141, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.0.0.1', '-p', 'scan_period:=1']
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-328/test_invalid_json_format_netwo0/nscan
Child process PID: 2659253, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 0 messages:
.Using mock nscan binary
nscan path: /tmp/pytest-of-aleev/pytest-328/test_outdated_json_results_net0/nscan
Child process PID: 2659307, command: ['python3', '/home/aleev/codestral_gen/test_ws/install/network_scanner/lib/network_scanner/scanner_node', '--ros-args', '-p', 'network:=1.2.3.4', '-p', 'scan_period:=2']
Received 3 messages:
Message 0:
Message 1:
Message 2:
.
9 passed in 95.47s (0:01:35)

stderr:
Process 2658808 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2658858 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Process 2658979 did not terminate gracefully, force killing
No ROS2 node processes identified among children
Shell process 2659071 no longer exists
Process 2659141 did not terminate gracefully, force killing
No ROS2 node processes identified among children
No ROS2 node processes identified among children
Process 2659307 did not terminate gracefully, force killing
No ROS2 node processes identified among children

2025-03-30 18:06:06,129 - root.ros2_runner - INFO - Parsing test output for statistics...
2025-03-30 18:06:06,130 - root.ros2_runner - INFO - Tests failed: 0, passed: 9, skipped: 0
2025-03-30 18:06:06,130 - root.generation_attempt - INFO - Tests passed successfully.
2025-03-30 18:06:06,130 - root.generation_attempt - INFO - Exiting state: TEST -> New state: SUCCESS
2025-03-30 18:06:06,155 - root.base_generator - INFO - Attempt 2 finished with metrics:
metric             value
-----------------  -------
attempt_time       130.6
success            True
final_state        SUCCESS
tests_passed       9
tests_failed       0
tests_skipped      0
prompt_tokens      3349
completion_tokens  1118
total_tokens       4467
2025-03-30 18:06:06,155 - root.base_generator - INFO - Iteration 30: Successful attempt achieved.
2025-03-30 18:06:06,155 - root.base_generator - INFO - Iteration 30 finished.
2025-03-30 18:06:06,155 - root.base_generator - INFO - Phase: GENERATION -> Generation process finished. Moving to REPORT phase.
2025-03-30 18:06:06,156 - root.base_generator - INFO - Phase: REPORT -> Start analyzing metrics.
2025-03-30 18:06:06,225 - root.base_generator - INFO - Generation report:
+-----------+---------+----------+--------------+---------------------+------------------+
| iteration | success | attempts | tests_passed | avg attempt time, s | avg total tokens |
+-----------+---------+----------+--------------+---------------------+------------------+
|     1     |   ✅    |    8     |      9       |         112         |       4514       |
|     2     |   ✅    |    11    |      9       |         88          |       4445       |
|     3     |   ✅    |    1     |      9       |         130         |       4548       |
|     4     |   ✅    |    4     |      9       |         109         |       4543       |
|     5     |   ✅    |    2     |      9       |         112         |       4507       |
|     6     |   ✅    |    4     |      9       |         109         |       4503       |
|     7     |   ✅    |    6     |      9       |         91          |       4405       |
|     8     |   ✅    |    11    |      9       |         110         |       4510       |
|     9     |   ✅    |    4     |      9       |         110         |       4501       |
|    10     |   ✅    |    2     |      9       |         113         |       4507       |
|    11     |   ✅    |    3     |      9       |         115         |       4556       |
|    12     |   ✅    |    1     |      9       |         129         |       4501       |
|    13     |   ✅    |    5     |      9       |         113         |       4509       |
|    14     |   ✅    |    1     |      9       |         129         |       4485       |
|    15     |   ✅    |    4     |      9       |         109         |       4489       |
|    16     |   ✅    |    24    |      9       |         103         |       4484       |
|    17     |   ✅    |    30    |      9       |         123         |       4303       |
|    18     |   ✅    |    3     |      9       |         94          |       4471       |
|    19     |   ✅    |    1     |      9       |         130         |       4510       |
|    20     |   ✅    |    1     |      9       |         130         |       4446       |
|    21     |   ✅    |    12    |      9       |         93          |       4475       |
|    22     |   ✅    |    4     |      9       |         107         |       4504       |
|    23     |   ✅    |    5     |      9       |         111         |       4479       |
|    24     |   ✅    |    17    |      9       |         103         |       4502       |
|    25     |   ✅    |    2     |      9       |         95          |       4515       |
|    26     |   ✅    |    10    |      9       |         107         |       4512       |
|    27     |   ✅    |    3     |      9       |         114         |       4519       |
|    28     |   ✅    |    16    |      9       |         151         |       4188       |
|    29     |   ✅    |    5     |      9       |         110         |       4503       |
|    30     |   ✅    |    2     |      9       |         66          |       4163       |
+-----------+---------+----------+--------------+---------------------+------------------+
2025-03-30 18:06:06,225 - root.base_generator - INFO - Phase: REPORT -> Metrics analysis finished.
2025-03-30 18:06:06,225 - root.base_generator - INFO - Generation process finished in 22474 seconds.
